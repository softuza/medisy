import{a as C}from"./chunk-WABMULGM.js";import{a as w,b as x,c as j,e as X,f as Y,g as k,h as U}from"./chunk-AYBICITS.js";import{c as W}from"./chunk-YTX3ZFJ7.js";import{b as Q,f as Z}from"./chunk-SYN7XJL6.js";import{a as K}from"./chunk-SVVQ5PR3.js";import{a as q,b as J}from"./chunk-S734PXWV.js";import{a as H,b as V}from"./chunk-WAFCTZZO.js";import{i as F}from"./chunk-ZUQ55FEV.js";import{d as s,f as y,g as E,k as b,m as G,p as z,r as R,t as $}from"./chunk-AZ35PAEP.js";import"./chunk-7GKLQGBB.js";import{c as h}from"./chunk-XPDLU2SJ.js";import{a as P,c as B}from"./chunk-YUBOPGWF.js";import{ga as A,ha as D}from"./chunk-BE3RRH45.js";import"./chunk-ZTPR7VOL.js";import{Bb as _,Fc as I,Gb as T,Lb as a,Mb as d,Nb as c,Xb as N,Yb as O,f as u,g as L,gb as g,hb as n,na as p,nc as f,oc as M,rb as S,xb as v}from"./chunk-3ZQQMLH6.js";function oe(r,o){r&1&&c(0,"mat-progress-bar",11);}var Ee=(()=>{let o=class o{constructor(e,t,i,m){this.locale=e,this.fb=t,this.router=i,this.identityService=m,this.alert=S(void 0),this.indicator=S(!1),this.subscriptions=new L();let l=this.identityService.storage.get();this.form=this.fb.group({email:[l?.username,[s.required,s.minLength(1),s.email]],organization:[l?.realm,[s.required,s.minLength(3),s.maxLength(255)]]}),this.subscribeChanges();}ngOnDestroy(){this.subscriptions.unsubscribe();}subscribeChanges(){this.subscriptions.add(this.form.controls.email.valueChanges.subscribe(e=>{this.emailChanged(e);}));}emailChanged(e){let t=e.indexOf("@");if(t>0){let i=e.indexOf(".",t);this.form.controls.organization.setValue(e.substring(t+1,i>0?i:e.length));}}login(){return u(this,null,function*(){if(!Z(this.form))return!1;this.indicator.set(!0);let e=this.identityService.storage.set({realm:this.form.value.organization,username:this.form.value.email});return yield this.authInitialize(e),this.indicator.set(!1),!0;});}authInitialize(e){return u(this,null,function*(){try{if(yield this.identityService.initialize(e)){this.router.navigate(["/"]);return;}yield this.identityService.login({loginHint:e.username,locale:this.locale,redirectUri:this.identityService.getAuthRedirectUri()});}catch{this.alert.set({message:"Faield to login",type:K.Error,timeout:5e3});}});}};o.ɵfac=function(t){return new(t||o)(n(I),n(R),n(h),n(C));},o.ɵcmp=p({type:o,selectors:[["sz-identity-auth-login"]],standalone:!0,features:[f([]),M],decls:18,vars:4,consts:()=>{let e;e="Login";let t;t="Email";let i;i="Organization";let m;return m="Login",[[1,"content-center"],["svgIcon","logo",1,"logo"],[1,"tw-m-2"],e,[2,"padding","16px"],[3,"alert"],[3,"formGroup","keyup.enter"],["formControlName","email","label",t],["formControlName","organization","label",i],["mat-button","",1,"button-submit",3,"disabled","click"],m,["mode","indeterminate"]];},template:function(t,i){t&1&&(a(0,"div",0),c(1,"mat-icon",1),a(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title"),N(5,3),d()(),a(6,"mat-card-content",4),c(7,"sz-ui-alert",5),a(8,"form",6),O("keyup.enter",function(){return i.login();}),c(9,"sz-ui-form-field-input",7)(10,"sz-ui-form-field-input",8),d(),c(11,"mat-divider"),d(),a(12,"mat-card-actions")(13,"button",9),O("click",function(){return i.login();}),a(14,"span"),N(15,10),d()()(),a(16,"mat-card-footer"),v(17,oe,1,0,"mat-progress-bar",11),d()()()),t&2&&(g(7),_("alert",i.alert()),g(),_("formGroup",i.form),g(5),_("disabled",i.indicator()),g(4),T(17,i.indicator()?17:-1));},dependencies:[$,b,y,E,G,z,U,w,X,j,k,Y,x,J,q,F,D,A,V,H,B,P,Q,W],styles:[".content-center[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.logo[_ngcontent-%COMP%]{width:128px;height:128px;transform:scale(2);margin:16px}.button-submit[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{text-align:center;margin:16px 0;font-size:12px;cursor:pointer}"]});let r=o;return r;})();var Fe=(()=>{let o=class o{constructor(e,t,i){this.locale=e,this.router=t,this.identityService=i;}ngOnInit(){return u(this,null,function*(){let e=this.identityService.storage.get();if(!e){this.router.navigate(["/auth/login"]);return;}if(yield this.identityService.initialize(e)){this.router.navigate(["/"]);return;}yield this.identityService.login({loginHint:e.username,locale:this.locale,redirectUri:this.identityService.getAuthRedirectUri()});});}};o.ɵfac=function(t){return new(t||o)(n(I),n(h),n(C));},o.ɵcmp=p({type:o,selectors:[["sz-identity-auth-redirect"]],standalone:!0,features:[f([]),M],decls:0,vars:0,template:function(t,i){},encapsulation:2});let r=o;return r;})();export{Ee as SzAuthLoginComponent,Fe as SzAuthRedirectComponent};/**i18n:34a0aca9a8a7a5b54ef908b3a50021d42a3fb6a7b58cfe4980f9bcbab369501e*/