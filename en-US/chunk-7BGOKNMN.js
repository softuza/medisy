import{a as k}from"./chunk-GFNSS5JH.js";import{a as p}from"./chunk-BMJ3S5XZ.js";import"./chunk-JSCEI2V4.js";import{h as I}from"./chunk-YUC45UAG.js";import"./chunk-GPAES7OP.js";import"./chunk-DSJR6L5G.js";import"./chunk-XDEHVO3T.js";import{d as D,e as c}from"./chunk-2BMNYJ3Z.js";import"./chunk-LUZYQH3A.js";import"./chunk-ODYGSBAJ.js";import{b as B}from"./chunk-QERRRZIA.js";import{d as R,g as C}from"./chunk-MHLQ5ASK.js";import"./chunk-EMVR6TPU.js";import"./chunk-ZDS23LK5.js";import"./chunk-WX4XW32G.js";import"./chunk-Q4QLTUTU.js";import"./chunk-R425IBES.js";import{b as m,c as T}from"./chunk-MFJGOIE4.js";import{a as L}from"./chunk-KPHZXQ4R.js";import"./chunk-53QS6UIR.js";import"./chunk-TM26YT7E.js";import{a as $}from"./chunk-XYHX3JVK.js";import"./chunk-FZND2MZR.js";import{p as F}from"./chunk-CVZW7JYW.js";import"./chunk-GBJNACNX.js";import"./chunk-IJWI4VMJ.js";import{Ia as M,La as b}from"./chunk-OKKKBEFN.js";import{Jb as v,Kb as y,Lb as d,ac as E,bb as h,bc as x,cc as S,ja as r,mc as z,na as u,nc as w,yb as f,zb as g}from"./chunk-K7VHIDZW.js";import"./chunk-VARUJZUG.js";var q=["designer"],P=(()=>{let s=class s{constructor(){this.route=r(F),this.dialog=r(R),this.srptService=r(p),this.snackBar=r(B),this.template=this.route.snapshot.data.template,this.size={width:210,height:297},this.scale=3,this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:T.default().setItems([m.menu([m.divider()])])}}ngAfterViewInit(){this.refresh(this.template.content)}refresh(t){try{let e=k.fromString(t);e&&e.fields&&this.addFields(e.fields)}catch(e){console.log("TemplateComponent","refresh",e),this.snackBar.open(e,$.close,{duration:5e3})}}addFields(t){for(let e of t)console.log("addField",e),e.type==="text"?this.addFieldText(e):e.type==="barcode"?this.addFieldBarcode(e):e.type==="table"?this.addFieldTable(e):e.type==="line"?this.addFieldLine(e):e.type==="image"&&this.addFieldImage(e)}addFieldText(t){if(!t.options||typeof t.value!="string")return;let o=this.designerEl.nativeElement,i=document.createElement("p");i.innerText=typeof t.value=="string"?t.value:"",i.style.position="absolute",i.style.left=`${this.getRelativeSize(t.x)}px`,i.style.top=`${this.getRelativeSize(t.y)}px`,o.appendChild(i),this.addMouseEvents(i)}addFieldBarcode(t){let e=t.options;if(!e)return;let o=typeof t.value=="string"&&t.value?t.value:"1234567890",i=this.designerEl.nativeElement,n=null;if(e.barcodeType==="qr"&&(n=c.qr(t.value)),e.barcodeType==="datamatrix"&&(n=c.datamatrix(t.value,!1)),!n)return;let a=D.toSVG(n,e.options);a&&i.appendChild(a)}addFieldTable(t){if(!t.options)return;let o=this.designerEl.nativeElement}addFieldLine(t){let e=t.options;if(!e)return;let o=this.designerEl.nativeElement,i=document.createElement("div");i.style.position="absolute",i.style.left=`${this.getRelativeSize(t.x)}px`,i.style.top=`${this.getRelativeSize(t.y)}px`,i.style.width=`${this.getRelativeSize(e.x2-t.x)}px`,i.style.height=`${this.getRelativeSize(e.y2-t.y)}px`,i.style.borderBottom=`${e.lineWidth??1}px solid ${e.lineColor??"black"}`,o.appendChild(i),this.addMouseEvents(i)}addFieldImage(t){let e=t.options;if(!e||typeof t.value!="string")return;let o=this.designerEl.nativeElement,i=document.createElement("img");i.src=t.value,i.style.position="absolute",i.style.left=`${this.getRelativeSize(t.x)}px`,i.style.top=`${this.getRelativeSize(t.y)}px`,i.style.width=`${this.getRelativeSize(e.width)}px`,i.style.height=`${this.getRelativeSize(e.height)}px`,o.appendChild(i),this.addMouseEvents(i)}addMouseEvents(t){t.addEventListener("mousedown",()=>{t.style.cursor="move",document.addEventListener("mousemove",o),document.addEventListener("mouseup",i)});let e=this.designerEl.nativeElement,o=n=>{let a=n.clientX-e.getBoundingClientRect().left-t.offsetWidth/2,Q=n.clientY-e.getBoundingClientRect().top-t.offsetHeight/2;t.style.left=`${a}px`,t.style.top=`${Q}px`},i=()=>{t.style.cursor="auto",document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",i)}}getRelativeSize(t){return t*this.scale}};s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=u({type:s,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(e,o){if(e&1&&E(q,5),e&2){let i;x(i=S())&&(o.designerEl=i.first)}},standalone:!0,features:[z([p]),w],decls:4,vars:5,consts:[["designer",""],[3,"config"],[1,"container"],[1,"designer"]],template:function(e,o){e&1&&(d(0,"sz-ui-app-bar",1),v(1,"div",2),d(2,"div",3,0),y()),e&2&&(f("config",o.appBarConfig),h(2),g("width",o.getRelativeSize(o.size.width),"px")("height",o.getRelativeSize(o.size.height),"px"))},dependencies:[C,b,I,L,M],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;padding:10px;margin:10px;background-color:#f5f5f5;position:relative}"]});let l=s;return l})();var ne=[{path:"",component:P}];export{ne as default};
/**i18n:7274145596894140ce8dc809ecf6b222e8bea6098fe1553d5bf6245265c46bf4*/
