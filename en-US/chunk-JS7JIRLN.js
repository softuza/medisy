import{c as H}from"./chunk-DEF6I2JA.js";import{a as J}from"./chunk-FMXYSBNV.js";import{a as N}from"./chunk-BMJ3S5XZ.js";import"./chunk-JSCEI2V4.js";import{h as he}from"./chunk-HBNROWX6.js";import"./chunk-GPAES7OP.js";import"./chunk-DSJR6L5G.js";import"./chunk-XDEHVO3T.js";import{d as Ce,e as W}from"./chunk-2BMNYJ3Z.js";import{f as U,g as q,h as Q,k}from"./chunk-43W46CKO.js";import"./chunk-ODYGSBAJ.js";import{b as ue}from"./chunk-QERRRZIA.js";import{a as z,b as G,d as fe,e as $,g as S}from"./chunk-MHLQ5ASK.js";import{c as V,r as Te,u as X}from"./chunk-TP4OU5SK.js";import"./chunk-ZDS23LK5.js";import"./chunk-WX4XW32G.js";import{i as b}from"./chunk-Q4QLTUTU.js";import{d as _,f as R,g as A,l as I,n as D,q as y,r as v,t as F}from"./chunk-R425IBES.js";import{b as w,c as ce}from"./chunk-M2O4BAEP.js";import{a as ge}from"./chunk-KPHZXQ4R.js";import{c as Me,d as Se}from"./chunk-53QS6UIR.js";import"./chunk-TM26YT7E.js";import{a as x}from"./chunk-ZZPXE3UV.js";import"./chunk-FZND2MZR.js";import{p as pe}from"./chunk-CVZW7JYW.js";import"./chunk-GBJNACNX.js";import"./chunk-IJWI4VMJ.js";import{Ia as P,La as B,r as me}from"./chunk-OKKKBEFN.js";import{Ea as re,Fb as se,Hb as ae,Ib as _e,Jb as c,K as ie,Kb as g,Lb as m,Pb as de,Wb as Ee,Yb as j,ac as C,bb as a,bc as h,cc as O,ja as d,mb as L,mc as T,na as u,nc as M,wa as oe,xa as ne,yb as r,zb as le}from"./chunk-K7VHIDZW.js";import{a as ee,b as te}from"./chunk-VARUJZUG.js";var Ae=["root"],Oe=(()=>{let n=class n{constructor(){this.httpClient=d(me),this.element=null,this.isMoving=!1,this.changed=new re();}ngAfterViewInit(){this.render();}render(){console.log("render",this.field),this.field.type==="text"?this.addTextField(this.field):this.field.type==="barcode"?this.addBarcodeField(this.field):this.field.type==="table"?this.addTableField(this.field):this.field.type==="line"?this.addLineField(this.field):this.field.type==="image"&&this.addImageField(this.field);}getContainerElement(){return this.container.nativeElement;}addTextField(t){let e=t;if(!e)return;let i=this.getContainerElement(),o=document.createElement("p");o.innerText=e.text,o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,i.appendChild(o),this.addMouseEvents(o);}addBarcodeField(t){let e=t;if(!e)return;let i=this.getContainerElement(),o=null;if(e.barcodeType==="qr"&&(o=W.qr(e.value)),e.barcodeType==="datamatrix"&&(o=W.datamatrix(e.value,!1)),!o)return;let s=Ce.toSVG(o,e.options);s&&(s.style.position="absolute",s.style.left=`${this.getRelativeSize(e.x)}px`,s.style.top=`${this.getRelativeSize(e.y)}px`,s.style.width=`${this.getRelativeSize(e.width??18)}px`,s.style.height=`${this.getRelativeSize(e.height??18)}px`,i.appendChild(s));}addTableField(t){if(!t)return;let i=this.getContainerElement();}addLineField(t){let e=t;if(!e)return;let i=this.getContainerElement(),o=document.createElement("div");o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,o.style.width=`${this.getRelativeSize(e.x2-e.x)}px`,o.style.height=`${this.getRelativeSize(e.y2-e.y)}px`,o.style.borderBottom=`${e.lineWidth??1}px solid ${e.lineColor??"black"}`,i.appendChild(o),this.addMouseEvents(o);}addImageField(t){let e=t;if(!e)return;let i=this.getContainerElement(),o=document.createElement("img");o.alt="",this.httpClient.get(e.url,{responseType:"blob"}).pipe(ie(1)).subscribe(s=>{let E=new FileReader();E.onloadend=()=>{o.src=E.result;},E.readAsDataURL(s);}),o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,o.style.width=`${this.getRelativeSize(e.width)}px`,o.style.height=`${this.getRelativeSize(e.height)}px`,i.appendChild(o),this.addMouseEvents(o);}addMouseEvents(t){let e=0,i=0;t.addEventListener("mousedown",p=>{p.button===0&&(this.isMoving=!0,e=t.offsetLeft-p.clientX,i=t.offsetTop-p.clientY,t.style.cursor="move",document.addEventListener("mousemove",s),document.addEventListener("mouseup",E));});let o=this.getContainerElement(),s=p=>{if(!this.isMoving)return;let f=p.clientX+e,Z=p.clientY+i;t.style.left=`${f}px`,t.style.top=`${Z}px`,this.field.x=f/this.scale,this.field.y=Z/this.scale;},E=()=>{this.isMoving=!1,t.style.cursor="auto",document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",E),this.changed?.emit(this.field);};}onRightClick(t){t.preventDefault(),this.matMenuTrigger.openMenu();}getRelativeSize(t){return t*this.scale;}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=u({type:n,selectors:[["sz-mgmt-reporting-template-field"]],viewQuery:function(e,i){if(e&1&&(C(Ae,5),C(Me,7)),e&2){let o;h(o=O())&&(i.container=o.first),h(o=O())&&(i.matMenuTrigger=o.first);}},inputs:{field:"field",scale:"scale"},outputs:{changed:"changed"},standalone:!0,features:[T([N]),M],decls:2,vars:0,consts:[["root",""]],template:function(e,i){e&1&&m(0,"div",null,0);},dependencies:[S,B,Se,P],encapsulation:2});let l=n;return l;})();var Ne=(()=>{let n=class n extends U{constructor(){let t=d(z);super(t),this.fb=d(v),this.data=d(G),this.barcodeTypes=["qr","datamatrix"];let e=this.fb;this.dialog=t;let i=this.data;this.form=e.group({name:[i?.name??"_barcode1",[_.required]],type:["barcode",[_.required]],x:[i?.x??0,[_.required]],y:[i?.y??0,[_.required]],value:[i?.value??"",[_.required]],barcodeType:[i?.barcodeType??"qr",[_.required]],width:[i?.width??16,[_.required]],height:[i?.height??16,[_.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=u({type:n,selectors:[["sz-mgmt-reporting-template-barcode-field"]],standalone:!0,features:[T([]),L,M],decls:11,vars:10,consts:()=>{let t;t="Name";let e;e="X";let i;i="Y";let o;o="value";let s;s="Type";let E;E="Width";let p;return p="Height",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",t],["formControlName","x","label",e,3,"type"],["formControlName","y","label",i,3,"type"],["formControlName","value","label",o],["formControlName","barcodeType","label",s,3,"source"],["formControlName","width","label",E,3,"type"],["formControlName","height","label",p,3,"type"],[3,"actions"]];},template:function(e,i){e&1&&(m(0,"sz-ui-dialog-header",0),c(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5)(7,"sz-ui-form-field-select",6)(8,"sz-ui-form-field-input",7)(9,"sz-ui-form-field-input",8),g()(),m(10,"sz-ui-dialog-actions",9)),e&2&&(r("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),a(2),r("formGroup",i.form),a(2),r("type","number"),a(),r("type","number"),a(2),r("source",i.barcodeTypes),a(),r("type","number"),a(),r("type","number"),a(),r("actions",i.actions));},dependencies:[F,I,R,A,D,y,S,$,b,H,k,q,Q,X,V,Te],encapsulation:2});let l=n;return l;})();var Le=(()=>{let n=class n extends U{constructor(){let t=d(z);super(t),this.fb=d(v),this.data=d(G);let e=this.fb;this.dialog=t;let i=this.data;this.form=e.group({name:[i?.name??"_text1",[_.required]],type:["text",[_.required]],x:[i?.x??0,[_.required]],y:[i?.y??0,[_.required]],text:[i?.text??"",[_.required]],fontSize:[i?.fontSize??12,[_.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=u({type:n,selectors:[["sz-mgmt-reporting-template-text-field"]],standalone:!0,features:[T([]),L,M],decls:9,vars:8,consts:()=>{let t;t="Name";let e;e="X";let i;i="Y";let o;o="Text";let s;return s="Font Size",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",t],["formControlName","x","label",e,3,"type"],["formControlName","y","label",i,3,"type"],["formControlName","text","label",o],["formControlName","fontSize","label",s,3,"type"],[3,"actions"]];},template:function(e,i){e&1&&(m(0,"sz-ui-dialog-header",0),c(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5)(7,"sz-ui-form-field-input",6),g()(),m(8,"sz-ui-dialog-actions",7)),e&2&&(r("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),a(2),r("formGroup",i.form),a(2),r("type","number"),a(),r("type","number"),a(2),r("type","number"),a(),r("actions",i.actions));},dependencies:[F,I,R,A,D,y,S,$,b,H,k,q,Q,X,V],encapsulation:2});let l=n;return l;})();var Pe=["designer"];function ze(l,n){if(l&1){let Y=de();c(0,"sz-mgmt-reporting-template-field",5),Ee("changed",function(e){oe(Y);let i=j();return ne(i.fieldChanged(e));}),g();}if(l&2){let Y=n.$implicit,t=j();r("field",Y)("scale",t.scale);}}var Re=(()=>{let n=class n{constructor(){this.route=d(pe),this.dialog=d(fe),this.srptService=d(N),this.snackBar=d(ue),this.template=this.route.snapshot.data.template,this.fields=[],this.size={width:210,height:297},this.scale=3,this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:ce.default().setItems([w.menu([w.text(this.openSaveTextFieldComponent.bind(this)),w.barcode(this.openSaveBarcodeFieldComponent.bind(this))])])};}ngAfterViewInit(){this.refresh(this.template.content);}refresh(t){try{let e=J.fromString(t);this.fields=e.fields??[];}catch(e){this.snackBar.open(e,x.close,{duration:5e3});}}getRelativeSize(t){return t*this.scale;}openSaveTextFieldComponent(){this.dialog.open(Le).afterClosed().subscribe(t=>{t&&this.fields.push(t);});}openSaveBarcodeFieldComponent(){this.dialog.open(Ne).afterClosed().subscribe(t=>{t&&this.fields.push(t);});}fieldChanged(t){this.fields=this.fields.map(e=>e.name===t.name?t:e),this.save();}save(){this.srptService.templates.update(this.template.id,te(ee({},this.template),{content:J.toString({fields:this.fields})})).subscribe(()=>{this.snackBar.open(x.saved,x.close,{duration:5e3});});}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=u({type:n,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(e,i){if(e&1&&C(Pe,5),e&2){let o;h(o=O())&&(i.designerEl=o.first);}},standalone:!0,features:[T([N]),M],decls:6,vars:5,consts:[["designer",""],[3,"config"],[1,"container"],[1,"designer"],[3,"field","scale"],[3,"changed","field","scale"]],template:function(e,i){e&1&&(m(0,"sz-ui-app-bar",1),c(1,"div",2)(2,"div",3,0),ae(4,ze,1,2,"sz-mgmt-reporting-template-field",4,se),g()()),e&2&&(r("config",i.appBarConfig),a(2),le("width",i.getRelativeSize(i.size.width),"px")("height",i.getRelativeSize(i.size.height),"px"),a(2),_e(i.fields));},dependencies:[S,B,he,ge,P,Oe],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;padding:10px;margin:10px;background-color:#fff;position:relative}"]});let l=n;return l;})();var $t=[{path:"",component:Re}];export{$t as default};/**i18n:7274145596894140ce8dc809ecf6b222e8bea6098fe1553d5bf6245265c46bf4*/