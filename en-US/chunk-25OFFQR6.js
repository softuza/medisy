import{c as U}from"./chunk-Z3DSEDYU.js";import{c as re,d as ne,e as p,h as se,i as ae}from"./chunk-4V5MPVOL.js";import"./chunk-RB3G63CU.js";import"./chunk-4NLUKIZF.js";import"./chunk-E3TIAARS.js";import{b as ie,f as P,g as V,h as G,j as oe,k as $}from"./chunk-UU25KKTJ.js";import{b as ee,c as te}from"./chunk-7JFHPBQA.js";import{b as Y}from"./chunk-7EJ4LSDB.js";import{a as z,b as Z,d as q,e as I,g as L}from"./chunk-WP7GINVA.js";import{c as Q,s as J,t as W,u as w}from"./chunk-2FKQN52J.js";import"./chunk-SWSR2FHM.js";import"./chunk-YGAFJZ7Z.js";import{i as A}from"./chunk-7ES6GSH3.js";import{d as C,f as y,g as D,l as E,o as F,r as T,s as O,u as N}from"./chunk-GJE2CTRJ.js";import{b as l,c as B}from"./chunk-7ORDSP56.js";import"./chunk-IDEFMHWN.js";import"./chunk-EQLT65ZB.js";import"./chunk-K465E5EJ.js";import{a as R}from"./chunk-LUJYMJYX.js";import"./chunk-FPHQ27E5.js";import"./chunk-FMLZPT37.js";import"./chunk-WW2QO4XN.js";import"./chunk-DMIN26VD.js";import{b as X,s as K}from"./chunk-VE4VSZJT.js";import{Kb as u,Lb as f,Mb as m,Xb as b,cb as c,da as v,ia as H,ja as n,na as h,nb as M,qc as S,rc as _,zb as s}from"./chunk-2H67EYAB.js";import"./chunk-ZA5F7ID5.js";var j=class{constructor(t,a){this._document=a;let e=this._textarea=this._document.createElement("textarea"),i=e.style;i.position="fixed",i.top=i.opacity="0",i.left="-999em",e.setAttribute("aria-hidden","true"),e.value=t,e.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(e);}copy(){let t=this._textarea,a=!1;try{if(t){let e=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),a=this._document.execCommand("copy"),e&&e.focus();}}catch{}return a;}destroy(){let t=this._textarea;t&&(t.remove(),this._textarea=void 0);}},le=(()=>{let t=class t{constructor(e){this._document=e;}copy(e){let i=this.beginCopy(e),o=i.copy();return i.destroy(),o;}beginCopy(e){return new j(e,this._document);}};t.ɵfac=function(i){return new(i||t)(H(X));},t.ɵprov=v({token:t,factory:t.ɵfac,providedIn:"root"});let r=t;return r;})();var x=class extends ee{constructor(t,a){super(t,`${a}/v1/files`),this.http=t,this.basePath=a;}upload(t){let a=new FormData();return a.append("file",t),this.http.post(this.path,a);}download(t){return this.http.get(`${this.path}/${t}/download`,{responseType:"blob"});}};var d=(()=>{let t=class t extends te{constructor(){let e=n(K);super(e,"softuza-drive"),this.files=new x(this.http,this.basePath);}};t.ɵfac=function(i){return new(i||t)();},t.ɵprov=v({token:t,factory:t.ɵfac});let r=t;return r;})();var de=(()=>{let t=class t extends P{constructor(){let e=n(z);super(e),this.sdrvService=n(d),this.fb=n(O),this.data=n(Z);let i=this.fb;this.dialog=e;let o=this.data;this.form=i.group({name:[o?.name,[C.required]],description:[o?.description,[C.maxLength(4096)]]});}submit(){this.IsValid()&&(this.data?this.save(this.sdrvService.files.update(this.data.id,this.form.value)):this.save(this.sdrvService.files.create(this.form.value)));}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files-save"]],standalone:!0,features:[S([d]),M,_],decls:6,vars:5,consts:()=>{let e;e="Name";let i;return i="Description",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],["formControlName","description","label",i],[3,"actions"]];},template:function(i,o){i&1&&(m(0,"sz-ui-dialog-header",0),u(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-textarea",3),f()(),m(5,"sz-ui-dialog-actions",4)),i&2&&(s("title",o.title)("subtitle",o.subtitle)("alert",o.alert()),c(2),s("formGroup",o.form),c(3),s("actions",o.actions));},dependencies:[N,E,y,D,F,T,L,I,A,U,$,V,G,w,Q,J],encapsulation:2});let r=t;return r;})();var ce=(()=>{let t=class t extends P{constructor(){let e=n(z);super(e),this.sdrvService=n(d),this.fb=n(O),this.fileName="Select File";let i=this.fb;this.dialog=e,this.form=i.group({file:[null,[C.required]]});}submit(){this.IsValid()&&this.save(this.sdrvService.files.upload(this.form.value.file));}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files-upload"]],standalone:!0,features:[S([d]),M,_],decls:5,vars:5,consts:()=>{let e;return e="File",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","file","label",e],[3,"actions"]];},template:function(i,o){i&1&&(m(0,"sz-ui-dialog-header",0),u(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-file-upload",2),f()(),m(4,"sz-ui-dialog-actions",3)),i&2&&(s("title",o.title)("subtitle",o.subtitle)("alert",o.alert()),c(2),s("formGroup",o.form),c(2),s("actions",o.actions));},dependencies:[N,E,y,D,F,T,L,I,A,U,$,V,G,w,W],encapsulation:2});let r=t;return r;})();var me=(()=>{let t=class t{constructor(){this.dialog=n(q),this.sdrvService=n(d),this.clipboard=n(le),this.snakbar=n(Y),this.environment=n("environment"),this.dataSource=new se(),this.appBarConfig={title:R.files,menu:B.default([l.upload(this.openUploadComponent.bind(this)),l.menu([l.search()])])},this.dataSource.columnDefs.push(p.uuid("id"),p.string("name").setValueClassFontBold().setStacked(p.string("description").setValueClassFontSmall()),p.number("size").setValueGetter(e=>this.formatSize(e.size)),p.date("createdAt").setVisible(!1),p.date("updatedAt").setVisible(!1),p.menu(B.default([l.download(this.download.bind(this)).setTooltip(R.download),l.menu([l.edit(this.openSaveComponent.bind(this)),l.copyLink(this.copyLink.bind(this)),l.divider(),l.delete(this.openFileDeleteComponent.bind(this))])])).clearClass().setClassEnd()),this.get();}formatSize(e){return e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`;}openUploadComponent(){this.dialog.open(ce).afterClosed().subscribe(e=>{this.dataSource.add(e);});}openSaveComponent(e){this.dialog.open(de,{data:e}).afterClosed().subscribe(i=>{this.dataSource.addOrUpdateItem(i);});}openFileDeleteComponent(e){this.dialog.open(oe,{data:ie.delete(this.sdrvService.files.delete(e.id),e)}).afterClosed().subscribe(i=>{this.dataSource.delete(i);});}download(e){this.sdrvService.files.download(e.id).subscribe(i=>{let o=window.URL.createObjectURL(i),g=document.createElement("a");g.href=o,g.download=e.name,g.click(),window.URL.revokeObjectURL(o);});}copyLink(e){this.clipboard.copy(`${this.environment.apiUrl}/${this.sdrvService.files.getPath()}/${e.id}/download`),this.snakbar.open(R.copied,"Close");}get(){this.sdrvService.files.get(this.dataSource.getQuery()).pipe(ae(this.dataSource.state)).subscribe(e=>{this.dataSource.set(e.items,e.count);});}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files"]],standalone:!0,features:[S([d]),_],decls:2,vars:3,consts:[[3,"changed","config","dataSource"],[3,"update","dataSource"]],template:function(i,o){i&1&&(u(0,"sz-ui-table-bar",0),b("changed",function(){return o.get();}),f(),u(1,"sz-ui-table",1),b("update",function(){return o.get();}),f()),i&2&&(s("config",o.appBarConfig)("dataSource",o.dataSource),c(),s("dataSource",o.dataSource));},dependencies:[re,ne],encapsulation:2});let r=t;return r;})();var St=[{path:"",component:me}];export{St as default};/**i18n:9054193bb4dcc24d51a6dba534830e37dcd91e77a8a9ecb6b346a792eb872c67*/