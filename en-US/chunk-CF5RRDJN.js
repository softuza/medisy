import{b as u}from"./chunk-CJT6NFGL.js";import{a as Ae}from"./chunk-4C5WVTKE.js";import{a as fe,b as Re,c as pe,d as he,e as ce}from"./chunk-VV75Q4AA.js";import{a as P}from"./chunk-IBLN6PAB.js";import{g as ge,h as Pe,i as ue,l as Te}from"./chunk-BD4I3DKC.js";import{a as ne,b as te,e as ie,g as _e}from"./chunk-U3H7W2BJ.js";import{c as Ee,h as re,i as ae,j as Ce,o as me,q as Se,r as de,s as Me,v as Ne}from"./chunk-XLT5PAE2.js";import{c as N}from"./chunk-GCAF7ZOT.js";import{d as E,f as J,g as K,l as Q,o as U,r as Z,s as ee,u as oe}from"./chunk-KMQC4JE3.js";import{a as Oe}from"./chunk-6JQOA26U.js";import{a as se}from"./chunk-OCBV6JKZ.js";import{b as le}from"./chunk-BKHR7P2T.js";import{Jb as _,Kb as i,Lb as l,Vb as d,a as W,bb as a,gc as M,ja as m,mb as H,mc as j,na as V,nc as q,s as w,yb as r}from"./chunk-5UGT7ICT.js";import{a as S,b as g}from"./chunk-KKIINILB.js";var _o=(()=>{let C=class C extends ge{constructor(){super(m(ne)),this.mpplService=m(P),this.fb=m(ee),this.data=m(te),this.nationalities=this.mpplService.nationalities.getAll({orderBy:["name"]}),this.languages=this.mpplService.languages.getAll({orderBy:["name"]}),this.countries=[],this.sexes=Object.keys(u).map(o=>u[o]),this.subscriptions=new W(),this.titles=this.mpplService.titles.get(g(S({},N.unpaged()),{orderBy:"name"})),this.countrySelectConfig={emptyOption:!0,optionContentFn:o=>o.latinName??"",optionSelectedFn:(o,s)=>{s&&this.form.patchValue({mobilePhoneCallingCode:this.form.value.mobilePhoneCallingCode??s.callingCode,homePhoneCallingCode:this.form.value.homePhoneCallingCode??s.callingCode,workPhoneCallingCode:this.form.value.workPhoneCallingCode??s.callingCode});}},this.callingCodeConfig={optionValueFn:o=>o.callingCode,optionContentFn:o=>o.callingCode},this.titleAutoCompleteConfig={valueChangedFn:o=>(typeof o=="string"&&(this.titles=this.mpplService.titles.get(g(S({query:o},N.default()),{orderBy:"name"}))),!1),optionSelectedFn:o=>{o&&(this.form.value.sex||this.form.patchValue({sex:o.sex}));},optionDisplayWithFn:o=>o.name,optionValueFn:o=>o,suffixes:[{icon:Oe.save,tooltip:se.save,hideOnLoading:!0,hideOnValid:!0,hideOnEmpty:!0,clickFn:o=>this.mpplService.titles.create({name:o})}]};let e=this.fb,n=this.data;this.form=e.group({firstName:e.control(n?.firstName,[E.required,E.maxLength(128)]),lastName:e.control(n?.lastName,[E.required,E.maxLength(128)]),fatherName:e.control(n?.fatherFirstName?`${n.fatherFirstName} ${n?.lastName}`:null,[E.maxLength(128)]),motherName:e.control(n?.motherName,[E.maxLength(128)]),birthDate:e.control(n?.birthDate,[]),nationalityId:e.control(null,[]),ssn:e.control(n?.ssn,[E.maxLength(128)]),languageId:e.control(null,[E.required]),sex:e.control(null,[E.required]),title:e.control(null,[Ae.object()]),primaryEmail:[null,[E.email]],secondaryEmail:[null,[E.email]],mobilePhoneCallingCode:[null,[]],mobilePhone:e.control(null,[E.pattern("^[0-9]*$")]),hasMobilePhoneWhatsapp:[!1,[]],homePhoneCallingCode:[null,[]],homePhone:e.control(null,[E.pattern("^[0-9]*$")]),hasHomePhoneWhatsapp:[!1,[]],workPhoneCallingCode:[null,[]],workPhone:e.control(null,[E.pattern("^[0-9]*$")]),hasWorkPhoneWhatsapp:[!1,[]],homeAddressCountryId:[null,[]],homeAddressCity:[null,[]],homeAddressStreet:[null,[]],homeAddressPostalCode:[null,[]],homeAddressProvince:[null,[]]}),this.subscibeChanges(),this.getCountries(),this.getGeoLocation();}subscibeChanges(){this.subscriptions.add(this.form.get("firstName")?.valueChanges.subscribe(e=>{if(!e||e===""){this.form.patchValue({sex:null,languageId:null});return;}else this.getGenders(e);}));}getGeoLocation(){this.mpplService.geoip.getGeoIP().subscribe(e=>{e&&this.form.patchValue({homeAddressCountryId:e.id,mobilePhoneCallingCode:this.form.value.mobilePhoneCallingCode??e.callingCode,homePhoneCallingCode:this.form.value.homePhoneCallingCode??e.callingCode,workPhoneCallingCode:this.form.value.workPhoneCallingCode??e.callingCode});});}getCountries(){this.mpplService.countries.getAllItems({orderBy:["latinName"]}).subscribe(e=>{this.countries=e;});}getGenders(e){!e||e.length<3||this.mpplService.autosuggestions.getGenders(S({query:e},N.minimal())).pipe(w(n=>n.items)).subscribe(n=>{!n||n.length===0||(this.form.value.sex||this.form.patchValue({sex:n[0].sex}),this.form.value.languageId||this.form.patchValue({languageId:n[0].languageId}));});}getPhoneNumber(e,n){return!e||e===""?null:(e=e.replace(/^0+/,""),n?`${n}${e}`:e);}submit(){if(!this.IsValid())return;let e=this.form.value;this.mpplService.persons.create({languageId:e.languageId,nationalityId:e.nationalityId,sex:e.sex,titleId:e.title?.id,birthDate:e.birthDate,nationalitiyId:e.nationalitiyId,ssn:e.ssn,names:[{firstName:e.firstName,lastName:e.lastName,fatherName:e.fatherName,motherName:e.motherName,languageId:e.languageId}],primaryEmail:e.primaryEmail,secondaryEmail:e.secondaryEmail,mobilePhone:this.getPhoneNumber(e.mobilePhone,e.mobilePhoneCallingCode),hasMobilePhoneWhatsapp:e.hasMobilePhoneWhatsapp,homePhone:this.getPhoneNumber(e.homePhone,e.homePhoneCallingCode),hasHomePhoneWhatsapp:e.hasHomePhoneWhatsapp,workPhone:this.getPhoneNumber(e.workPhone,e.workPhoneCallingCode),hasWorkPhoneWhatsapp:e.hasWorkPhoneWhatsapp,homeAddressCountryId:e.homeAddressCountryId,homeAddressCity:e.homeAddressCity,homeAddressStreet:e.homeAddressStreet,homeAddressPostalCode:e.homeAddressPostalCode,homeAddressProvince:e.homeAddressProvince}).pipe(re(this.indicator),ae(this.alert)).subscribe(n=>{this.dialogRef.close(n);});}};C.ɵfac=function(n){return new(n||C)();},C.ɵcmp=V({type:C,selectors:[["sz-medisy-people-person-create"]],standalone:!0,features:[j([P]),H,q],decls:57,vars:19,consts:()=>{let e;e="Title";let n;n="First name";let o;o="Last name";let s;s="Father name";let T;T="Mother name";let f;f="Nationality";let R;R="SSN";let p;p="Sex";let h;h="Language";let c;c="BirthDate";let A;A="Country";let I;I="City";let L;L="Province";let $;$="Street";let y;y="Postal Code";let b;b="Code";let D;D="Mobile";let z;z="Code";let G;G="Home";let B;B="Code";let v;v="Work";let X;X="Primary Email";let Y;Y="Secondary Email";let x;x="Home Address";let F;F="Phones";let k;return k="Emails",[x,F,k,[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],[1,"sz-form-row"],["formControlName","title","label",e,3,"source","config"],["formControlName","firstName","label",n],["formControlName","lastName","label",o],["formControlName","fatherName","label",s],["formControlName","motherName","label",T],["formControlName","nationalityId","label",f,3,"source"],["formControlName","ssn","label",R],["formControlName","sex","label",p,3,"source","localizedValue"],["formControlName","languageId","label",h,3,"source"],["formControlName","birthDate","label",c],[1,"tw-mb-4"],["multi",""],["formControlName","homeAddressCountryId","label",A,3,"source","config"],["formControlName","homeAddressCity","label",I],["formControlName","homeAddressProvince","label",L],["formControlName","homeAddressStreet","label",$],["formControlName","homeAddressPostalCode","label",y],["formControlName","mobilePhoneCallingCode","label",b,3,"source","config"],["formControlName","mobilePhone","label",D],["formControlName","hasMobilePhoneWhatsapp"],["formControlName","homePhoneCallingCode","label",z,3,"source","config"],["formControlName","homePhone","label",G],["formControlName","hasHomePhoneWhatsapp"],["formControlName","workPhoneCallingCode","label",B,3,"source","config"],["formControlName","workPhone","label",v],["formControlName","hasWorkPhoneWhatsapp"],["formControlName","primaryEmail","label",X],["formControlName","secondaryEmail","label",Y],[3,"actions"]];},template:function(n,o){n&1&&(l(0,"sz-ui-dialog-header",3),_(1,"mat-dialog-content")(2,"form",4)(3,"div",5),l(4,"sz-ui-form-field-autocomplete",6),i(),_(5,"div",5),l(6,"sz-ui-form-field-input-text",7)(7,"sz-ui-form-field-input-text",8),i(),_(8,"div",5),l(9,"sz-ui-form-field-input-text",9)(10,"sz-ui-form-field-input-text",10),i(),_(11,"div",5),l(12,"sz-ui-form-field-select",11)(13,"sz-ui-form-field-input-text",12),i(),_(14,"div",5),l(15,"sz-ui-form-field-select",13)(16,"sz-ui-form-field-select",14),i(),l(17,"sz-ui-form-field-date",15),_(18,"div",16)(19,"mat-accordion",17)(20,"mat-expansion-panel")(21,"mat-expansion-panel-header")(22,"mat-panel-title"),d(23,0),i()(),l(24,"sz-ui-form-field-select",18),_(25,"div",5),l(26,"sz-ui-form-field-input-text",19)(27,"sz-ui-form-field-input-text",20),i(),_(28,"div",5),l(29,"sz-ui-form-field-input-text",21)(30,"sz-ui-form-field-input-text",22),i()(),_(31,"mat-expansion-panel")(32,"mat-expansion-panel-header")(33,"mat-panel-title"),d(34,1),i()(),_(35,"div",5),l(36,"sz-ui-form-field-select",23)(37,"sz-ui-form-field-input-text",24),i(),_(38,"mat-checkbox",25),M(39,"WhatsApp"),i(),_(40,"div",5),l(41,"sz-ui-form-field-select",26)(42,"sz-ui-form-field-input-text",27),i(),_(43,"mat-checkbox",28),M(44,"WhatsApp"),i(),_(45,"div",5),l(46,"sz-ui-form-field-select",29)(47,"sz-ui-form-field-input-text",30),i(),_(48,"mat-checkbox",31),M(49,"WhatsApp"),i()(),_(50,"mat-expansion-panel")(51,"mat-expansion-panel-header")(52,"mat-panel-title"),d(53,2),i()(),l(54,"sz-ui-form-field-input-text",32)(55,"sz-ui-form-field-input-text",33),i()()()()(),l(56,"sz-ui-dialog-actions",34)),n&2&&(r("title",o.title)("subtitle",o.subtitle)("alert",o.alert()),a(2),r("formGroup",o.form),a(2),r("source",o.titles)("config",o.titleAutoCompleteConfig),a(8),r("source",o.nationalities),a(3),r("source",o.sexes)("localizedValue",!0),a(),r("source",o.languages),a(8),r("source",o.countries)("config",o.countrySelectConfig),a(12),r("source",o.countries)("config",o.callingCodeConfig),a(5),r("source",o.countries)("config",o.callingCodeConfig),a(5),r("source",o.countries)("config",o.callingCodeConfig),a(10),r("actions",o.actions));},dependencies:[oe,Q,J,K,U,Z,_e,ie,ce,he,fe,Re,pe,de,Se,le,Te,Pe,ue,Ne,Ee,me,Me,Ce],encapsulation:2});let O=C;return O;})();export{_o as a};/**i18n:52dae1015fb4dcd24d02f3b60578855a39e5cc5be32446a479305eae917c802c*/