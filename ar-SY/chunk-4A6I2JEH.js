import{c as U}from"./chunk-Z3DSEDYU.js";import{a as Z}from"./chunk-2T3VJL2I.js";import{a as Be,b as ke,j as Xe}from"./chunk-4V5MPVOL.js";import"./chunk-RB3G63CU.js";import"./chunk-4NLUKIZF.js";import"./chunk-E3TIAARS.js";import{d as ue,e as ee}from"./chunk-EPTC3T6X.js";import{f as V,g as B,h as k,k as X}from"./chunk-UU25KKTJ.js";import"./chunk-7JFHPBQA.js";import{b as $e}from"./chunk-7EJ4LSDB.js";import{a as b,b as P,d as Pe,e as R,g as M}from"./chunk-WP7GINVA.js";import{c as z,r as Ge,u as G}from"./chunk-2FKQN52J.js";import{b as ze}from"./chunk-SWSR2FHM.js";import"./chunk-YGAFJZ7Z.js";import{i as $}from"./chunk-7ES6GSH3.js";import{d as l,f as D,g as I,l as O,o as v,r as F,s as A,u as x}from"./chunk-GJE2CTRJ.js";import{b as w,c as we}from"./chunk-7ORDSP56.js";import{a as Ve}from"./chunk-IDEFMHWN.js";import"./chunk-EQLT65ZB.js";import"./chunk-K465E5EJ.js";import{a as pe}from"./chunk-LUJYMJYX.js";import"./chunk-FPHQ27E5.js";import{p as Ae}from"./chunk-FMLZPT37.js";import"./chunk-WW2QO4XN.js";import"./chunk-DMIN26VD.js";import{A as Fe,Ka as be,Na as Re,ka as xe,m as Oe,s as ve}from"./chunk-VE4VSZJT.js";import{$a as ye,Cb as N,Fb as ne,Hb as re,Ib as se,Jb as ae,Kb as _,Lb as u,Mb as m,Qb as W,Xb as j,Zb as c,bc as Le,cb as r,cc as De,db as ie,dc as Ie,hc as le,ic as de,ja as p,lb as Ne,na as E,nb as y,nc as Q,oc as Y,pc as L,qa as Ce,qc as g,rc as T,s as he,sb as oe,vc as me,wa as h,wc as _e,xa as C,ya as te,yb as J,zb as a}from"./chunk-2H67EYAB.js";import{a as Me,b as Se}from"./chunk-ZA5F7ID5.js";var H=class{static round2Decimals(o){return Math.round(o*100)/100;}};var Ue=(()=>{let o=class o{constructor(e,t){this.http=e,this.sanitizer=t;}transform(e){return this.http.get(e,{responseType:"blob"}).pipe(he(t=>this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(t))));}};o.ɵfac=function(t){return new(t||o)(ie(ve,16),ie(Fe,16));},o.ɵpipe=Ce({name:"secure",type:o,pure:!0,standalone:!0});let n=o;return n;})();var f=class{static toPixel(o,s){return o==="mm"?s*3.78:o==="cm"?s*37.8:o==="in"?s*96:s;}static fromPixel(o,s){return o==="mm"?s/3.78:o==="cm"?s/37.8:o==="in"?s/96:s;}};var qe=(()=>{let o=class o extends V{constructor(){let e=p(b);super(e),this.fb=p(A),this.data=p(P),this.barcodeTypes=["qr","datamatrix"];let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({name:[i?.name??"_barcode1",[l.required]],type:["barcode",[l.required]],x:[i?.x??0,[l.required]],y:[i?.y??0,[l.required]],value:[i?.value??"",[l.required]],barcodeType:[i?.barcodeType??"qr",[l.required]],width:[i?.width??16,[l.required]],height:[i?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-barcode-field"]],standalone:!0,features:[g([]),y,T],decls:13,vars:10,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0642\u064A\u0645\u0629";let i;i="\u0627\u0644\u0646\u0645\u0637";let d;d="\u0627\u0644\u0639\u0631\u0636";let S;return S="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],["formControlName","value","label",t],["formControlName","barcodeType","label",i,3,"source"],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",d,3,"type"],["formControlName","height","label",S,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(m(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-select",4),_(6,"div",5),m(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7),u(),_(9,"div",5),m(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),u()()(),m(12,"sz-ui-dialog-actions",10)),t&2&&(a("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),a("formGroup",i.form),r(3),a("source",i.barcodeTypes),r(2),a("type","number"),r(),a("type","number"),r(2),a("type","number"),r(),a("type","number"),r(),a("actions",i.actions));},dependencies:[x,O,D,I,v,F,M,R,$,U,X,B,k,G,z,Ge],encapsulation:2});let n=o;return n;})();var He=(()=>{let o=class o extends V{constructor(){let e=p(b);super(e),this.fb=p(A),this.data=p(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({name:[i?.name??"_image1",[l.required]],type:["image",[l.required]],x:[i?.x??0,[l.required]],y:[i?.y??0,[l.required]],url:[i?.url??"",[l.required]],width:[i?.width??16,[l.required]],height:[i?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-image-field"]],standalone:!0,features:[g([]),y,T],decls:11,vars:9,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0639\u0631\u0636";let i;return i="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",t,3,"type"],["formControlName","height","label",i,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(m(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2),_(4,"div",3),m(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),u(),_(7,"div",3),m(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),u()()(),m(10,"sz-ui-dialog-actions",8)),t&2&&(a("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),a("formGroup",i.form),r(3),a("type","number"),r(),a("type","number"),r(2),a("type","number"),r(),a("type","number"),r(),a("actions",i.actions));},dependencies:[x,O,D,I,v,F,M,R,$,U,X,B,k,G,z],encapsulation:2});let n=o;return n;})();var We=(()=>{let o=class o extends V{constructor(){let e=p(b);super(e),this.fb=p(A),this.data=p(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({name:[i?.name??"_line1",[l.required]],type:["line",[l.required]],x:[i?.x??5,[l.required]],y:[i?.y??5,[l.required]],lineColor:[i?.lineColor??"#000",[l.required]],lineWidth:[i?.lineWidth??1,[l.required]],x2:[i?.x2??30,[l.required]],y2:[i?.y2??5,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-line-field"]],standalone:!0,features:[g([]),y,T],decls:13,vars:10,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0644\u0648\u0646";let i;return i="\u0627\u0644\u0639\u0631\u0636",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","x2","label","X2",3,"type"],["formControlName","y2","label","Y2",3,"type"],["formControlName","lineColor","label",t],["formControlName","lineWidth","label",i,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(m(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2),_(4,"div",3),m(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),u(),_(7,"div",3),m(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),u(),m(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),u()(),m(12,"sz-ui-dialog-actions",10)),t&2&&(a("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),a("formGroup",i.form),r(3),a("type","number"),r(),a("type","number"),r(2),a("type","number"),r(),a("type","number"),r(2),a("type","number"),r(),a("actions",i.actions));},dependencies:[x,O,D,I,v,F,M,R,$,U,X,B,k,G,z],encapsulation:2});let n=o;return n;})();var je=(()=>{let o=class o extends V{constructor(){let e=p(b);super(e),this.fb=p(A),this.data=p(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({name:[i?.name??"_text1",[l.required]],type:["text",[l.required]],x:[i?.x??0,[l.required]],y:[i?.y??0,[l.required]],text:[i?.text??"",[l.required]],fontSize:[i?.fontSize??12,[l.required]],fontColor:[i?.fontColor??"#000",[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-text-field"]],standalone:!0,features:[g([]),y,T],decls:11,vars:8,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0646\u0635";let i;i="\u062D\u062C\u0645 \u0627\u0644\u062E\u0637";let d;return d="\u0644\u0648\u0646 \u0627\u0644\u062E\u0637",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","text","label",t],["formControlName","fontSize","label",i,3,"type"],["formControlName","fontColor","label",d],[3,"actions"]];},template:function(t,i){t&1&&(m(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input",2),_(4,"div",3),m(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),u(),m(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7)(9,"sz-ui-form-field-input",8),u()(),m(10,"sz-ui-dialog-actions",9)),t&2&&(a("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),a("formGroup",i.form),r(3),a("type","number"),r(),a("type","number"),r(2),a("type","number"),r(2),a("actions",i.actions));},dependencies:[x,O,D,I,v,F,M,R,$,U,X,B,k,G,z],encapsulation:2});let n=o;return n;})();var Ye=["designer"];function Ke(n,o){if(n&1&&m(0,"div"),n&2){let s=c();N(s.getMarginsStyle());}}function Je(n,o){if(n&1){let s=W();Q(0),_(1,"p",11),j("cdkDragEnded",function(t){h(s);let i=L(0),d=c(2);return C(d.drop(t,i));})("dblclick",function(){h(s);let t=L(0),i=c(2);return C(i.openSaveTextFieldComponent(t));}),le(2),u();}if(n&2){let s=c().$implicit,e=c(),t=Y(e.getTextField(s));r(),N(e.getFieldStyle(t)),a("id",e.getFieldId(t)),r(),de(t.text);}}function Ze(n,o){if(n&1){let s=W();Q(0),_(1,"img",12),me(2,"secure"),me(3,"async"),j("cdkDragEnded",function(t){h(s);let i=L(0),d=c(2);return C(d.drop(t,i));}),u();}if(n&2){let s=c().$implicit,e=c(),t=Y(e.getImageField(s));r(),N(e.getFieldStyle(t)),a("alt",t.name)("id",e.getFieldId(t))("src",_e(3,8,_e(2,6,t.url)),ye);}}function et(n,o){if(n&1){let s=W();Q(0),te(),_(1,"svg",13),j("cdkDragEnded",function(t){h(s);let i=L(0),d=c(2);return C(d.drop(t,i));})("dblclick",function(){h(s);let t=L(0),i=c(2);return C(i.openSaveBarcodeFieldComponent(t));}),m(2,"path"),u();}if(n&2){let s=c().$implicit,e=c(),t=Y(e.getBarcodeField(s));r(),N(e.getFieldStyle(t)),a("id",e.getFieldId(t)),J("width",t.width)("height",t.height),r(),J("d",e.getBarcodeFieldPath(t));}}function tt(n,o){if(n&1&&(_(0,"td"),le(1),u()),n&2){let s=o.$implicit,e=c(3);r(),de(e.getTableColumnName(s));}}function it(n,o){if(n&1){let s=W();Q(0),_(1,"table",14),j("cdkDragEnded",function(t){h(s);let i=L(0),d=c(2);return C(d.drop(t,i));}),_(2,"tr"),se(3,tt,2,1,"td",null,re),u()();}if(n&2){let s=c().$implicit,e=c(),t=Y(e.getTableField(s));r(),N(e.getFieldStyle(t)),a("id",e.getFieldId(t)),r(2),ae(t.columns);}}function ot(n,o){if(n&1){let s=W();Q(0),te(),_(1,"svg",15),j("cdkDragEnded",function(t){h(s);let i=L(0),d=c(2);return C(d.drop(t,i));}),m(2,"path"),u();}if(n&2){let s=c().$implicit,e=c(),t=Y(e.getLineField(s));r(),N(e.getFieldStyle(t)),a("id",e.getFieldId(t)),r(),J("d",e.getLineFieldPath(t))("stroke",t.lineColor)("stroke-width",t.lineWidth);}}function nt(n,o){if(n&1&&oe(0,Je,3,5,"p",6)(1,Ze,4,10,"img",7)(2,et,3,7,":svg:svg",8)(3,it,5,4,"table",9)(4,ot,3,7,":svg:svg",10),n&2){let s=o.$implicit;ne(s.type==="text"?0:s.type==="image"?1:s.type==="barcode"?2:s.type==="table"?3:s.type==="line"?4:-1);}}var Qe=(()=>{let o=class o{constructor(){this.route=p(Ae),this.dialog=p(Pe),this.srptService=p(Z),this.snackBar=p($e),this.template=this.route.snapshot.data.template,this.alert=Ne(void 0),this.fields=[],this.size={width:210,height:297,unit:"mm"},this.margins={top:14,right:14,bottom:14,left:14},this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:we.default([w.add().setSubItems([w.text(()=>this.openSaveTextFieldComponent()),w.barcode(()=>this.openSaveBarcodeFieldComponent()),w.image(()=>this.openSaveImageFieldComponent()),w.line(()=>this.openSaveLineFieldComponent())]).setTitle(),w.menu([w.reset(this.reset.bind(this))])])},this.margins=this.template.content?.margins??{top:14,right:14,bottom:14,left:14},this.fields=this.template.content?.fields??[];}drop(e,t){if(!e.distance)return;let i=t.x+H.round2Decimals(f.fromPixel(this.size.unit,e.distance.x)),d=t.y+H.round2Decimals(f.fromPixel(this.size.unit,e.distance.y)),S=H.round2Decimals(f.fromPixel(this.size.unit,e.source.element.nativeElement.offsetWidth)),q=H.round2Decimals(f.fromPixel(this.size.unit,e.source.element.nativeElement.offsetHeight));i<0?i=0:i+S>this.size.width&&(i=this.size.width-S),d<0?d=0:d+q>this.size.height&&(d=this.size.height-q),t.x=i,t.y=d,e.source._dragRef._initialTransform&&(e.source._dragRef._initialTransform=`translate3d(${f.toPixel(this.size.unit,i)}px, ${f.toPixel(this.size.unit,d)}px, 0)`),e.source._dragRef.reset(),this.fieldChanged(t);}getTemplateStyle(){return`width: ${this.size.width}${this.size.unit}; height: ${this.size.height}${this.size.unit}; position: relative;`;}getMarginsStyle(){return`position: absolute; 
    top: ${this.margins.top}${this.size.unit}; 
    right: ${this.margins.right}${this.size.unit}; 
    bottom: ${this.margins.bottom}${this.size.unit}; 
    left: ${this.margins.left}${this.size.unit};
    border: 1px dotted black;
    `;}getFieldStyle(e){let t=`translate3d(${f.toPixel(this.size.unit,e.x)}px, ${f.toPixel(this.size.unit,e.y)}px, 0)`;switch(e.type){case"text":{let i=e;return`position: absolute; transform: ${t}; font-size: ${i.fontSize}px; color: ${i.fontColor}; text-align: ${i.textAlign};`;}case"image":{let i=e;return`position: absolute; transform: ${t}; width: ${i.width}${this.size.unit}; height: ${i.height}${this.size.unit};`;}case"barcode":{let i=e;return`position: absolute; transform: ${t};`;}case"table":{let i=e;return`position: absolute; transform: ${t};width:${i.x2-i.x};`;}case"line":return"position: absolute;";}return"";}getFieldId(e){return this.template.id+"-"+e.name;}getTextField(e){return e;}getImageField(e){return e;}getBarcodeField(e){return e;}getBarcodeFieldPath(e){let t=null;return e.barcodeType==="qr"&&(t=ee.qr(e.value)),e.barcodeType==="datamatrix"&&(t=ee.datamatrix(e.value,!1)),t?ue.toPath(t):"";}getTableField(e){return e;}getTableColumnName(e){return typeof e=="string"?e:typeof e=="number"?e.toString():e.key?.toString()??"";}getLineField(e){return e;}getLineFieldPath(e){return`M${f.toPixel(this.size.unit,e.x)},${f.toPixel(this.size.unit,e.y)} L${f.toPixel(this.size.unit,e.x2)},${f.toPixel(this.size.unit,e.y2)}`;}openSaveTextFieldComponent(e){this.dialog.open(je,{data:e}).afterClosed().subscribe(t=>{t&&(e?e=t:this.fields.push(t),this.save());});}openSaveBarcodeFieldComponent(e){this.dialog.open(qe,{data:e}).afterClosed().subscribe(t=>{t&&(e?e=t:this.fields.push(t),this.save());});}openSaveImageFieldComponent(e){this.dialog.open(He,{data:e}).afterClosed().subscribe(t=>{t&&(e?e=t:this.fields.push(t),this.save());});}openSaveLineFieldComponent(e){this.dialog.open(We,{data:e}).afterClosed().subscribe(t=>{t&&(e?e=t:this.fields.push(t),this.save());});}fieldChanged(e){this.save();}fieldDeleted(e){this.fields=this.fields.filter(t=>t.name!==e.name);}reset(){this.fields=[],this.fields=this.template.baseTemplate.content?.fields??[],this.save();}save(){this.srptService.templates.update(this.template.id,Se(Me({},this.template),{content:{fields:this.fields,margins:this.margins}})).subscribe(()=>{this.snackBar.open(pe.saved,pe.close,{duration:5e3});});}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(t,i){if(t&1&&Le(Ye,5),t&2){let d;De(d=Ie())&&(i.designerEl=d.first);}},standalone:!0,features:[g([Z]),T],decls:8,vars:5,consts:[["designer",""],[3,"config"],[3,"alert"],[1,"container"],["dir","ltr",1,"designer"],[3,"style"],["cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"alt","id","style","src"],["viewbox","0 0 25 25","xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"id","style"],["xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","dblclick","id"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"cdkDragEnded","alt","id","src"],["viewbox","0 0 25 25","xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","dblclick","id"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"cdkDragEnded","id"],["xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","id"]],template:function(t,i){t&1&&(m(0,"sz-ui-app-bar",1)(1,"sz-ui-alert",2),_(2,"div",3)(3,"div",4,0),oe(5,Ke,1,2,"div",5),se(6,nt,5,1,null,null,re),u()()),t&2&&(a("config",i.appBarConfig),r(),a("alert",i.alert()),r(2),N(i.getTemplateStyle()),r(2),ne(i.margins?5:-1),r(),ae(i.fields));},dependencies:[M,xe,Re,ke,Be,Xe,Ve,be,ze,Ue,Oe],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;background-color:#fff;position:relative}table[_ngcontent-%COMP%]{font-family:arial,sans-serif;border-collapse:collapse}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left}"]});let n=o;return n;})();var Gi=[{path:"",component:Qe}];export{Gi as default};/**i18n:9054193bb4dcc24d51a6dba534830e37dcd91e77a8a9ecb6b346a792eb872c67*/