import{a as S}from"./chunk-J2TWCSA2.js";import"./chunk-RCNXVE6U.js";import{a as w,b as x,c as j,e as k,f as X,g as Y,h as U}from"./chunk-QPK5DCJC.js";import{c as W}from"./chunk-VAFOXX63.js";import{b as Q}from"./chunk-W4UR2Y35.js";import{a as K}from"./chunk-4PE74OIY.js";import{a as q,b as J}from"./chunk-LCA4CFDM.js";import{a as H,b as V}from"./chunk-HXWKRRDN.js";import{i as F}from"./chunk-QBI5CVQV.js";import{d as s,f as y,g as E,k as b,m as z,p as G,r as R,t as D}from"./chunk-CAQG4OA2.js";import"./chunk-SRJCWGFD.js";import{c as M}from"./chunk-UR27RSXA.js";import{a as P,c as B}from"./chunk-PPOSM6EZ.js";import{ha as $,ia as A}from"./chunk-RUNZ2J3E.js";import"./chunk-62NYPPVD.js";import{$a as C,Cb as a,Db as m,Eb as c,Ob as N,Qb as O,a as L,db as g,eb as n,ec as p,hc as h,ka as f,ob as v,sb as _,xb as T,yc as I}from"./chunk-34MB7EVY.js";import{f as u}from"./chunk-NWZBVKCY.js";function ot(r,o){r&1&&c(0,"mat-progress-bar",11);}var yt=(()=>{let o=class o{constructor(t,e,i,l){this.locale=t,this.fb=e,this.router=i,this.authService=l,this.alert=C(void 0),this.indicator=C(!1),this.loginStorage="medisy-portal-login",this.subscriptions=new L();let{email:d,organization:Z}=this.loadLoginData();this.form=this.fb.group({email:[d,[s.required,s.minLength(1),s.email]],organization:[Z,[s.required,s.minLength(3),s.maxLength(255)]]}),this.subscribeChanges();}ngOnDestroy(){this.subscriptions.unsubscribe();}subscribeChanges(){this.subscriptions.add(this.form.controls.email.valueChanges.subscribe(t=>{this.emailChanged(t);}));}emailChanged(t){let e=t.indexOf("@");if(e>0){let i=t.indexOf(".",e);this.form.controls.organization.setValue(t.substring(e+1,i>0?i:t.length));}}login(){return u(this,null,function*(){if(this.form&&!this.form.valid)return Object.keys(this.form.controls).forEach(e=>{this.form.get(e)?.markAsTouched({onlySelf:!0});}),!1;this.indicator.set(!0);let t=this.authService.storage.set({realm:this.form.value.organization,username:this.form.value.email});return yield this.authInitialize(t),this.indicator.set(!1),!0;});}saveLoginData(){localStorage.setItem(this.loginStorage,JSON.stringify({email:this.form.value.email,organization:this.form.value.organization}));}loadLoginData(){try{let t=localStorage.getItem(this.loginStorage);if(t)return JSON.parse(t);}catch(t){console.log(t);}return{email:"",organization:""};}authInitialize(t){return u(this,null,function*(){try{if(yield this.authService.initialize(t)){this.router.navigate(["/"]);return;}this.saveLoginData(),yield this.authService.login({loginHint:t.username,locale:this.locale,redirectUri:this.authService.getAuthRedirectUri()});}catch{this.alert.set({message:"Faield to login",type:K.Error,timeout:5e3});}});}};o.ɵfac=function(e){return new(e||o)(n(I),n(R),n(M),n(S));},o.ɵcmp=f({type:o,selectors:[["sz-identity-auth-login"]],standalone:!0,features:[p([]),h],decls:18,vars:4,consts:()=>{let t;t="\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644";let e;e="\u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0627\u0644\u0643\u062A\u0631\u0648\u0646\u064A";let i;i="\u0627\u0644\u0645\u0646\u0638\u0645\u0629";let l;return l="\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644",[[1,"content-center"],["svgIcon","logo",1,"logo"],[1,"tw-m-2"],t,[2,"padding","16px"],[3,"alert"],[3,"formGroup","keyup.enter"],["formControlName","email","label",e],["formControlName","organization","label",i],["mat-button","",1,"button-submit",3,"disabled","click"],l,["mode","indeterminate"]];},template:function(e,i){e&1&&(a(0,"div",0),c(1,"mat-icon",1),a(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title"),N(5,3),m()(),a(6,"mat-card-content",4),c(7,"sz-ui-alert",5),a(8,"form",6),O("keyup.enter",function(){return i.login();}),c(9,"sz-ui-form-field-input",7)(10,"sz-ui-form-field-input",8),m(),c(11,"mat-divider"),m(),a(12,"mat-card-actions")(13,"button",9),O("click",function(){return i.login();}),a(14,"span"),N(15,10),m()()(),a(16,"mat-card-footer"),v(17,ot,1,0,"mat-progress-bar",11),m()()()),e&2&&(g(7),_("alert",i.alert()),g(),_("formGroup",i.form),g(5),_("disabled",i.indicator()),g(4),T(17,i.indicator()?17:-1));},dependencies:[D,b,y,E,z,G,U,w,k,j,Y,X,x,J,q,F,A,$,V,H,B,P,Q,W],styles:[".content-center[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.logo[_ngcontent-%COMP%]{width:128px;height:128px;transform:scale(2);margin:16px}.button-submit[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{text-align:center;margin:16px 0;font-size:12px;cursor:pointer}"]});let r=o;return r;})();var At=(()=>{let o=class o{constructor(t,e,i){this.locale=t,this.router=e,this.identityService=i;}ngOnInit(){return u(this,null,function*(){let t=this.identityService.storage.get();if(!t){this.router.navigate(["/auth/login"]);return;}if(yield this.identityService.initialize(t)){this.router.navigate(["/"]);return;}yield this.identityService.login({loginHint:t.username,locale:this.locale,redirectUri:this.identityService.getAuthRedirectUri()});});}};o.ɵfac=function(e){return new(e||o)(n(I),n(M),n(S));},o.ɵcmp=f({type:o,selectors:[["sz-identity-auth-redirect"]],standalone:!0,features:[p([]),h],decls:0,vars:0,template:function(e,i){},encapsulation:2});let r=o;return r;})();export{yt as SzAuthLoginComponent,At as SzAuthRedirectComponent};/**i18n:34a0aca9a8a7a5b54ef908b3a50021d42a3fb6a7b58cfe4980f9bcbab369501e*/