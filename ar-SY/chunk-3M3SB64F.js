import{c as $}from"./chunk-BJYZ6EWO.js";import{a as B}from"./chunk-LCU6ACMZ.js";import{h as ye}from"./chunk-IGSRBC3T.js";import"./chunk-JX57I4IE.js";import"./chunk-SEQWES4Y.js";import"./chunk-ZCO6OMXC.js";import{d as Ie,e as Y}from"./chunk-3FGMTWPX.js";import{f as P,g as z,h as G,k as b}from"./chunk-YKMXQFDH.js";import"./chunk-WUVRWIHU.js";import{b as ge}from"./chunk-IK4KAOW7.js";import{a as y,b as R,d as ce,e as A,g as T}from"./chunk-HQFAQEC3.js";import{c as F,r as Ce,u as v}from"./chunk-IITPHOLL.js";import"./chunk-JPBZ5DSJ.js";import"./chunk-G7AMUACM.js";import{i as D}from"./chunk-N4OOJIAX.js";import{d as l,f as g,g as C,l as N,n as h,q as L,r as O,t as I}from"./chunk-GLZMJYJP.js";import{b as V,c as Le}from"./chunk-QOXR5OPH.js";import{a as Oe}from"./chunk-NC2TMKBF.js";import{c as Ne,d as he}from"./chunk-OYBNPCR5.js";import"./chunk-ZYAQ56NI.js";import{a as Q}from"./chunk-GM2OQK6E.js";import"./chunk-K5FLVMR2.js";import{p as Se}from"./chunk-T4KI57OL.js";import"./chunk-MOGYN3JD.js";import"./chunk-ATJMWBRY.js";import{Ja as U,Ma as H,ja as Te,r as Me}from"./chunk-UEBH5A2M.js";import{Ea as se,Fb as me,Hb as pe,Ib as Ee,Jb as p,K as ne,Kb as E,Lb as s,Pb as fe,Wb as ue,Yb as k,ac as X,bb as a,bc as w,cc as q,ib as de,ja as _,mb as c,mc as M,na as u,nc as S,wa as le,xa as ae,yb as n,zb as _e}from"./chunk-6J2YPVJB.js";import{a as oe,b as re}from"./chunk-TH7MQ6T4.js";var Re=(()=>{let r=class r{constructor(){this.httpClient=_(Me),this.viewContainerRef=_(de),this.element=null,this.isMoving=!1,this.changed=new se();}ngAfterViewInit(){this.render();}render(){console.log("render",this.field),this.field.type==="text"?this.addTextField(this.field):this.field.type==="barcode"?this.addBarcodeField(this.field):this.field.type==="table"?this.addTableField(this.field):this.field.type==="line"?this.addLineField(this.field):this.field.type==="image"&&this.addImageField(this.field);}getContainerElement(){return this.viewContainerRef.element.nativeElement;}addTextField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("p");o.innerText=e.text,o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,o.style.fontSize=`${e.fontSize}px`,o.style.color=e.fontColor??"black",t.appendChild(o),this.addMouseEvents(o);}addBarcodeField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=null;if(e.barcodeType==="qr"&&(o=Y.qr(e.value)),e.barcodeType==="datamatrix"&&(o=Y.datamatrix(e.value,!1)),!o)return;let m=Ie.toSVG(o,e.options);m&&(m.style.position="absolute",m.style.left=`${this.getRelativeSize(e.x)}px`,m.style.top=`${this.getRelativeSize(e.y)}px`,m.style.width=`${this.getRelativeSize(e.width??18)}px`,m.style.height=`${this.getRelativeSize(e.height??18)}px`,t.appendChild(m));}addTableField(i){if(!i)return;let t=this.getContainerElement();}addLineField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("div");o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,o.style.width=`${this.getRelativeSize(e.x2-e.x)}px`,o.style.height=`${this.getRelativeSize(e.y2-e.y)}px`,o.style.borderBottom=`${e.lineWidth??1}px solid ${e.lineColor??"black"}`,t.appendChild(o),this.addMouseEvents(o);}addImageField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("img");o.alt="",this.httpClient.get(e.url,{responseType:"blob"}).pipe(ne(1)).subscribe(m=>{let f=new FileReader();f.onloadend=()=>{o.src=f.result;},f.readAsDataURL(m);}),o.style.position="absolute",o.style.left=`${this.getRelativeSize(e.x)}px`,o.style.top=`${this.getRelativeSize(e.y)}px`,o.style.width=`${this.getRelativeSize(e.width)}px`,o.style.height=`${this.getRelativeSize(e.height)}px`,t.appendChild(o),this.addMouseEvents(o);}addMouseEvents(i){let e=0,t=0;i.addEventListener("mousedown",f=>{f.button===0&&(this.isMoving=!0,e=i.offsetLeft-f.clientX,t=i.offsetTop-f.clientY,i.style.cursor="move",document.addEventListener("mousemove",o),document.addEventListener("mouseup",m));});let o=f=>{if(!this.isMoving)return;let te=f.clientX+e,ie=f.clientY+t;i.style.left=`${te}px`,i.style.top=`${ie}px`,this.field.x=te/this.scale,this.field.y=ie/this.scale;},m=()=>{this.isMoving=!1,i.style.cursor="hand",document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",m),this.changed?.emit(this.field);};}onRightClick(i){i.preventDefault(),this.matMenuTrigger.openMenu();}getRelativeSize(i){return i*this.scale;}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template-field"]],viewQuery:function(e,t){if(e&1&&X(Ne,7),e&2){let o;w(o=q())&&(t.matMenuTrigger=o.first);}},inputs:{field:"field",scale:"scale"},outputs:{changed:"changed"},standalone:!0,features:[M([B]),S],decls:0,vars:0,template:function(e,t){},dependencies:[T,H,he,U],encapsulation:2});let d=r;return d;})();var Ae=(()=>{let r=class r extends P{constructor(){let i=_(y);super(i),this.fb=_(O),this.data=_(R),this.barcodeTypes=["qr","datamatrix"];let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_barcode1",[l.required]],type:["barcode",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],value:[t?.value??"",[l.required]],barcodeType:[t?.barcodeType??"qr",[l.required]],width:[t?.width??16,[l.required]],height:[t?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template-barcode-field"]],standalone:!0,features:[M([]),c,S],decls:13,vars:10,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0642\u064A\u0645\u0629";let t;t="\u0627\u0644\u0646\u0645\u0637";let o;o="\u0627\u0644\u0639\u0631\u0636";let m;return m="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],["formControlName","value","label",e],["formControlName","barcodeType","label",t,3,"source"],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",o,3,"type"],["formControlName","height","label",m,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(s(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),s(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-select",4),p(6,"div",5),s(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7),E(),p(9,"div",5),s(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),E()()(),s(12,"sz-ui-dialog-actions",10)),e&2&&(n("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),a(2),n("formGroup",t.form),a(3),n("source",t.barcodeTypes),a(2),n("type","number"),a(),n("type","number"),a(2),n("type","number"),a(),n("type","number"),a(),n("actions",t.actions));},dependencies:[I,N,g,C,h,L,T,A,D,$,b,z,G,v,F,Ce],encapsulation:2});let d=r;return d;})();var De=(()=>{let r=class r extends P{constructor(){let i=_(y);super(i),this.fb=_(O),this.data=_(R);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_image1",[l.required]],type:["image",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],url:[t?.url??"",[l.required]],width:[t?.width??16,[l.required]],height:[t?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template-image-field"]],standalone:!0,features:[M([]),c,S],decls:11,vars:9,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0639\u0631\u0636";let t;return t="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",e,3,"type"],["formControlName","height","label",t,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(s(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),s(3,"sz-ui-form-field-input",2),p(4,"div",3),s(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),E(),p(7,"div",3),s(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),E()()(),s(10,"sz-ui-dialog-actions",8)),e&2&&(n("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),a(2),n("formGroup",t.form),a(3),n("type","number"),a(),n("type","number"),a(2),n("type","number"),a(),n("type","number"),a(),n("actions",t.actions));},dependencies:[I,N,g,C,h,L,T,A,D,$,b,z,G,v,F],encapsulation:2});let d=r;return d;})();var Fe=(()=>{let r=class r extends P{constructor(){let i=_(y);super(i),this.fb=_(O),this.data=_(R);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_line1",[l.required]],type:["line",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],lineWidth:[t?.lineWidth??16,[l.required]],lineColor:[t?.lineColor??"#000",[l.required]],x2:[t?.x2??0,[l.required]],y2:[t?.y2??0,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template-line-field"]],standalone:!0,features:[M([]),c,S],decls:13,vars:10,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="Color";let t;return t="\u0627\u0644\u0639\u0631\u0636",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","x2","label","X2",3,"type"],["formControlName","y2","label","Y2",3,"type"],["formControlName","lineColor","label",e],["formControlName","lineWidth","label",t,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(s(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),s(3,"sz-ui-form-field-input",2),p(4,"div",3),s(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),E(),p(7,"div",3),s(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),E(),s(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),E()(),s(12,"sz-ui-dialog-actions",10)),e&2&&(n("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),a(2),n("formGroup",t.form),a(3),n("type","number"),a(),n("type","number"),a(2),n("type","number"),a(),n("type","number"),a(2),n("type","number"),a(),n("actions",t.actions));},dependencies:[I,N,g,C,h,L,T,A,D,$,b,z,G,v,F],encapsulation:2});let d=r;return d;})();var ve=(()=>{let r=class r extends P{constructor(){let i=_(y);super(i),this.fb=_(O),this.data=_(R);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_text1",[l.required]],type:["text",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],text:[t?.text??"",[l.required]],fontSize:[t?.fontSize??12,[l.required]],fontColor:[t?.fontColor??"#000",[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template-text-field"]],standalone:!0,features:[M([]),c,S],decls:11,vars:8,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0646\u0635";let t;t="\u062D\u062C\u0645 \u0627\u0644\u062E\u0637";let o;return o="Font Color",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","text","label",e],["formControlName","fontSize","label",t,3,"type"],["formControlName","fontColor","label",o],[3,"actions"]];},template:function(e,t){e&1&&(s(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),s(3,"sz-ui-form-field-input",2),p(4,"div",3),s(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),E(),s(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7)(9,"sz-ui-form-field-input",8),E()(),s(10,"sz-ui-dialog-actions",9)),e&2&&(n("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),a(2),n("formGroup",t.form),a(3),n("type","number"),a(),n("type","number"),a(2),n("type","number"),a(2),n("actions",t.actions));},dependencies:[I,N,g,C,h,L,T,A,D,$,b,z,G,v,F],encapsulation:2});let d=r;return d;})();var ze=["designer"];function Ge(d,r){if(d&1){let W=fe();p(0,"sz-mgmt-reporting-template-field",5),ue("changed",function(e){le(W);let t=k();return ae(t.fieldChanged(e));}),E();}if(d&2){let W=r.$implicit,i=k();n("field",W)("scale",i.scale);}}var Pe=(()=>{let r=class r{constructor(){this.route=_(Se),this.dialog=_(ce),this.srptService=_(B),this.snackBar=_(ge),this.template=this.route.snapshot.data.template,this.fields=[],this.size={width:210,height:297},this.scale=3,this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:Le.default().setItems([V.menu([V.text(this.openSaveTextFieldComponent.bind(this)),V.barcode(this.openSaveBarcodeFieldComponent.bind(this)),V.image(this.openSaveImageFieldComponent.bind(this)),V.line(this.openSaveLineFieldComponent.bind(this))])])};}ngAfterViewInit(){this.refresh();}refresh(){this.fields=this.template.content?.fields??[];}getRelativeSize(i){return i*this.scale;}openSaveTextFieldComponent(){this.dialog.open(ve).afterClosed().subscribe(i=>{i&&this.fields.push(i);});}openSaveBarcodeFieldComponent(){this.dialog.open(Ae).afterClosed().subscribe(i=>{i&&this.fields.push(i);});}openSaveImageFieldComponent(){this.dialog.open(De).afterClosed().subscribe(i=>{i&&this.fields.push(i);});}openSaveLineFieldComponent(){this.dialog.open(Fe).afterClosed().subscribe(i=>{i&&this.fields.push(i);});}fieldChanged(i){this.fields=this.fields.map(e=>e.name===i.name?i:e),this.save();}save(){this.srptService.templates.update(this.template.id,re(oe({},this.template),{content:{fields:this.fields}})).subscribe(()=>{this.snackBar.open(Q.saved,Q.close,{duration:5e3});});}};r.ɵfac=function(e){return new(e||r)();},r.ɵcmp=u({type:r,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(e,t){if(e&1&&X(ze,5),e&2){let o;w(o=q())&&(t.designerEl=o.first);}},standalone:!0,features:[M([B]),S],decls:6,vars:5,consts:[["designer",""],[3,"config"],[1,"container"],["dir","ltr",1,"designer"],[3,"field","scale"],[3,"changed","field","scale"]],template:function(e,t){e&1&&(s(0,"sz-ui-app-bar",1),p(1,"div",2)(2,"div",3,0),pe(4,Ge,1,2,"sz-mgmt-reporting-template-field",4,me),E()()),e&2&&(n("config",t.appBarConfig),a(2),_e("width",t.getRelativeSize(t.size.width),"px")("height",t.getRelativeSize(t.size.height),"px"),a(2),Ee(t.fields));},dependencies:[T,Te,H,ye,Oe,U,Re],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;padding:10px;margin:10px;background-color:#fff;position:relative}"]});let d=r;return d;})();var ii=[{path:"",component:Pe}];export{ii as default};/**i18n:418516e83c39d18f4d4383e7e7094a47a2de32f450262c69abd400e2ff999647*/