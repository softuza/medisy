import{c as x}from"./chunk-KMP2U6LH.js";import{c as re,d as ne,e as p,h as se,i as ae}from"./chunk-XXXKE776.js";import"./chunk-IQ2VNTDW.js";import"./chunk-ODMA64W5.js";import"./chunk-OBR4MROT.js";import{c as ie,g as P,h as V,i as G,k as oe,l as $}from"./chunk-WNELB757.js";import{b as ee,c as te}from"./chunk-ASXUHVJK.js";import{b as Y}from"./chunk-T6NPNV3U.js";import{a as I,b as Z,d as q,e as L,g as A}from"./chunk-U3H7W2BJ.js";import{c as Q,t as J,u as W,v as w}from"./chunk-RZVXFLAF.js";import"./chunk-YJEUB3NB.js";import"./chunk-GCAF7ZOT.js";import{j as R}from"./chunk-ELOLLYFG.js";import{d as C,f as y,g as D,l as E,o as F,r as T,s as O,u as N}from"./chunk-KMQC4JE3.js";import{b as l,c as B}from"./chunk-IRFYFKUD.js";import"./chunk-K4QJOSSB.js";import"./chunk-4ID3KVX3.js";import"./chunk-7TYFREJF.js";import"./chunk-BKHR7P2T.js";import{a as z}from"./chunk-5COP62WY.js";import"./chunk-VFFUX6UX.js";import"./chunk-ZZ5V4A5R.js";import"./chunk-25BHX2H2.js";import{b as X,r as K}from"./chunk-BKKXZCD4.js";import{Jb as u,Kb as f,Lb as m,Wb as b,bb as c,da as v,ia as H,ja as n,mb as M,mc as S,na as h,nc as _,yb as s}from"./chunk-5UGT7ICT.js";import"./chunk-KKIINILB.js";var j=class{constructor(t,a){this._document=a;let e=this._textarea=this._document.createElement("textarea"),i=e.style;i.position="fixed",i.top=i.opacity="0",i.left="-999em",e.setAttribute("aria-hidden","true"),e.value=t,e.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(e);}copy(){let t=this._textarea,a=!1;try{if(t){let e=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),a=this._document.execCommand("copy"),e&&e.focus();}}catch{}return a;}destroy(){let t=this._textarea;t&&(t.remove(),this._textarea=void 0);}},le=(()=>{let t=class t{constructor(e){this._document=e;}copy(e){let i=this.beginCopy(e),o=i.copy();return i.destroy(),o;}beginCopy(e){return new j(e,this._document);}};t.ɵfac=function(i){return new(i||t)(H(X));},t.ɵprov=v({token:t,factory:t.ɵfac,providedIn:"root"});let r=t;return r;})();var k=class extends ee{constructor(t,a){super(t,`${a}/v1/files`),this.http=t,this.basePath=a;}upload(t){let a=new FormData();return a.append("file",t),this.http.post(this.path,a);}download(t){return this.http.get(`${this.path}/${t}/download`,{responseType:"blob"});}};var d=(()=>{let t=class t extends te{constructor(){let e=n(K);super(e,"softuza-drive"),this.files=new k(this.http,this.basePath);}};t.ɵfac=function(i){return new(i||t)();},t.ɵprov=v({token:t,factory:t.ɵfac});let r=t;return r;})();var de=(()=>{let t=class t extends P{constructor(){super(n(I)),this.sdrvService=n(d),this.fb=n(O),this.data=n(Z);let e=this.fb,i=this.data;this.form=e.group({name:[i?.name,[C.required]],description:[i?.description,[C.maxLength(4096)]]});}submit(){this.IsValid()&&(this.data?this.save(this.sdrvService.files.update(this.data.id,this.form.value)):this.save(this.sdrvService.files.create(this.form.value)));}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files-save"]],standalone:!0,features:[S([d]),M,_],decls:6,vars:5,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let i;return i="\u0627\u0644\u0648\u0635\u0641",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],["formControlName","description","label",i],[3,"actions"]];},template:function(i,o){i&1&&(m(0,"sz-ui-dialog-header",0),u(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-input-text",2)(4,"sz-ui-form-field-textarea",3),f()(),m(5,"sz-ui-dialog-actions",4)),i&2&&(s("title",o.title)("subtitle",o.subtitle)("alert",o.alert()),c(2),s("formGroup",o.form),c(3),s("actions",o.actions));},dependencies:[N,E,y,D,F,T,A,L,R,x,$,V,G,w,Q,J],encapsulation:2});let r=t;return r;})();var ce=(()=>{let t=class t extends P{constructor(){super(n(I)),this.sdrvService=n(d),this.fb=n(O),this.fileName="Select File";let e=this.fb;this.form=e.group({file:[null,[C.required]]});}submit(){this.IsValid()&&this.save(this.sdrvService.files.upload(this.form.value.file));}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files-upload"]],standalone:!0,features:[S([d]),M,_],decls:5,vars:5,consts:()=>{let e;return e="\u0645\u0644\u0641",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","file","label",e],[3,"actions"]];},template:function(i,o){i&1&&(m(0,"sz-ui-dialog-header",0),u(1,"mat-dialog-content")(2,"form",1),m(3,"sz-ui-form-field-file-upload",2),f()(),m(4,"sz-ui-dialog-actions",3)),i&2&&(s("title",o.title)("subtitle",o.subtitle)("alert",o.alert()),c(2),s("formGroup",o.form),c(2),s("actions",o.actions));},dependencies:[N,E,y,D,F,T,A,L,R,x,$,V,G,w,W],encapsulation:2});let r=t;return r;})();var me=(()=>{let t=class t{constructor(){this.dialog=n(q),this.sdrvService=n(d),this.clipboard=n(le),this.snakbar=n(Y),this.environment=n("environment"),this.dataSource=new se(),this.appBarConfig={title:z.files,menu:B.default([l.upload(this.openUploadComponent.bind(this)),l.menu([l.search()])])},this.dataSource.columnDefs.push(p.uuid("id"),p.string("name").setValueClassFontBold().setStacked(p.string("description").setValueClassFontSmall()),p.number("size").setValueGetter(e=>this.formatSize(e.size)),p.date("createdAt").setVisible(!1),p.date("updatedAt").setVisible(!1),p.menu(B.default([l.download(this.download.bind(this)).setTooltip(z.download),l.menu([l.edit(this.openSaveComponent.bind(this)),l.copyLink(this.copyLink.bind(this)),l.divider(),l.delete(this.openFileDeleteComponent.bind(this))])])).clearClass().setClassEnd()),this.get();}formatSize(e){return e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`;}openUploadComponent(){this.dialog.open(ce).afterClosed().subscribe(e=>{this.dataSource.add(e);});}openSaveComponent(e){this.dialog.open(de,{data:e}).afterClosed().subscribe(i=>{this.dataSource.addOrUpdateItem(i);});}openFileDeleteComponent(e){this.dialog.open(oe,{data:ie.delete(this.sdrvService.files.delete(e.id),e)}).afterClosed().subscribe(i=>{this.dataSource.delete(i);});}download(e){this.sdrvService.files.download(e.id).subscribe(i=>{let o=window.URL.createObjectURL(i),g=document.createElement("a");g.href=o,g.download=e.name,g.click(),window.URL.revokeObjectURL(o);});}copyLink(e){this.clipboard.copy(`${this.environment.apiUrl}/${this.sdrvService.files.getPath()}/${e.id}/download`),this.snakbar.open(z.copied,"Close");}get(){this.sdrvService.files.get(this.dataSource.getQuery()).pipe(ae(this.dataSource.state)).subscribe(e=>{this.dataSource.set(e.items,e.count);});}};t.ɵfac=function(i){return new(i||t)();},t.ɵcmp=h({type:t,selectors:[["sz-mgmt-drive-files"]],standalone:!0,features:[S([d]),_],decls:2,vars:3,consts:[[3,"changed","config","dataSource"],[3,"update","dataSource"]],template:function(i,o){i&1&&(u(0,"sz-ui-table-bar",0),b("changed",function(){return o.get();}),f(),u(1,"sz-ui-table",1),b("update",function(){return o.get();}),f()),i&2&&(s("config",o.appBarConfig)("dataSource",o.dataSource),c(),s("dataSource",o.dataSource));},dependencies:[re,ne],encapsulation:2});let r=t;return r;})();var St=[{path:"",component:me}];export{St as default};/**i18n:52dae1015fb4dcd24d02f3b60578855a39e5cc5be32446a479305eae917c802c*/