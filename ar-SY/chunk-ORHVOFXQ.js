import{c as V}from"./chunk-JU6G7WY7.js";import{a as B}from"./chunk-KOAP3VZE.js";import{h as De}from"./chunk-OXRQMKWM.js";import"./chunk-KOIFZFYQ.js";import"./chunk-FGTGSOAR.js";import"./chunk-UNIXAK7Y.js";import{d as Ae,e as ee}from"./chunk-VJUFY4S4.js";import{f as P,g as $,h as G,k as z}from"./chunk-SUDEA3ZD.js";import"./chunk-YK2PX5QX.js";import{b as ge}from"./chunk-TGD5BZND.js";import{a as I,b as A,d as he,e as D,g as T}from"./chunk-LHDD56EO.js";import{c as R,r as Ne,u as v}from"./chunk-JXN2RMSW.js";import{b as Ce}from"./chunk-WLJTJUVP.js";import"./chunk-YGAFJZ7Z.js";import{i as F}from"./chunk-HRBXQQVZ.js";import{d as l,f as h,g,l as C,o as N,r as L,s as O,u as y}from"./chunk-ZQUZU4XO.js";import{b,c as ye}from"./chunk-OI5AACQA.js";import{a as Ie}from"./chunk-NHU77WIY.js";import{c as Le,d as Oe}from"./chunk-LF2RU7KH.js";import"./chunk-N6NVQX4I.js";import{a as Z}from"./chunk-LUJYMJYX.js";import"./chunk-O4YYKVE3.js";import{p as Te}from"./chunk-CW6KZCE3.js";import"./chunk-M7BJRASY.js";import"./chunk-YSDVWZ3Z.js";import{Ja as H,Ma as Q,ja as Se,r as ce}from"./chunk-Q5W6FVW4.js";import{Bb as _e,Ea as J,Fb as pe,Hb as ue,Ib as fe,Jb as p,K as ae,Kb as f,Lb as a,Pb as Ee,Wb as Me,Yb as U,ac as q,bb as s,bc as k,cc as W,ib as de,ja as m,kb as me,mb as S,mc as M,na as E,nc as c,wa as j,xa as K,yb as r}from"./chunk-AK7FB3RI.js";import{a as le,b as se}from"./chunk-ZA5F7ID5.js";var Fe=(()=>{let n=class n{constructor(){this.httpClient=m(ce),this.viewContainerRef=m(de),this.element=null,this.isMoving=!1,this.changed=new J(),this.deleted=new J();}ngAfterViewInit(){this.render();}render(){console.log("render",this.field),this.field.type==="text"?this.addTextField(this.field):this.field.type==="barcode"?this.addBarcodeField(this.field):this.field.type==="table"?this.addTableField(this.field):this.field.type==="line"?this.addLineField(this.field):this.field.type==="image"&&this.addImageField(this.field);}getContainerElement(){return this.viewContainerRef.element.nativeElement;}addTextField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("p");o.innerText=e.text,o.style.position="absolute",o.style.left=`${e.x}${this.unit}`,o.style.top=`${e.y}${this.unit}`,o.style.fontSize=`${e.fontSize}`,o.style.color=e.fontColor??"black",o.style.textAlign=e.textAlign??"left",t.appendChild(o),this.addMouseEvents(o);}addBarcodeField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("div");o.style.position="absolute",o.style.left=`${e.x}${this.unit}`,o.style.top=`${e.y}${this.unit}`,o.style.width=`${e.width}${this.unit}`,o.style.height=`${e.height}${this.unit}`,t.appendChild(o);let _=null;if(e.barcodeType==="qr"&&(_=ee.qr(e.value)),e.barcodeType==="datamatrix"&&(_=ee.datamatrix(e.value,!1)),!_)return;let u=Ae.toSVG(_,e.options);u&&(u.style.width=`${e.width??18}${this.unit}`,u.style.height=`${e.height??18}${this.unit}`,o.appendChild(u),this.addMouseEvents(o));}addTableField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("table");o.style.position="absolute",o.style.left=`${e.x}${this.unit}`,o.style.top=`${e.y}${this.unit}`,o.style.right=`${e.x2}${this.unit}`,o.style.bottom=`${e.y2}${this.unit}`,o.style.borderCollapse="collapse",o.style.border="1px solid black";let _=document.createElement("thead"),u=document.createElement("tr");e.columns.forEach(x=>{let Y=document.createElement("th");Y.innerText=typeof x=="string"?x:typeof x=="number"?x.toString():x.key?.toString()??"",Y.style.width="auto",u.appendChild(Y);}),_.appendChild(u),o.appendChild(_),t.appendChild(o);}addLineField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("version","1.1"),o.setAttribute("x",`${e.x}${this.unit}`),o.setAttribute("y",`${e.y}${this.unit}`),o.setAttribute("width",`${e.x2}${this.unit}`),o.setAttribute("height",`${e.y2}${this.unit}`),o.setAttribute("style","position: absolute;"),o.innerHTML=`<line x1="${e.x}${this.unit}" y1="${e.y}${this.unit}" x2="${e.x2}${this.unit}" y2="${e.y2}${this.unit}" style="stroke:${e.lineColor??"black"};stroke-width:${this.convertUnitToPixel(e.lineWidth)??1}" />`,t.appendChild(o);}addImageField(i){let e=i;if(!e)return;let t=this.getContainerElement(),o=document.createElement("img");o.alt="",this.httpClient.get(e.url,{responseType:"blob"}).pipe(ae(1)).subscribe(_=>{let u=new FileReader();u.onloadend=()=>{o.src=u.result;},u.readAsDataURL(_);}),o.style.position="absolute",o.style.left=`${e.x}${this.unit}`,o.style.top=`${e.y}${this.unit}`,o.style.width=`${e.width}${this.unit}`,o.style.height=`${e.height}${this.unit}`,t.appendChild(o),this.addMouseEvents(o),console.log("addBarcodeField",o);}addMouseEvents(i){let e=0,t=0;i.addEventListener("mousedown",o=>{o.button===0&&(this.isMoving=!0,e=this.convertPixelToUnit(i.offsetLeft)-this.convertPixelToUnit(o.clientX),t=this.convertPixelToUnit(i.offsetTop)-this.convertPixelToUnit(o.clientY),console.log("mousedown",e,t),i.style.cursor="grabbing",document.addEventListener("mousemove",this.handleMouseMove.bind(this,o,i)),document.addEventListener("mouseup",this.handleMouseUp.bind(this,o,i)));}),i.addEventListener("mouseover",this.handleMouseOver.bind(this,i));}handleMouseOver(i){i.style.cursor="grab";}handleMouseMove(i,e){if(!this.isMoving)return;let t=this.convertPixelToUnit(i.clientX)+0,o=this.convertPixelToUnit(i.clientY)+0;if(e.style.left=`${t}${this.unit}`,e.style.top=`${o}${this.unit}`,this.field.x=t,this.field.y=o,this.field.type==="line"){let _=this.field;_.x2=this.field.x+(_.x2-_.x),_.y2=this.field.y+(_.y2-_.y);}}handleMouseUp(i,e){this.isMoving=!1,e.style.cursor="grab",this.changed?.emit(this.field);}handleKeyUp(i,e){i.key==="Delete"&&this.handleDeleteKey();}handleDeleteKey(){this.deleted?.emit(this.field);}convertUnitToPixel(i){return this.unit==="mm"?i*3.78:this.unit==="cm"?i*37.8:this.unit==="in"?i*96:i;}convertPixelToUnit(i){return this.unit==="mm"?i/3.78:this.unit==="cm"?i/37.8:this.unit==="in"?i/96:i;}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template-field"]],viewQuery:function(e,t){if(e&1&&q(Le,7),e&2){let o;k(o=W())&&(t.matMenuTrigger=o.first);}},inputs:{field:"field",unit:"unit"},outputs:{changed:"changed",deleted:"deleted"},standalone:!0,features:[M([B]),c],decls:0,vars:0,template:function(e,t){},dependencies:[T,Q,Oe,H],encapsulation:2});let d=n;return d;})();var Re=(()=>{let n=class n extends P{constructor(){let i=m(I);super(i),this.fb=m(O),this.data=m(A),this.barcodeTypes=["qr","datamatrix"];let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_barcode1",[l.required]],type:["barcode",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],value:[t?.value??"",[l.required]],barcodeType:[t?.barcodeType??"qr",[l.required]],width:[t?.width??16,[l.required]],height:[t?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template-barcode-field"]],standalone:!0,features:[M([]),S,c],decls:13,vars:10,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0642\u064A\u0645\u0629";let t;t="\u0627\u0644\u0646\u0645\u0637";let o;o="\u0627\u0644\u0639\u0631\u0636";let _;return _="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],["formControlName","value","label",e],["formControlName","barcodeType","label",t,3,"source"],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",o,3,"type"],["formControlName","height","label",_,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(a(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),a(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-select",4),p(6,"div",5),a(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7),f(),p(9,"div",5),a(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),f()()(),a(12,"sz-ui-dialog-actions",10)),e&2&&(r("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),s(2),r("formGroup",t.form),s(3),r("source",t.barcodeTypes),s(2),r("type","number"),s(),r("type","number"),s(2),r("type","number"),s(),r("type","number"),s(),r("actions",t.actions));},dependencies:[y,C,h,g,N,L,T,D,F,V,z,$,G,v,R,Ne],encapsulation:2});let d=n;return d;})();var ve=(()=>{let n=class n extends P{constructor(){let i=m(I);super(i),this.fb=m(O),this.data=m(A);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_image1",[l.required]],type:["image",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],url:[t?.url??"",[l.required]],width:[t?.width??16,[l.required]],height:[t?.height??16,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template-image-field"]],standalone:!0,features:[M([]),S,c],decls:11,vars:9,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0639\u0631\u0636";let t;return t="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",e,3,"type"],["formControlName","height","label",t,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(a(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),a(3,"sz-ui-form-field-input",2),p(4,"div",3),a(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),f(),p(7,"div",3),a(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),f()()(),a(10,"sz-ui-dialog-actions",8)),e&2&&(r("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),s(2),r("formGroup",t.form),s(3),r("type","number"),s(),r("type","number"),s(2),r("type","number"),s(),r("type","number"),s(),r("actions",t.actions));},dependencies:[y,C,h,g,N,L,T,D,F,V,z,$,G,v,R],encapsulation:2});let d=n;return d;})();var be=(()=>{let n=class n extends P{constructor(){let i=m(I);super(i),this.fb=m(O),this.data=m(A);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_line1",[l.required]],type:["line",[l.required]],x:[t?.x??5,[l.required]],y:[t?.y??5,[l.required]],lineColor:[t?.lineColor??"#000",[l.required]],lineWidth:[t?.lineWidth??1,[l.required]],x2:[t?.x2??30,[l.required]],y2:[t?.y2??5,[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template-line-field"]],standalone:!0,features:[M([]),S,c],decls:13,vars:10,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0644\u0648\u0646";let t;return t="\u0627\u0644\u0639\u0631\u0636",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","x2","label","X2",3,"type"],["formControlName","y2","label","Y2",3,"type"],["formControlName","lineColor","label",e],["formControlName","lineWidth","label",t,3,"type"],[3,"actions"]];},template:function(e,t){e&1&&(a(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),a(3,"sz-ui-form-field-input",2),p(4,"div",3),a(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),f(),p(7,"div",3),a(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),f(),a(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),f()(),a(12,"sz-ui-dialog-actions",10)),e&2&&(r("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),s(2),r("formGroup",t.form),s(3),r("type","number"),s(),r("type","number"),s(2),r("type","number"),s(),r("type","number"),s(2),r("type","number"),s(),r("actions",t.actions));},dependencies:[y,C,h,g,N,L,T,D,F,V,z,$,G,v,R],encapsulation:2});let d=n;return d;})();var Pe=(()=>{let n=class n extends P{constructor(){let i=m(I);super(i),this.fb=m(O),this.data=m(A);let e=this.fb;this.dialog=i;let t=this.data;this.form=e.group({name:[t?.name??"_text1",[l.required]],type:["text",[l.required]],x:[t?.x??0,[l.required]],y:[t?.y??0,[l.required]],text:[t?.text??"",[l.required]],fontSize:[t?.fontSize??12,[l.required]],fontColor:[t?.fontColor??"#000",[l.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template-text-field"]],standalone:!0,features:[M([]),S,c],decls:11,vars:8,consts:()=>{let i;i="\u0627\u0644\u0627\u0633\u0645";let e;e="\u0627\u0644\u0646\u0635";let t;t="\u062D\u062C\u0645 \u0627\u0644\u062E\u0637";let o;return o="\u0644\u0648\u0646 \u0627\u0644\u062E\u0637",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",i],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","text","label",e],["formControlName","fontSize","label",t,3,"type"],["formControlName","fontColor","label",o],[3,"actions"]];},template:function(e,t){e&1&&(a(0,"sz-ui-dialog-header",0),p(1,"mat-dialog-content")(2,"form",1),a(3,"sz-ui-form-field-input",2),p(4,"div",3),a(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),f(),a(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7)(9,"sz-ui-form-field-input",8),f()(),a(10,"sz-ui-dialog-actions",9)),e&2&&(r("title",t.title)("subtitle",t.subtitle)("alert",t.alert()),s(2),r("formGroup",t.form),s(3),r("type","number"),s(),r("type","number"),s(2),r("type","number"),s(2),r("actions",t.actions));},dependencies:[y,C,h,g,N,L,T,D,F,V,z,$,G,v,R],encapsulation:2});let d=n;return d;})();var Ge=["designer"];function ze(d,n){if(d&1){let X=Ee();p(0,"sz-mgmt-reporting-template-field",6),Me("changed",function(e){j(X);let t=U();return K(t.fieldChanged(e));})("deleted",function(e){j(X);let t=U();return K(t.fieldDeleted(e));}),f();}if(d&2){let X=n.$implicit,i=U();r("field",X)("unit",i.size.unit);}}var $e=(()=>{let n=class n{constructor(){this.route=m(Te),this.dialog=m(he),this.srptService=m(B),this.snackBar=m(ge),this.template=this.route.snapshot.data.template,this.alert=me(void 0),this.fields=[],this.size={width:210,height:297,unit:"mm"},this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:ye.default([b.add().setSubItems([b.text(this.openSaveTextFieldComponent.bind(this)),b.barcode(this.openSaveBarcodeFieldComponent.bind(this)),b.image(this.openSaveImageFieldComponent.bind(this)),b.line(this.openSaveLineFieldComponent.bind(this))]).setTitle(),b.menu([b.reset(this.reset.bind(this))])])};}ngAfterViewInit(){this.refresh();}refresh(){this.fields=this.template.content?.fields??[];}getStyle(){return{width:`${this.size.width}${this.size.unit}`,height:`${this.size.height}${this.size.unit}`};}openSaveTextFieldComponent(){this.dialog.open(Pe).afterClosed().subscribe(i=>{i&&(this.fields.push(i),this.save());});}openSaveBarcodeFieldComponent(){this.dialog.open(Re).afterClosed().subscribe(i=>{i&&(this.fields.push(i),this.save());});}openSaveImageFieldComponent(){this.dialog.open(ve).afterClosed().subscribe(i=>{i&&(this.fields.push(i),this.save());});}openSaveLineFieldComponent(){this.dialog.open(be).afterClosed().subscribe(i=>{i&&(this.fields.push(i),this.save());});}fieldChanged(i){this.fields=this.fields.map(e=>e.name===i.name?i:e),this.save();}fieldDeleted(i){this.fields=this.fields.filter(e=>e.name!==i.name);}reset(){this.fields=this.template.baseTemplate.content?.fields??[],this.save();}save(){this.srptService.templates.update(this.template.id,se(le({},this.template),{content:{fields:this.fields}})).subscribe(()=>{this.snackBar.open(Z.saved,Z.close,{duration:5e3});});}};n.ɵfac=function(e){return new(e||n)();},n.ɵcmp=E({type:n,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(e,t){if(e&1&&q(Ge,5),e&2){let o;k(o=W())&&(t.designerEl=o.first);}},standalone:!0,features:[M([B]),c],decls:7,vars:4,consts:[["designer",""],[3,"config"],[3,"alert"],[1,"container"],["dir","ltr",1,"designer"],[3,"field","unit"],[3,"changed","deleted","field","unit"]],template:function(e,t){e&1&&(a(0,"sz-ui-app-bar",1)(1,"sz-ui-alert",2),p(2,"div",3)(3,"div",4,0),ue(5,ze,1,2,"sz-mgmt-reporting-template-field",5,pe),f()()),e&2&&(r("config",t.appBarConfig),s(),r("alert",t.alert()),s(2),_e(t.getStyle()),s(2),fe(t.fields));},dependencies:[T,Se,Q,De,Ie,H,Fe,Ce],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;background-color:#fff;position:relative}"]});let d=n;return d;})();var ri=[{path:"",component:$e}];export{ri as default};/**i18n:9054193bb4dcc24d51a6dba534830e37dcd91e77a8a9ecb6b346a792eb872c67*/