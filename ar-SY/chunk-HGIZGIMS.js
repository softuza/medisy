import{c as fe}from"./chunk-JITIZZPB.js";import{a as Te}from"./chunk-37YBARO5.js";import{a as p,b as me,d as pe,f as de,i as _e,j as ce}from"./chunk-7U2WIWHF.js";import{a as m}from"./chunk-5KKUQUDS.js";import{e as B,f as $,g as P,i as Se,j as U,k as ue}from"./chunk-WN2NFEA2.js";import{e as G,g as le,h as j}from"./chunk-Q5LDCOCY.js";import{a as v,b as D,d as ie,e as z,g as V}from"./chunk-IAMBMKDI.js";import{c as F,q as Y,s as re,t as ae}from"./chunk-3ZKUNSZU.js";import{c as A}from"./chunk-KVZ22XWW.js";import{c as E,d as ne}from"./chunk-LMCANXRL.js";import{d as M,f as O,g as R,k as I,m as N,p as h,q as L,t as b}from"./chunk-KAOE4CKM.js";import{a as Z,c as ee,e as te}from"./chunk-4YTU7KIA.js";import{ia as oe,ka as se}from"./chunk-WG6MZMNK.js";import{Da as w,Db as n,Ea as k,Hc as W,Ib as Q,Ma as q,Nb as S,Ob as d,Pb as u,Tb as J,Zb as K,_b as T,ac as X,hb as a,ib as l,pa as _,pc as y,qc as f,ta as H,ua as c,ub as g,zb as x}from"./chunk-WLX3OMWV.js";function Ne(s,o){if(s&1){let C=J();S(0,"sz-ui-form-field-select",6),T("szOptionSelected",function(t){w(C);let i=X();return k(i.testTypeResultOptionChanged(t));}),d();}if(s&2){let C=X();n("source",C.testTypeResultOptions)("szOptionValueFn",C.testTypeResultOptionValueFn);}}function he(s,o){s&1&&u(0,"sz-ui-form-field-input",7),s&2&&n("type","number");}var Ee=(()=>{let o=class o extends B{constructor(e,t,i,r){super(t),this.fb=e,this.dialog=t,this.mlabService=i,this.data=r,this.referenceValueRules=null,this.testTypeResultOptions=[],this.testTypeResultOptionValueFn=ge=>ge,this.hasResultOptions=!0,this.form=e.group({value:[null,[M.required]],testTypeResultOptionId:[null,[]],referenceValueRuleId:[null,[M.required]],note:[null,[M.maxLength(4096)]]}),this.getTestTypeResultOptions();}getTestTypeResultOptions(){this.mlabService.testTypes.resultOptions.getAll(this.data.testTypeId,{orderBy:["name"]}).pipe(A(this.indicator)).subscribe(e=>{e&&(this.testTypeResultOptions=e.items,this.hasResultOptions=this.testTypeResultOptions.length>0);});}testTypeResultOptionChanged(e){this.form.controls.value.setValue(e.value);}submit(){this.IsValid();}};o.ɵfac=function(t){return new(t||o)(l(L),l(v),l(m),l(D));},o.ɵcmp=c({type:o,selectors:[["sz-medisy-laboratory-analysis-test-result-save"]],standalone:!0,features:[y([m]),g,f],decls:8,vars:7,consts:()=>{let e;e="\u0642\u064A\u0645\u0629";let t;t="\u0645\u0644\u0627\u062D\u0638\u0629";let i;return i="\u0642\u064A\u0645\u0629",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","testTypeResultOptionId","label",e,3,"source","szOptionValueFn"],["formControlName","note","label",t],["formControlName","referenceValueRuleId",3,"source"],[3,"actions"],["formControlName","testTypeResultOptionId","label",e,3,"szOptionSelected","source","szOptionValueFn"],["formControlName","value","label",i,3,"type"]];},template:function(t,i){t&1&&(u(0,"sz-ui-dialog-header",0),S(1,"mat-dialog-content")(2,"form",1),x(3,Ne,1,2,"sz-ui-form-field-select",2)(4,he,1,1),u(5,"sz-ui-form-field-textarea",3)(6,"sz-ui-form-field-select",4),d()(),u(7,"sz-ui-dialog-actions",5)),t&2&&(n("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),a(2),n("formGroup",i.form),a(),Q(3,i.hasResultOptions?3:4),a(3),n("source",i.referenceValueRules),a(),n("actions",i.actions));},dependencies:[b,I,O,R,N,h,V,z,U,$,P,F,re,Y],encapsulation:2});let s=o;return s;})();var Ce=(()=>{let o=class o extends B{constructor(e,t,i,r){super(i),this.mlabService=e,this.fb=t,this.dialog=i,this.data=r,this.testGroups=this.mlabService.testGroups.getAll({orderBy:["name"]}),this.form=t.group({testGroupId:[r?.testGroupId,[]],note:[r?.note,[]]});}submit(){this.IsValid()&&this.data&&this.save(this.mlabService.analyses.tests.update(this.data.analysisId,this.data.id,this.form.value));}};o.ɵfac=function(t){return new(t||o)(l(m),l(L),l(v),l(D));},o.ɵcmp=c({type:o,selectors:[["sz-medisy-laboratory-analysis-tests-save"]],standalone:!0,features:[g,f],decls:6,vars:7,consts:()=>{let e;e="\u0645\u062C\u0645\u0648\u0639\u0629 \u0627\u062E\u062A\u0628\u0627\u0631";let t;return t="\u0645\u0644\u0627\u062D\u0638\u0629",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","testGroupId","label",e,3,"source","emptyOption"],["formControlName","note","label",t],[3,"actions"]];},template:function(t,i){t&1&&(u(0,"sz-ui-dialog-header",0),S(1,"mat-dialog-content")(2,"form",1),u(3,"sz-ui-form-field-select",2)(4,"sz-ui-form-field-input",3),d()(),u(5,"sz-ui-dialog-actions",4)),t&2&&(n("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),a(2),n("formGroup",i.form),a(),n("source",i.testGroups)("emptyOption",!0),a(2),n("actions",i.actions));},dependencies:[b,I,O,R,N,h,V,z,U,$,P,ae,F,Y],encapsulation:2});let s=o;return s;})();var dt=(()=>{let o=class o{constructor(){this.route=_(Z),this.router=_(ee),this.dialog=_(ie),this.locale=_(W),this.mlabService=_(m),this.analysis=q.required(),this.dataSource=new pe(["test.testType.name","-testId"]),this.dataSource.columnDefs.push(p.uuid("id"),p.icon("test.state").setValueGetter(e=>fe(e.test.state)).setValueTooltip(e=>ne(e.test.state)),p.string("test.testType.name").setValueClassFontBold().setClickFn(e=>this.router.navigate([`/mlab/analyses/${e.analysisId}/tests/${e.id}`])).setStacked([p.string("test.laboratory.name").setValueClassFontSmall()]),p.string("test.referenceGroup.name").setName(E.referenceGroup).setVisible(!1),p.string("note").setVisible(!1),p.date("createdAt").setVisible(!1),p.date("updatedAt").setVisible(!1),me.menu([G.item(E.testResult,le.science,e=>this.openAnalysisTestResultSaveComponent(e.test)),G.divider(),j.edit(e=>this.openSaveComponent(e)),G.divider(),j.delete(e=>this.openDeleteComponent(e))])),this.dataSource.groupDefs={key:"testGroupId",name:E.testGroup,nameGetterFn:e=>e.testGroup?.name??E.single};}ngOnInit(){this.get();}openAnalysisTestTypeAddComponent(){this.dialog.open(Te,{data:this.analysis().laboratoryId}).afterClosed().subscribe(e=>{e&&this.mlabService.analyses.tests.create(this.analysis().id,{laboratoryTestTypeId:e.laboratoryTestType.id,transferOutLaboratoryId:e.transferOutLaboratoryId}).pipe(A(this.dataSource.indicator)).subscribe(t=>{t&&this.get();});});}openAnalysisTestResultSaveComponent(e){this.dialog.open(Ee,{data:e}).afterClosed().subscribe(t=>{});}openSaveComponent(e){this.dialog.open(Ce,{data:e}).afterClosed().subscribe(t=>{t&&this.get();});}openDeleteComponent(e){this.dialog.open(Se,{data:ue.delete(this.mlabService.analyses.tests.delete(e.analysisId,e.id),e)}).afterClosed().subscribe(t=>{this.dataSource.delete(t);});}get(){this.mlabService.analyses.tests.get(this.analysis().id,this.dataSource.getQuery()).pipe(A(this.dataSource.indicator)).subscribe(e=>{this.dataSource.set(e.items,e.count);});}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=c({type:o,selectors:[["sz-medisy-laboratory-analysis-tests"]],inputs:{analysis:[H.SignalBased,"analysis"]},standalone:!0,features:[y([m]),f],decls:5,vars:3,consts:()=>{let e;return e="\u0625\u0636\u0627\u0641\u0629",[e,[3,"changed","dataSource"],["mat-flat-button","","color","primary","start","",3,"click"],[3,"update","stateEnabled","dataSource"]];},template:function(t,i){t&1&&(S(0,"sz-ui-table-search-filter",1),T("changed",function(){return i.get();}),S(1,"button",2),T("click",function(){return i.openAnalysisTestTypeAddComponent();}),S(2,"span"),K(3,0),d()()(),S(4,"sz-ui-table",3),T("update",function(){return i.get();}),d()),t&2&&(n("dataSource",i.dataSource),a(4),n("stateEnabled",!0)("dataSource",i.dataSource));},dependencies:[te,ce,_e,de,se,oe],encapsulation:2});let s=o;return s;})();export{dt as a};/**i18n:a84518dfaf5206df012bb98d831270fba229ecfbff1c9dff1ac7013a5ea5bd1b*/