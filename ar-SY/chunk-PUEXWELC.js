import{$ as hi,$a as bt,A as Xs,Aa as nr,Ab as I,B as Se,Ba as sr,Bb as Lr,C as rt,Ca as Pt,Cb as Dr,D as Ys,Da as rr,Db as vr,E as Ye,Ea as or,Eb as Pr,F as je,Fa as lr,Fb as Hi,G as qt,Ga as ar,H as Ne,Ha as hr,I as js,Ia as cr,J as Ns,Ja as Ue,K as ki,Ka as Wi,L as Ee,La as Xi,M as zs,Ma as Yi,N as Et,Na as ur,O as re,Oa as dr,P as Us,Pa as fr,Q as it,Qa as gr,R as Yt,Ra as mr,S as Ks,Sa as _r,T as oi,Ta as pr,U as Ce,Ua as xr,V as Bs,Va as dt,W as Re,Wa as yr,X as Zs,Xa as yt,Y as Vt,Ya as ji,Z as li,Za as K,_ as ai,_a as Ni,a as ii,aa as Hs,ab as zi,b as Ls,ba as nt,bb as Tr,c as Ds,ca as ht,cb as Ct,d as vs,da as vt,db as Sr,e as Zt,ea as ci,eb as Ui,f as Ps,fa as j,fb as Er,g as bs,ga as q,gb as di,h as ni,ha as qs,hb as tt,i as Dt,ia as Ie,ib as ae,j as Ms,ja as Vs,jb as ot,k as Os,ka as jt,kb as lt,l as si,la as Gi,lb as he,m as As,ma as Js,mb as ce,n as se,na as oe,nb as ue,o as ks,oa as ui,ob as Jt,p as $,pa as Qs,pb as de,q as Tt,qa as $s,qb as Nt,r as at,ra as ze,rb as fe,s as Gs,sa as Fe,sb as Cr,t as Ht,ta as le,tb as Ki,u as Y,ua as tr,ub as Rr,v as ri,va as er,vb as Ir,w as Ai,wa as ct,wb as Bi,x as Ws,xa as ir,xb as Fr,y as H,ya as V,yb as wr,z as St,za as ut,zb as Zi}from"./chunk-AVUGMZFX.js";import{a as ws}from"./chunk-QZKOUDB3.js";import{d as Es}from"./chunk-WP7GINVA.js";import{h as Cs,j as Is}from"./chunk-K465E5EJ.js";import{a as Fs}from"./chunk-LUJYMJYX.js";import{b as Rs}from"./chunk-FPHQ27E5.js";import{r as Ts}from"./chunk-FMLZPT37.js";import{Ka as Ss}from"./chunk-VE4VSZJT.js";import{Ha as ls,Ia as as,Kb as ds,Lb as fs,Mb as gs,bc as ms,cc as _s,dc as ps,ja as ei,lb as hs,na as rs,nb as cs,pa as os,qc as xs,rc as ys,zb as us}from"./chunk-2H67EYAB.js";var br=(()=>{let t=class t{constructor(){this.managed=as(!1),this.tileDelete=ls(),this.indicator=hs(!1)}delete(){this.tileDelete?.emit(this.tile)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=os({type:t,inputs:{tile:"tile",managed:[1,"managed"]},outputs:{tileDelete:"tileDelete"}});let a=t;return a})();var qi=class a extends ri{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let e=t;this.setGeometry(e)}else{let e=t;this.setProperties(e)}}clone(){let t=new a(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let e=this.getGeometry();e&&t.setGeometry(e.clone());let i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(at(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=Tt(t,$.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?zo(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function zo(a){if(typeof a=="function")return a;let t;return Array.isArray(a)?t=a:(H(typeof a.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[a]),function(){return t}}var Vi=qi;var Mr=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Or={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},Ji=class extends Lr{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];let e=t.label!==void 0?t.label:"\u2922";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;let i=t.labelActive!==void 0?t.labelActive:"\xD7";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;let n=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener($.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Sr} ${Er}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){let t=this.getMap();if(!t)return;let e=t.getOwnerDocument();if(Ar(e))if(kr(e))Ko(e);else{let i;this.source_?i=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:i=t.getTargetElement(),this.keys_?Uo(i):Gr(i)}}handleFullScreenChange_(){let t=this.getMap();if(!t)return;let e=this.isInFullscreen_;this.isInFullscreen_=kr(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(zi(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Or.ENTERFULLSCREEN)):(zi(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Or.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){let e=this.getMap();e&&e.removeChangeListener(Zi.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Zi.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){let t=this.documentListeners_;for(let i=0,n=t.length;i<n;++i)at(t[i]);t.length=0;let e=this.getMap();if(e){let i=e.getOwnerDocument();Ar(i)?this.element.classList.remove(Ui):this.element.classList.add(Ui);for(let n=0,s=Mr.length;n<s;++n)t.push(Tt(i,Mr[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}};function Ar(a){let t=a.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&a.fullscreenEnabled)}function kr(a){return!!(a.webkitIsFullScreen||a.fullscreenElement)}function Gr(a){a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()}function Uo(a){a.webkitRequestFullscreen?a.webkitRequestFullscreen():Gr(a)}function Ko(a){a.exitFullscreen?a.exitFullscreen():a.webkitExitFullscreen&&a.webkitExitFullscreen()}var Wr=Ji;function Qi(a,t,e,i,n,s,r){let o,l,c=(e-t)/i;if(c===1)o=t;else if(c===2)o=t,l=n;else if(c!==0){let h=a[t],u=a[t+1],f=0,g=[0];for(let p=t+i;p<e;p+=i){let x=a[p],_=a[p+1];f+=Math.sqrt((x-h)*(x-h)+(_-u)*(_-u)),g.push(f),h=x,u=_}let d=n*f,m=vs(g,d);m<0?(l=(d-g[-m-2])/(g[-m-1]-g[-m-2]),o=t+(-m-2)*i):o=t+m*i}r=r>1?r:2,s=s||new Array(r);for(let h=0;h<r;++h)s[h]=o===void 0?NaN:l===void 0?a[o+h]:rt(a[o+h],a[o+i+h],l);return s}function Xr(a,t,e,i){let n=a[t],s=a[t+1],r=0;for(let o=t+i;o<e;o+=i){let l=a[o],c=a[o+1];r+=Math.sqrt((l-n)*(l-n)+(c-s)*(c-s)),n=l,s=c}return r}function Yr(a,t,e,i){let n=[],s=it();for(let r=0,o=e.length;r<o;++r){let l=e[r];s=oi(a,t,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return n}var Ke={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var $i=class extends pr{constructor(t){t=t||{};let e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Ke.PRELOAD)}setPreload(t){this.set(Ke.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Ke.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Ke.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}},jr=$i;var Bo=5,tn=class extends Gs{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Bo}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return Ht()}getData(t){return null}prepareFrame(t){return Ht()}renderFrame(t,e){return Ht()}forEachFeatureAtCoordinate(t,e,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){let e=t.target;(e.getState()===dt.LOADED||e.getState()===dt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=dt.LOADED&&e!=dt.ERROR&&t.addEventListener($.CHANGE,this.boundHandleImageChange_),e==dt.IDLE&&(t.load(),e=t.getState()),e==dt.LOADED}renderIfReadyAndVisible(){let t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}},Nr=tn;var en=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ni(),{get:(t,e)=>{if(typeof Ni()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,n=e.length;i<n;++i){let s=e[i];if(typeof s=="function"){s(t);continue}let r=e[++i];if(typeof t[s]=="function")t[s](...r);else{if(typeof r=="function"){t[s]=r(t);continue}t[s]=r}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},fi=en;var sn=[],we=null;function Zo(){we=K(1,1,void 0,{willReadFrequently:!0})}var nn=class extends Nr{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=ct(),this.pixelTransform=ct(),this.inversePixelTransform=ct(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){we||Zo(),we.clearRect(0,0,1,1);let n;try{we.drawImage(t,e,i,1,1,0,0,1,1),n=we.getImageData(0,0,1,1).data}catch{return we=null,null}return n}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){let n=this.getLayer().getClassName(),s,r;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&Dt(ji(t.style.backgroundColor),ji(i)))){let o=t.firstElementChild;o instanceof HTMLCanvasElement&&(r=o.getContext("2d"))}if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=n;let o=s.style;o.position="absolute",o.width="100%",o.height="100%",r=K();let l=r.canvas;s.appendChild(l),o=l.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=s,this.context=r}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){let n=vt(i),s=ci(i),r=ai(i),o=li(i);V(e.coordinateToPixelTransform,n),V(e.coordinateToPixelTransform,s),V(e.coordinateToPixelTransform,r),V(e.coordinateToPixelTransform,o);let l=this.inversePixelTransform;V(l,n),V(l,s),V(l,r),V(l,o),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}prepareContainer(t,e){let i=t.extent,n=t.viewState.resolution,s=t.viewState.rotation,r=t.pixelRatio,o=Math.round(j(i)/n*r),l=Math.round(nt(i)/n*r);ut(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/r,1/r,s,-o/2,-l/2),nr(this.inversePixelTransform,this.pixelTransform);let c=sr(this.pixelTransform);if(this.useContainer(e,c,this.getBackground(t)),!this.containerReused){let h=this.context.canvas;h.width!=o||h.height!=l?(h.width=o,h.height=l):this.context.clearRect(0,0,o,l),c!==h.style.transform&&(h.style.transform=c)}}dispatchRenderEvent_(t,e,i){let n=this.getLayer();if(n.hasListener(t)){let s=new wr(t,this.inversePixelTransform,i,e);n.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(qt.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(qt.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new fi),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(qt.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(qt.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,n,s,r,o){let l=s/2,c=r/2,h=n/e,u=-h,f=-t[0]+o,g=-t[1];return ut(this.tempTransform,l,c,h,u,-i,f,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}},gi=nn;var rn=class extends ks{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent($.CHANGE)}release(){this.state===I.ERROR&&this.setState(I.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==I.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Ht()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;let n=e-i+1e3/60;return n>=this.transition_?1:er(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},Le=rn;function ve(a){return a instanceof Image||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageBitmap?a:null}function zr(a){return a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Float32Array||a instanceof DataView?a:null}var Ho=new Error("disposed"),De=null;function Ur(a){De||(De=K(a.width,a.height,void 0,{willReadFrequently:!0}));let t=De.canvas,e=a.width;t.width!==e&&(t.width=e);let i=a.height;return t.height!==i&&(t.height=i),De.clearRect(0,0,e,i),De.drawImage(a,0,0),De.getImageData(0,0,e,i).data}var qo=[256,256],on=class extends Le{constructor(t){let e=I.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;let t=ve(this.data_);return t?[t.width,t.height]:qo}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==I.IDLE&&this.state!==I.ERROR)return;this.state=I.LOADING,this.changed();let t=this;this.loader_().then(function(e){t.data_=e,t.state=I.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=I.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Ho),this.controller_=null),super.disposeInternal()}},Be=on;var ln=class extends Le{constructor(t,e,i,n,s,r){super(t,e,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=I.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=I.ERROR,this.unlistenImage_(),this.image_=Vo(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=I.LOADED:this.state=I.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==I.ERROR&&(this.state=I.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==I.IDLE&&(this.state=I.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Tr(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function Vo(){let a=K(1,1);return a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,1,1),a.canvas}var mi=ln;var an=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();){let e=this.pop();e instanceof Ds&&e.dispose()}}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){let i=this.entries_[t];return H(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){let e=this.entries_[t];return H(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){let t=new Array(this.count_),e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){H(!(t in this.entries_),"Tried to set a value for a key that is used already");let i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}},_i=an;var Jo=10,Kr=.25,hn=class{constructor(t,e,i,n,s,r){this.sourceProj_=t,this.targetProj_=e;let o={},l=Qs(this.targetProj_,this.sourceProj_);this.transformInv_=function(_){let y=_[0]+"/"+_[1];return o[y]||(o[y]=l(_)),o[y]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&j(n)>=j(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?j(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?j(this.targetProj_.getExtent()):null;let c=vt(i),h=ci(i),u=ai(i),f=li(i),g=this.transformInv_(c),d=this.transformInv_(h),m=this.transformInv_(u),p=this.transformInv_(f),x=Jo+(r?Math.max(0,Math.ceil(Math.log2(Vt(i)/(r*r*256*256)))):0);if(this.addQuad_(c,h,u,f,g,d,m,p,x),this.wrapsXInSource_){let _=1/0;this.triangles_.forEach(function(y,T,S){_=Math.min(_,y.source[0][0],y.source[1][0],y.source[2][0])}),this.triangles_.forEach(y=>{if(Math.max(y.source[0][0],y.source[1][0],y.source[2][0])-_>this.sourceWorldWidth_/2){let T=[[y.source[0][0],y.source[0][1]],[y.source[1][0],y.source[1][1]],[y.source[2][0],y.source[2][1]]];T[0][0]-_>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-_>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-_>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);let S=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-S<this.sourceWorldWidth_/2&&(y.source=T)}})}o={}}addTriangle_(t,e,i,n,s,r){this.triangles_.push({source:[n,s,r],target:[t,e,i]})}addQuad_(t,e,i,n,s,r,o,l,c){let h=ki([s,r,o,l]),u=this.sourceWorldWidth_?j(h)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1,d=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let p=ki([t,e,i,n]);d=j(p)/this.targetWorldWidth_>Kr||d}!g&&this.sourceProj_.isGlobal()&&u&&(d=u>Kr||d)}if(!d&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!q(h,this.maxSourceExtent_))return;let m=0;if(!d&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)d=!0;else if(m=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(r[0])||!isFinite(r[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!d){let p=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(p),_;g?_=(Se(s[0],f)+Se(o[0],f))/2-Se(x[0],f):_=(s[0]+o[0])/2-x[0];let y=(s[1]+o[1])/2-x[1];d=_*_+y*y>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){let p=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(p),_=[(n[0]+t[0])/2,(n[1]+t[1])/2],y=this.transformInv_(_);this.addQuad_(t,e,p,_,s,r,x,y,c-1),this.addQuad_(_,p,i,n,y,x,o,l,c-1)}else{let p=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(p),_=[(i[0]+n[0])/2,(i[1]+n[1])/2],y=this.transformInv_(_);this.addQuad_(t,p,_,n,s,x,y,l,c-1),this.addQuad_(p,e,i,_,x,r,o,y,c-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}m&11||this.addTriangle_(t,i,n,s,o,l),m&14||this.addTriangle_(t,i,e,s,o,r),m&&(m&13||this.addTriangle_(e,n,t,r,l,s),m&7||this.addTriangle_(e,n,i,r,l,o))}calculateSourceExtent(){let t=it();return this.triangles_.forEach(function(e,i,n){let s=e.source;Re(t,s[0]),Re(t,s[1]),Re(t,s[2])}),t}getTriangles(){return this.triangles_}},pi=hn;var cn,Rt=[];function Br(a,t,e,i,n){a.beginPath(),a.moveTo(0,0),a.lineTo(t,e),a.lineTo(i,n),a.closePath(),a.save(),a.clip(),a.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),a.restore()}function un(a,t){return Math.abs(a[t*4]-210)>2||Math.abs(a[t*4+3]-.75*255)>2}function Qo(){if(cn===void 0){let a=K(6,6,Rt);a.globalCompositeOperation="lighter",a.fillStyle="rgba(210, 0, 0, 0.75)",Br(a,4,5,4,0),Br(a,4,5,0,5);let t=a.getImageData(0,0,3,3).data;cn=un(t,0)||un(t,4)||un(t,8),bt(a),Rt.push(a.canvas)}return cn}function Zr(a,t,e,i){let n=$s(e,t,a),s=Gi(t,i,e),r=t.getMetersPerUnit();r!==void 0&&(s*=r);let o=a.getMetersPerUnit();o!==void 0&&(s/=o);let l=a.getExtent();if(!l||Et(l,n)){let c=Gi(a,s,n)/s;isFinite(c)&&c>0&&(s/=c)}return s}function xi(a,t,e,i){let n=hi(e),s=Zr(a,t,n,i);return(!isFinite(s)||s<=0)&&Zs(e,function(r){return s=Zr(a,t,r,i),isFinite(s)&&s>0}),s}function yi(a,t,e,i,n,s,r,o,l,c,h,u,f,g){let d=K(Math.round(e*a),Math.round(e*t),Rt);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(e,e);function m(S){return Math.round(S*e)/e}d.globalCompositeOperation="lighter";let p=it();l.forEach(function(S,w,L){Bs(p,S.extent)});let x,_=e/i,y=(u?1:1+Math.pow(2,-24))/_;if(!f||l.length!==1||c!==0){if(x=K(Math.round(j(p)*_),Math.round(nt(p)*_),Rt),u||(x.imageSmoothingEnabled=!1),n&&g){let S=(n[0]-p[0])*_,w=-(n[3]-p[3])*_,L=j(n)*_,E=nt(n)*_;x.rect(S,w,L,E),x.clip()}l.forEach(function(S,w,L){if(S.image.width>0&&S.image.height>0){if(S.clipExtent){x.save();let D=(S.clipExtent[0]-p[0])*_,A=-(S.clipExtent[3]-p[3])*_,P=j(S.clipExtent)*_,v=nt(S.clipExtent)*_;x.rect(u?D:Math.round(D),u?A:Math.round(A),u?P:Math.round(D+P)-Math.round(D),u?v:Math.round(A+v)-Math.round(A)),x.clip()}let E=(S.extent[0]-p[0])*_,F=-(S.extent[3]-p[3])*_,G=j(S.extent)*_,O=nt(S.extent)*_;x.drawImage(S.image,c,c,S.image.width-2*c,S.image.height-2*c,u?E:Math.round(E),u?F:Math.round(F),u?G:Math.round(E+G)-Math.round(E),u?O:Math.round(F+O)-Math.round(F)),S.clipExtent&&x.restore()}})}let T=vt(r);return o.getTriangles().forEach(function(S,w,L){let E=S.source,F=S.target,G=E[0][0],O=E[0][1],D=E[1][0],A=E[1][1],P=E[2][0],v=E[2][1],R=m((F[0][0]-T[0])/s),M=m(-(F[0][1]-T[1])/s),X=m((F[1][0]-T[0])/s),N=m(-(F[1][1]-T[1])/s),k=m((F[2][0]-T[0])/s),W=m(-(F[2][1]-T[1])/s),z=G,J=O;G=0,O=0,D-=z,A-=J,P-=z,v-=J;let C=[[D,A,0,0,X-R],[P,v,0,0,k-R],[0,0,D,A,N-M],[0,0,P,v,W-M]],st=Xs(C);if(!st)return;if(d.save(),d.beginPath(),Qo()||!u){d.moveTo(X,N);let B=4,Ft=R-X,kt=M-N;for(let gt=0;gt<B;gt++)d.lineTo(X+m((gt+1)*Ft/B),N+m(gt*kt/(B-1))),gt!=B-1&&d.lineTo(X+m((gt+1)*Ft/B),N+m((gt+1)*kt/(B-1)));d.lineTo(k,W)}else d.moveTo(X,N),d.lineTo(R,M),d.lineTo(k,W);d.clip(),d.transform(st[0],st[2],st[1],st[3],R,M),d.translate(p[0]-z,p[3]-J);let Q;if(x)Q=x.canvas,d.scale(y,-y);else{let B=l[0],Ft=B.extent;Q=B.image,d.scale(j(Ft)/Q.width,-nt(Ft)/Q.height)}d.drawImage(Q,0,0),d.restore()}),x&&(bt(x),Rt.push(x.canvas)),h&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,o.getTriangles().forEach(function(S,w,L){let E=S.target,F=(E[0][0]-T[0])/s,G=-(E[0][1]-T[1])/s,O=(E[1][0]-T[0])/s,D=-(E[1][1]-T[1])/s,A=(E[2][0]-T[0])/s,P=-(E[2][1]-T[1])/s;d.beginPath(),d.moveTo(O,D),d.lineTo(F,G),d.lineTo(A,P),d.closePath(),d.stroke()}),d.restore()),d.canvas}var dn=class extends Be{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let e=t.sourceProj,i=e.getExtent(),n=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?n?ht(i,n):i:n;let s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),r=this.targetTileGrid_.getExtent(),o=this.sourceTileGrid_.getExtent(),l=r?ht(s,r):s;if(Vt(l)===0){this.state=I.EMPTY;return}i&&(o?o=ht(o,i):o=i);let c=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,u=xi(e,h,l,c);if(!isFinite(u)||u<=0){this.state=I.EMPTY;return}let f=t.errorThreshold!==void 0?t.errorThreshold:.5;if(this.triangulation_=new pi(e,h,l,o,u*f,c),this.triangulation_.getTriangles().length===0){this.state=I.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let g=this.triangulation_.calculateSourceExtent();if(o&&(e.canWrapX()?(g[1]=St(g[1],o[1],o[3]),g[3]=St(g[3],o[1],o[3])):g=ht(g,o)),!Vt(g))this.state=I.EMPTY;else{let d=0,m=0;e.canWrapX()&&(d=j(i),m=Math.floor((g[0]-i[0])/d)),Ie(g.slice(),e,!0).forEach(x=>{let _=this.sourceTileGrid_.getTileRangeForExtentAndZ(x,this.sourceZ_),y=t.getTileFunction;for(let T=_.minX;T<=_.maxX;T++)for(let S=_.minY;S<=_.maxY;S++){let w=y(this.sourceZ_,T,S,this.pixelRatio_);if(w){let L=m*d;this.sourceTiles_.push({tile:w,offset:L})}}++m}),this.sourceTiles_.length===0&&(this.state=I.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){let t=[],e=!1;if(this.sourceTiles_.forEach(d=>{let m=d.tile;if(!m||m.getState()!==I.LOADED)return;let p=m.getSize(),x=this.gutter_,_,y=zr(m.getData());y?_=y:(e=!0,_=Ur(ve(m.getData())));let T=[p[0]+2*x,p[1]+2*x],S=_ instanceof Float32Array,w=T[0]*T[1],L=S?Float32Array:Uint8ClampedArray,E=new L(_.buffer),F=L.BYTES_PER_ELEMENT,G=F*E.length/w,O=E.byteLength/T[1],D=Math.floor(O/F/T[0]),A=w*D,P=E;if(E.length!==A){P=new L(A);let M=0,X=0,N=T[0]*D;for(let k=0;k<T[1];++k){for(let W=0;W<N;++W)P[M++]=E[X+W];X+=O/F}}let v=this.sourceTileGrid_.getTileCoordExtent(m.tileCoord);v[0]+=d.offset,v[2]+=d.offset;let R=this.clipExtent_?.slice();R&&(R[0]+=d.offset,R[2]+=d.offset),t.push({extent:v,clipExtent:R,data:new Uint8ClampedArray(P.buffer),dataType:L,bytesPerPixel:G,pixelSize:T})}),this.sourceTiles_.length=0,t.length===0){this.state=I.ERROR,this.changed();return}let i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(i),l=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),h,u,f=t[0].bytesPerPixel,g=Math.ceil(f/3);for(let d=g-1;d>=0;--d){let m=[];for(let S=0,w=t.length;S<w;++S){let L=t[S],E=L.data,F=L.pixelSize,G=F[0],O=F[1],D=K(G,O,Rt),A=D.createImageData(G,O),P=A.data,v=d*3;for(let R=0,M=P.length;R<M;R+=4)P[R]=E[v],P[R+1]=E[v+1],P[R+2]=E[v+2],P[R+3]=255,v+=f;D.putImageData(A,0,0),m.push({extent:L.extent,clipExtent:L.clipExtent,image:D.canvas})}let p=yi(s,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,c,this.triangulation_,m,this.gutter_,!1,!1,!1);for(let S=0,w=m.length;S<w;++S){let E=m[S].image.getContext("2d");bt(E),Rt.push(E.canvas)}let x=p.getContext("2d"),_=x.getImageData(0,0,p.width,p.height);bt(x),Rt.push(p),h||(u=new Uint8ClampedArray(f*_.width*_.height),h=new t[0].dataType(u.buffer));let y=_.data,T=d*3;for(let S=0,w=y.length;S<w;S+=4)y[S+3]===255?(u[T]=y[S],u[T+1]=y[S+1],u[T+2]=y[S+2]):(u[T]=0,u[T+1]=0,u[T+2]=0),T+=f}if(e){let d=K(s,r),m=new ImageData(h,s);d.putImageData(m,0,0),this.reprojData_=d.canvas}else this.reprojData_=h;this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=I.LOADED,this.changed()}load(){if(this.state!==I.IDLE&&this.state!==I.ERROR)return;this.state=I.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{let i=e.getState();if(i!==I.IDLE&&i!==I.LOADING)return;t++;let n=Tt(e,$.CHANGE,()=>{let s=e.getState();(s==I.LOADED||s==I.ERROR||s==I.EMPTY)&&(at(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==I.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null}},Hr=dn;var fn=class extends Le{constructor(t,e,i,n,s,r,o,l,c,h,u,f){super(s,I.IDLE,f),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=o,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;let g=n.getTileCoordExtent(this.wrappedTileCoord_),d=this.targetTileGrid_.getExtent(),m=this.sourceTileGrid_.getExtent(),p=d?ht(g,d):g;if(Vt(p)===0){this.state=I.EMPTY;return}let x=t.getExtent();x&&(m?m=ht(m,x):m=x);let _=n.getResolution(this.wrappedTileCoord_[0]),y=xi(t,i,p,_);if(!isFinite(y)||y<=0){this.state=I.EMPTY;return}let T=h!==void 0?h:.5;if(this.triangulation_=new pi(t,i,p,m,y*T,_),this.triangulation_.getTriangles().length===0){this.state=I.EMPTY;return}this.sourceZ_=e.getZForResolution(y);let S=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(S[1]=St(S[1],m[1],m[3]),S[3]=St(S[3],m[1],m[3])):S=ht(S,m)),!Vt(S))this.state=I.EMPTY;else{let w=0,L=0;t.canWrapX()&&(w=j(x),L=Math.floor((S[0]-x[0])/w)),Ie(S.slice(),t,!0).forEach(F=>{let G=e.getTileRangeForExtentAndZ(F,this.sourceZ_);for(let O=G.minX;O<=G.maxX;O++)for(let D=G.minY;D<=G.maxY;D++){let A=c(this.sourceZ_,O,D,o);if(A){let P=L*w;this.sourceTiles_.push({tile:A,offset:P})}}++L}),this.sourceTiles_.length===0&&(this.state=I.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(e=>{let i=e.tile;if(i&&i.getState()==I.LOADED){let n=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);n[0]+=e.offset,n[2]+=e.offset;let s=this.clipExtent_?.slice();s&&(s[0]+=e.offset,s[2]+=e.offset),t.push({extent:n,clipExtent:s,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=I.ERROR;else{let e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=yi(n,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),r,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=I.LOADED}this.changed()}load(){if(this.state==I.IDLE){this.state=I.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{let i=e.getState();if(i==I.IDLE||i==I.LOADING){t++;let n=Tt(e,$.CHANGE,s=>{let r=e.getState();(r==I.LOADED||r==I.ERROR||r==I.EMPTY)&&(at(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,n){e.getState()==I.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null}release(){this.canvas_&&(bt(this.canvas_.getContext("2d")),Rt.push(this.canvas_),this.canvas_=null),super.release()}},Ze=fn;var Ti=class{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function ge(a,t,e,i,n){return n!==void 0?(n.minX=a,n.maxX=t,n.minY=e,n.maxY=i,n):new Ti(a,t,e,i)}var Si=Ti;function Pe(a,t,e,i){return i!==void 0?(i[0]=a,i[1]=t,i[2]=e,i):[a,t,e]}function gn(a,t,e){return a+"/"+t+"/"+e}function Ei(a){return gn(a[0],a[1],a[2])}function qr(a){return a.split("/").map(Number)}function Vr(a){return tl(a[0],a[1],a[2])}function tl(a,t,e){return(t<<a)+e}function Jr(a,t){let e=a[0],i=a[1],n=a[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;let s=t.getFullTileRange(e);return s?s.containsXY(i,n):!0}function mn(a,t,e,i){return`${a},${gn(t,e,i)}`}function _n(a,t,e){if(!(e in a))return a[e]=new Set([t]),!0;let i=a[e],n=i.has(t);return n||i.add(t),!n}function el(a,t,e){let i=a[e];return i?i.delete(t):!1}function Qr(a,t){let e=a.layerStatesArray[a.layerIndex];e.extent&&(t=ht(t,le(e.extent,a.viewState.projection)));let i=e.layer.getRenderSource();if(!i.getWrapX()){let n=i.getTileGridForProjection(a.viewState.projection).getExtent();n&&(t=ht(t,n))}return t}var pn=class extends gi{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=it(),this.tempTileRange_=new Si(0,0,0,0),this.tempTileCoord_=Pe(0,0,0);let i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new _i(i),this.renderedProjection_=void 0,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,n){let s=this.tileCache_,o=this.getLayer().getSource(),l=mn(o.getKey(),t,e,i),c;if(s.containsKey(l))c=s.get(l);else{if(c=o.getTile(t,e,i,n.pixelRatio,n.viewState.projection),!c)return null;s.set(l,c)}return c}getTile(t,e,i,n){let s=this.getOrCreateTile(t,e,i,n);return s||null}getData(t){let e=this.frameState;if(!e)return null;let i=this.getLayer(),n=V(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!Et(s,n))return null;let r=e.viewState,o=i.getRenderSource(),l=o.getTileGridForProjection(r.projection),c=o.getTilePixelRatio(e.pixelRatio);for(let h=l.getZForResolution(r.resolution);h>=l.getMinZoom();--h){let u=l.getTileCoordForCoordAndZ(n,h),f=this.getTile(h,u[1],u[2],e);if(!f||f.getState()!==I.LOADED)continue;let g=l.getOrigin(h),d=yt(l.getTileSize(h)),m=l.getResolution(h),p;if(f instanceof mi||f instanceof Ze)p=f.getImage();else if(f instanceof Be){if(p=ve(f.getData()),!p)continue}else continue;let x=Math.floor(c*((n[0]-g[0])/m-u[1]*d[0])),_=Math.floor(c*((g[1]-n[1])/m-u[2]*d[1])),y=Math.round(c*o.getGutterForProjection(r.projection));return this.getImageData(p,x+y,_+y)}return null}prepareFrame(t){this.renderedProjection_?t.viewState.projection!==this.renderedProjection_&&(this.tileCache_.clear(),this.renderedProjection_=t.viewState.projection):this.renderedProjection_=t.viewState.projection;let e=this.getLayer().getSource();if(!e)return!1;let i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,n,s){let r=t.viewState,o=this.getLayer(),l=o.getRenderSource(),c=l.getTileGridForProjection(r.projection),h=Y(l);h in t.wantedTiles||(t.wantedTiles[h]={});let u=t.wantedTiles[h],f=o.getMapInternal(),g=Math.max(i-s,c.getMinZoom(),c.getZForResolution(Math.min(o.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):c.getResolution(0)),l.zDirection));for(let d=i;d>=g;--d){let m=c.getTileRangeForExtentAndZ(e,d,this.tempTileRange_),p=c.getResolution(d);for(let x=m.minX;x<=m.maxX;++x)for(let _=m.minY;_<=m.maxY;++_){let y=this.getTile(d,x,_,t);if(!y||!_n(n,y,d))continue;let S=y.getKey();if(u[S]=!0,y.getState()===I.IDLE&&!t.tileQueue.isKeyQueued(S)){let w=Pe(d,x,_,this.tempTileCoord_);t.tileQueue.enqueue([y,h,c.getTileCoordCenter(w),p])}}}}findStaleTile_(t,e){let i=this.tileCache_,n=t[0],s=t[1],r=t[2],o=this.getStaleKeys();for(let l=0;l<o.length;++l){let c=mn(o[l],n,s,r);if(i.containsKey(c)){let h=i.get(c);if(h.getState()===I.LOADED)return h.endTransition(Y(this)),_n(e,h,n),!0}}return!1}findAltTiles_(t,e,i,n){let s=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!s)return!1;let r=!0,o=this.tileCache_,c=this.getLayer().getRenderSource().getKey();for(let h=s.minX;h<=s.maxX;++h)for(let u=s.minY;u<=s.maxY;++u){let f=mn(c,i,h,u),g=!1;if(o.containsKey(f)){let d=o.get(f);d.getState()===I.LOADED&&(_n(n,d,i),g=!0)}g||(r=!1)}return r}renderFrame(t,e){this.renderComplete=!0;let i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,r=n.resolution,o=n.center,l=t.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getRevision(),f=h.getTileGridForProjection(s),g=f.getZForResolution(r,h.zDirection),d=f.getResolution(g),m=h.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let p=t.extent,x=h.getTilePixelRatio(l);this.prepareContainer(t,e);let _=this.context.canvas.width,y=this.context.canvas.height,T=i.extent&&le(i.extent,s);T&&(p=ht(p,le(i.extent,s)));let S=d*_/2/x,w=d*y/2/x,L=[o[0]-S,o[1]-w,o[0]+S,o[1]+w],E={};this.renderedTiles.length=0;let F=c.getPreload();if(t.nextExtent){let k=f.getZForResolution(n.nextResolution,h.zDirection),W=Qr(t,t.nextExtent);this.enqueueTiles(t,W,k,E,F)}let G=Qr(t,p);if(this.enqueueTiles(t,G,g,E,0),F>0&&setTimeout(()=>{this.enqueueTiles(t,G,g-1,E,F-1)},0),!(g in E))return this.container;let O=Y(this),D=t.time;for(let k of E[g]){let W=k.getState();if((k instanceof Ze||k instanceof Hr)&&W===I.EMPTY)continue;let z=k.tileCoord;if(W===I.LOADED&&k.getAlpha(O,D)===1){k.endTransition(O);continue}if(this.renderComplete=!1,this.findStaleTile_(z,E)){el(E,k,g),t.animate=!0;continue}if(this.findAltTiles_(f,z,g+1,E))continue;let st=f.getMinZoom();for(let Q=g-1;Q>=st&&!this.findAltTiles_(f,z,Q,E);--Q);}let A=d/r*l/x,P=this.getRenderContext(t);ut(this.tempTransform,_/2,y/2,A,A,0,-_/2,-y/2),i.extent&&this.clipUnrotated(P,t,T),h.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,t);let v=Object.keys(E).map(Number);v.sort(Zt);let R,M=[],X=[];for(let k=v.length-1;k>=0;--k){let W=v[k],z=h.getTilePixelSize(W,l,s),C=f.getResolution(W)/d,st=z[0]*C*A,Q=z[1]*C*A,B=f.getTileCoordForCoordAndZ(vt(L),W),Ft=f.getTileCoordExtent(B),kt=V(this.tempTransform,[x*(Ft[0]-L[0])/d,x*(L[3]-Ft[3])/d]),gt=x*h.getGutterForProjection(s);for(let Bt of E[W]){if(Bt.getState()!==I.LOADED)continue;let Oe=Bt.tileCoord,Qe=B[1]-Oe[1],Di=Math.round(kt[0]-(Qe-1)*st),Ae=B[2]-Oe[2],ee=Math.round(kt[1]-(Ae-1)*Q),mt=Math.round(kt[0]-Qe*st),wt=Math.round(kt[1]-Ae*Q),pe=Di-mt,xe=ee-wt,ke=v.length===1,ie=!1;R=[mt,wt,mt+pe,wt,mt+pe,wt+xe,mt,wt+xe];for(let ye=0,Te=M.length;ye<Te;++ye)if(!ke&&W<X[ye]){let Z=M[ye];q([mt,wt,mt+pe,wt+xe],[Z[0],Z[3],Z[4],Z[7]])&&(ie||(P.save(),ie=!0),P.beginPath(),P.moveTo(R[0],R[1]),P.lineTo(R[2],R[3]),P.lineTo(R[4],R[5]),P.lineTo(R[6],R[7]),P.moveTo(Z[6],Z[7]),P.lineTo(Z[4],Z[5]),P.lineTo(Z[2],Z[3]),P.lineTo(Z[0],Z[1]),P.clip())}M.push(R),X.push(W),this.drawTile(Bt,t,mt,wt,pe,xe,gt,ke),ie&&P.restore(),this.renderedTiles.unshift(Bt),this.updateUsedTiles(t.usedTiles,h,Bt)}}this.renderedRevision=u,this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!Ce(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=l,this.renderedProjection=s,this.postRender(this.context,t),i.extent&&P.restore(),P.imageSmoothingEnabled=!0;let N=(k,W)=>{let z=Y(h),J=W.wantedTiles[z],C=J?Object.keys(J).length:0;this.updateCacheSize(C),this.tileCache_.expireCache()};return t.postRenderFunctions.push(N),this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,n,s,r,o,l){let c;if(t instanceof Be){if(c=ve(t.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(t);if(!c)return;let h=this.getRenderContext(e),u=Y(this),f=e.layerStatesArray[e.layerIndex],g=f.opacity*(l?t.getAlpha(u,e.time):1),d=g!==h.globalAlpha;d&&(h.save(),h.globalAlpha=g),h.drawImage(c,o,o,c.width-2*o,c.height-2*o,i,n,s,r),d&&h.restore(),g!==f.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){let t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){let n=Y(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}},$r=pn;var xn=class extends jr{constructor(t){super(t)}createRenderer(){return new $r(this,{cacheSize:this.getCacheSize()})}},to=xn;var He={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},qe=[He.FILL],Mt=[He.STROKE],zt=[He.BEGIN_PATH],yn=[He.CLOSE_PATH],b=He;var Tn=class{drawCustom(t,e,i,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},Ci=Tn;var Sn=class extends Ci{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){let i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates,r=s.length;for(let o=0,l=t.length;o<l;o+=e)n[0]=t[o],n[1]=t[o+1],Et(i,n)&&(s[r++]=n[0],s[r++]=n[1]);return r}appendFlatLineCoordinates(t,e,i,n,s,r){let o=this.coordinates,l=o.length,c=this.getBufferedMaxExtent();r&&(e+=n);let h=t[e],u=t[e+1],f=this.tmpCoordinate_,g=!0,d,m,p;for(d=e+n;d<i;d+=n)f[0]=t[d],f[1]=t[d+1],p=Us(c,f),p!==m?(g&&(o[l++]=h,o[l++]=u,g=!1),o[l++]=f[0],o[l++]=f[1]):p===Ns.INTERSECTING?(o[l++]=f[0],o[l++]=f[1],g=!1):g=!0,h=f[0],u=f[1],m=p;return(s&&g||d===e+n)&&(o[l++]=h,o[l++]=u),l}drawCustomCoordinates_(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){let l=i[r],c=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);s.push(c),e=l}return e}drawCustom(t,e,i,n,s){this.beginGeometry(t,e,s);let r=t.getType(),o=t.getStride(),l=this.coordinates.length,c,h,u,f,g;switch(r){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),f=[];let d=t.getEndss();g=0;for(let m=0,p=d.length;m<p;++m){let x=[];g=this.drawCustomCoordinates_(c,g,d[m],o,x),f.push(x)}this.instructions.push([b.CUSTOM,l,f,t,i,Xi,s]),this.hitDetectionInstructions.push([b.CUSTOM,l,f,t,n||i,Xi,s]);break;case"Polygon":case"MultiLineString":u=[],c=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(c,0,t.getEnds(),o,u),this.instructions.push([b.CUSTOM,l,u,t,i,Wi,s]),this.hitDetectionInstructions.push([b.CUSTOM,l,u,t,n||i,Wi,s]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,o,!1,!1),this.instructions.push([b.CUSTOM,l,h,t,i,Ue,s]),this.hitDetectionInstructions.push([b.CUSTOM,l,h,t,n||i,Ue,s]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,o),h>l&&(this.instructions.push([b.CUSTOM,l,h,t,i,Ue,s]),this.hitDetectionInstructions.push([b.CUSTOM,l,h,t,n||i,Ue,s]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([b.CUSTOM,l,h,t,i,void 0,s]),this.hitDetectionInstructions.push([b.CUSTOM,l,h,t,n||i,void 0,s]);break;default:}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[b.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[b.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let e,i=t.length,n,s,r=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==b.END_GEOMETRY?r=e:s==b.BEGIN_GEOMETRY&&(n[2]=e,bs(this.hitDetectionInstructions,r,e),r=-1)}setFillStrokeStyle(t,e){let i=this.state;if(t){let n=t.getColor();i.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,i.fillStyle=Ct(n||tt)}else i.fillStyle=void 0;if(e){let n=e.getColor();i.strokeStyle=Ct(n||ue);let s=e.getLineCap();i.lineCap=s!==void 0?s:ae;let r=e.getLineDash();i.lineDash=r?r.slice():ot;let o=e.getLineDashOffset();i.lineDashOffset=o||lt;let l=e.getLineJoin();i.lineJoin=l!==void 0?l:he;let c=e.getWidth();i.lineWidth=c!==void 0?c:fe;let h=e.getMiterLimit();i.miterLimit=h!==void 0?h:ce,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){let e=t.fillStyle,i=[b.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[b.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){let i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){let i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!Dt(t.currentLineDash,s)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let e=[b.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=zs(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;Ee(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Ot=Sn;var En=class extends Ot{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!Et(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);let n=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,s);this.instructions.push([b.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([b.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);let n=t.getFlatCoordinates(),s=[];for(let l=0,c=n.length;l<c;l+=t.getStride())(!this.maxExtent||Et(this.maxExtent,n.slice(l,l+2)))&&s.push(n[l],n[l+1]);let r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,2);this.instructions.push([b.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([b.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){let i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},eo=En;var Cn=class extends Ot{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){let s=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[b.MOVE_TO_LINE_TO,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){let n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([b.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ot,lt],zt);let o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(Mt),this.endGeometry(e)}drawMultiLineString(t,e,i){let n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([b.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ot,lt],zt);let o=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),h=0;for(let u=0,f=o.length;u<f;++u)h=this.drawFlatCoordinates_(l,h,o[u],c);this.hitDetectionInstructions.push(Mt),this.endGeometry(e)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Mt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Mt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(zt)}},io=Cn;var Rn=class extends Ot{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){let s=this.state,r=s.fillStyle!==void 0,o=s.strokeStyle!==void 0,l=i.length;this.instructions.push(zt),this.hitDetectionInstructions.push(zt);for(let c=0;c<l;++c){let h=i[c],u=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,h,n,!0,!o),g=[b.MOVE_TO_LINE_TO,u,f];this.instructions.push(g),this.hitDetectionInstructions.push(g),o&&(this.instructions.push(yn),this.hitDetectionInstructions.push(yn)),e=h}return r&&(this.instructions.push(qe),this.hitDetectionInstructions.push(qe)),o&&(this.instructions.push(Mt),this.hitDetectionInstructions.push(Mt)),e}drawCircle(t,e,i){let n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_FILL_STYLE,tt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ot,lt]);let o=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);let h=[b.CIRCLE,c];this.instructions.push(zt,h),this.hitDetectionInstructions.push(zt,h),n.fillStyle!==void 0&&(this.instructions.push(qe),this.hitDetectionInstructions.push(qe)),n.strokeStyle!==void 0&&(this.instructions.push(Mt),this.hitDetectionInstructions.push(Mt)),this.endGeometry(e)}drawPolygon(t,e,i){let n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_FILL_STYLE,tt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ot,lt]);let o=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,o,c),this.endGeometry(e)}drawMultiPolygon(t,e,i){let n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_FILL_STYLE,tt]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([b.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ot,lt]);let o=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),h=0;for(let u=0,f=o.length;u<f;++u)h=this.drawFlatCoordinatess_(l,h,o[u],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=hr(e[i],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}},In=Rn;function no(a,t,e,i,n){let s=[],r=e,o=0,l=t.slice(e,2);for(;o<a&&r+n<i;){let[c,h]=l.slice(-2),u=t[r+n],f=t[r+n+1],g=Math.sqrt((u-c)*(u-c)+(f-h)*(f-h));if(o+=g,o>=a){let d=(a-o+g)/g,m=rt(c,u,d),p=rt(h,f,d);l.push(m,p),s.push(l),l=[m,p],o==a&&(r+=n),o=0}else if(o<a)l.push(t[r+n],t[r+n+1]),r+=n;else{let d=g-o,m=rt(c,u,d/g),p=rt(h,f,d/g);l.push(m,p),s.push(l),l=[m,p],o=0,r+=n}}return o>0&&s.push(l),s}function so(a,t,e,i,n){let s=e,r=e,o=0,l=0,c=e,h,u,f,g,d,m,p,x,_,y;for(u=e;u<i;u+=n){let T=t[u],S=t[u+1];d!==void 0&&(_=T-d,y=S-m,g=Math.sqrt(_*_+y*y),p!==void 0&&(l+=f,h=Math.acos((p*_+x*y)/(f*g)),h>a&&(l>o&&(o=l,s=c,r=u),l=0,c=u-n)),f=g,p=_,x=y),d=T,m=S}return l+=g,l>o?[c,u]:[s,r]}var Ve={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Fn=class extends Ot{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[tt]={fillStyle:tt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){let n=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!n&&!s)return;let o=this.coordinates,l=o.length,c=t.getType(),h=null,u=t.getStride();if(r.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!q(this.maxExtent,t.getExtent()))return;let f;if(h=t.getFlatCoordinates(),c=="LineString")f=[h.length];else if(c=="MultiLineString")f=t.getEnds();else if(c=="Polygon")f=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let p=t.getEndss();f=[];for(let x=0,_=p.length;x<_;++x)f.push(p[x][0])}this.beginGeometry(t,e,i);let g=r.repeat,d=g?void 0:r.textAlign,m=0;for(let p=0,x=f.length;p<x;++p){let _;g?_=no(g*this.resolution,h,m,f[p],u):_=[h.slice(m,f[p])];for(let y=0,T=_.length;y<T;++y){let S=_[y],w=0,L=S.length;if(d==null){let F=so(r.maxAngle,S,0,S.length,2);w=F[0],L=F[1]}for(let F=w;F<L;F+=u)o.push(S[F],S[F+1]);let E=o.length;m=f[p],this.drawChars_(l,E),l=E}}this.endGeometry(e)}else{let f=r.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),r.overflow||f.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":let _=t.getFlatInteriorPoints();h=[];for(let y=0,T=_.length;y<T;y+=3)r.overflow||f.push(_[y+2]/this.resolution),h.push(_[y],_[y+1]);if(h.length===0)return;u=2;break;default:}let g=this.appendFlatPointCoordinates(h,u);if(g===l)return;if(f&&(g-l)/2!==h.length/u){let _=l/2;f=f.filter((y,T)=>{let S=o[(_+T)*2]===h[T*u]&&o[(_+T)*2+1]===h[T*u+1];return S||--_,S})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&this.updateFillStyle(this.state,this.createFill),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let d=r.padding;if(d!=Nt&&(r.scale[0]<0||r.scale[1]<0)){let _=r.padding[0],y=r.padding[1],T=r.padding[2],S=r.padding[3];r.scale[0]<0&&(y=-y,S=-S),r.scale[1]<0&&(_=-_,T=-T),d=[_,y,T,S]}let m=this.pixelRatio;this.instructions.push([b.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,d==Nt?Nt:d.map(function(_){return _*m}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);let p=1/m,x=this.state.fillStyle;r.backgroundFill&&(this.state.fillStyle=tt,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([b.DRAW_IMAGE,l,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,this.declutterMode_,this.declutterImageWithText_,d,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?tt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),r.backgroundFill&&(this.state.fillStyle=x,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){let t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Jt,justify:e.justify,textBaseline:e.textBaseline||de,scale:e.scale});let r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){let i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=Ve[n.textBaseline],h=this.textOffsetY_*l,u=this.text_,f=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([b.DRAW_CHARS,t,e,c,n.overflow,o,n.maxAngle,l,h,s,f*l,u,r,1,this.declutterMode_]),this.hitDetectionInstructions.push([b.DRAW_CHARS,t,e,c,n.overflow,o&&tt,n.maxAngle,l,h,s,f*l,u,r,1/l,this.declutterMode_])}setTextStyle(t,e){let i,n,s;if(!t)this.text_="";else{let r=t.getFill();r?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Ct(r.getColor()||tt)):(n=null,this.textFillState_=n);let o=t.getStroke();if(!o)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);let d=o.getLineDash(),m=o.getLineDashOffset(),p=o.getWidth(),x=o.getMiterLimit();s.lineCap=o.getLineCap()||ae,s.lineDash=d?d.slice():ot,s.lineDashOffset=m===void 0?lt:m,s.lineJoin=o.getLineJoin()||he,s.lineWidth=p===void 0?fe:p,s.miterLimit=x===void 0?ce:x,s.strokeStyle=Ct(o.getColor()||ue)}i=this.textState_;let l=t.getFont()||di;Cr(l);let c=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||de,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Nt,i.scale=c===void 0?[1,1]:c;let h=t.getOffsetX(),u=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=f===void 0?!1:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Y(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+Y(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},ro=Fn;var il={Circle:In,Default:Ot,Image:eo,LineString:io,Polygon:In,Text:ro},wn=class{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){let t={};for(let e in this.buildersByZIndex_){t[e]=t[e]||{};let i=this.buildersByZIndex_[e];for(let n in i){let s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){let i=t!==void 0?t.toString():"0",n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];if(s===void 0){let r=il[e];s=new r(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}},oo=wn;function lo(a,t,e,i,n,s,r,o,l,c,h,u){let f=a[t],g=a[t+1],d=0,m=0,p=0,x=0;function _(){d=f,m=g,t+=i,f=a[t],g=a[t+1],x+=p,p=Math.sqrt((f-d)*(f-d)+(g-m)*(g-m))}do _();while(t<e-i&&x+p<s);let y=p===0?0:(s-x)/p,T=rt(d,f,y),S=rt(m,g,y),w=t-i,L=x,E=s+o*l(c,n,h);for(;t<e-i&&x+p<E;)_();y=p===0?0:(E-x)/p;let F=rt(d,f,y),G=rt(m,g,y),O;if(u){let R=[T,S,F,G];rr(R,0,4,2,u,R,R),O=R[0]>R[2]}else O=T>F;let D=Math.PI,A=[],P=w+i===t;t=w,p=0,x=L,f=a[t],g=a[t+1];let v;if(P){_(),v=Math.atan2(g-m,f-d),O&&(v+=v>0?-D:D);let R=(F+T)/2,M=(G+S)/2;return A[0]=[R,M,(E-s)/2,v,n],A}n=n.replace(/\n/g," ");for(let R=0,M=n.length;R<M;){_();let X=Math.atan2(g-m,f-d);if(O&&(X+=X>0?-D:D),v!==void 0){let C=X-v;if(C+=C>D?-2*D:C<-D?2*D:0,Math.abs(C)>r)return null}v=X;let N=R,k=0;for(;R<M;++R){let C=O?M-R-1:R,st=o*l(c,n[C],h);if(t+i<e&&x+p<s+k+st/2)break;k+=st}if(R===N)continue;let W=O?n.substring(M-N,M-R):n.substring(N,R);y=p===0?0:(s+k/2-x)/p;let z=rt(d,f,y),J=rt(m,g,y);A.push([z,J,k/2,X,W]),s+=k}return A}var be=it(),Qt=[],Ut=[],Kt=[],$t=[];function ao(a){return a[3].declutterBox}var ho=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function Ln(a,t){return t==="start"?t=ho.test(a)?"right":"left":t==="end"&&(t=ho.test(a)?"left":"right"),Ve[t]}function nl(a,t,e){return e>0&&a.push(`
`,""),a.push(t,""),a}var Dn=class{constructor(t,e,i,n,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=ct(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new fi:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,n){let s=t+e+i+n;if(this.labels_[s])return this.labels_[s];let r=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,l=this.textStates[e],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],u=l.justify?Ve[l.justify]:Ln(Array.isArray(t)?t[0]:t,l.textAlign||Jt),f=n&&r.lineWidth?r.lineWidth:0,g=Array.isArray(t)?t:String(t).split(`
`).reduce(nl,[]),{width:d,height:m,widths:p,heights:x,lineWidths:_}=Rr(l,g),y=d+f,T=[],S=(y+2)*h[0],w=(m+f)*h[1],L={width:S<0?Math.floor(S):Math.ceil(S),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:T};(h[0]!=1||h[1]!=1)&&T.push("scale",h),n&&(T.push("strokeStyle",r.strokeStyle),T.push("lineWidth",f),T.push("lineCap",r.lineCap),T.push("lineJoin",r.lineJoin),T.push("miterLimit",r.miterLimit),T.push("setLineDash",[r.lineDash]),T.push("lineDashOffset",r.lineDashOffset)),i&&T.push("fillStyle",o.fillStyle),T.push("textBaseline","middle"),T.push("textAlign","center");let E=.5-u,F=u*y+E*f,G=[],O=[],D=0,A=0,P=0,v=0,R;for(let M=0,X=g.length;M<X;M+=2){let N=g[M];if(N===`
`){A+=D,D=0,F=u*y+E*f,++v;continue}let k=g[M+1]||l.font;k!==R&&(n&&G.push("font",k),i&&O.push("font",k),R=k),D=Math.max(D,x[P]);let W=[N,F+E*p[P]+u*(p[P]-_[v]),.5*(f+D)+A];F+=p[P],n&&G.push("strokeText",W),i&&O.push("fillText",W),++P}return Array.prototype.push.apply(T,G),Array.prototype.push.apply(T,O),this.labels_[s]=L,L}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignAndScaleFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,r,o,l,c,h,u,f,g,d,m,p){o*=f[0],l*=f[1];let x=i-o,_=n-l,y=s+c>t?t-c:s,T=r+h>e?e-h:r,S=d[3]+y*f[0]+d[1],w=d[0]+T*f[1]+d[2],L=x-d[3],E=_-d[0];(m||u!==0)&&(Qt[0]=L,$t[0]=L,Qt[1]=E,Ut[1]=E,Ut[0]=L+S,Kt[0]=Ut[0],Kt[1]=E+w,$t[1]=Kt[1]);let F;return u!==0?(F=ut(ct(),i,n,1,1,u,-i,-n),V(F,Qt),V(F,Ut),V(F,Kt),V(F,$t),Yt(Math.min(Qt[0],Ut[0],Kt[0],$t[0]),Math.min(Qt[1],Ut[1],Kt[1],$t[1]),Math.max(Qt[0],Ut[0],Kt[0],$t[0]),Math.max(Qt[1],Ut[1],Kt[1],$t[1]),be)):Yt(Math.min(L,L+S),Math.min(E,E+w),Math.max(L,L+S),Math.max(E,E+w),be),g&&(x=Math.round(x),_=Math.round(_)),{drawImageX:x,drawImageY:_,drawImageW:y,drawImageH:T,originX:c,originY:h,declutterBox:{minX:be[0],minY:be[1],maxX:be[2],maxY:be[3],value:p},canvasTransform:F,scale:f}}replayImageOrLabel_(t,e,i,n,s,r,o){let l=!!(r||o),c=n.declutterBox,h=o?o[2]*n.scale[0]/2:0;return c.minX-h<=e[0]&&c.maxX+h>=0&&c.minY-h<=e[1]&&c.maxY+h>=0&&(l&&this.replayTextBackground_(t,Qt,Ut,Kt,$t,r,o),Ir(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){let e=this.alignAndScaleFill_;if(e){let i=V(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(i[0]%n,i[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){let s=this.textStates[e],r=this.createLabel(t,e,n,i),o=this.strokeStates[i],l=this.pixelRatio,c=Ln(Array.isArray(t)?t[0]:t,s.textAlign||Jt),h=Ve[s.textBaseline||de],u=o&&o.lineWidth?o.lineWidth:0,f=r.width/l-2*s.scale[0],g=c*f+2*(.5-c)*u,d=h*r.height/l+2*(.5-h)*u;return{label:r,anchorX:g,anchorY:d}}execute_(t,e,i,n,s,r,o,l){let c=this.zIndexContext_,h;this.pixelCoordinates_&&Dt(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Pt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),ir(this.renderedTransform_,i));let u=0,f=n.length,g=0,d,m,p,x,_,y,T,S,w,L,E,F,G,O=0,D=0,A=null,P=null,v=this.coordinateCache_,R=this.viewRotation_,M=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,X={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:R},N=this.instructions!=n||this.overlaps?0:200,k,W,z,J;for(;u<f;){let C=n[u];switch(C[0]){case b.BEGIN_GEOMETRY:k=C[1],J=C[3],k.getGeometry()?o!==void 0&&!q(o,J.getExtent())?u=C[2]+1:++u:u=C[2],c&&(c.zIndex=C[4]);break;case b.BEGIN_PATH:O>N&&(this.fill_(t),O=0),D>N&&(t.stroke(),D=0),!O&&!D&&(t.beginPath(),_=NaN,y=NaN),++u;break;case b.CIRCLE:g=C[1];let Q=h[g],B=h[g+1],Ft=h[g+2],kt=h[g+3],gt=Ft-Q,Bt=kt-B,Oe=Math.sqrt(gt*gt+Bt*Bt);t.moveTo(Q+Oe,B),t.arc(Q,B,Oe,0,2*Math.PI,!0),++u;break;case b.CLOSE_PATH:t.closePath(),++u;break;case b.CUSTOM:g=C[1],d=C[2];let Qe=C[3],Di=C[4],Ae=C[5];X.geometry=Qe,X.feature=k,u in v||(v[u]=[]);let ee=v[u];Ae?Ae(h,g,d,2,ee):(ee[0]=h[g],ee[1]=h[g+1],ee.length=2),c&&(c.zIndex=C[6]),Di(ee,X),++u;break;case b.DRAW_IMAGE:g=C[1],d=C[2],w=C[3],m=C[4],p=C[5];let mt=C[6],wt=C[7],pe=C[8],xe=C[9],ke=C[10],ie=C[11],ye=C[12],Te=C[13];x=C[14]||"declutter";let Z=C[15];if(!w&&C.length>=20){L=C[19],E=C[20],F=C[21],G=C[22];let _t=this.drawLabelWithPointPlacement_(L,E,F,G);w=_t.label,C[3]=w;let ne=C[23];m=(_t.anchorX-ne)*this.pixelRatio,C[4]=m;let pt=C[24];p=(_t.anchorY-pt)*this.pixelRatio,C[5]=p,mt=w.height,C[6]=mt,Te=w.width,C[13]=Te}let vi;C.length>25&&(vi=C[25]);let Pi,$e,ti;C.length>17?(Pi=C[16],$e=C[17],ti=C[18]):(Pi=Nt,$e=!1,ti=!1),ke&&M?ie+=R:!ke&&!M&&(ie-=R);let Wo=0;for(;g<d;g+=2){if(vi&&vi[Wo++]<Te/this.pixelRatio)continue;let _t=this.calculateImageOrLabelDimensions_(w.width,w.height,h[g],h[g+1],Te,mt,m,p,pe,xe,ie,ye,s,Pi,$e||ti,k),ne=[t,e,w,_t,wt,$e?A:null,ti?P:null];if(l){let pt,Lt,xt;if(Z){let U=d-g;if(!Z[U]){Z[U]={args:ne,declutterMode:x};continue}let et=Z[U];pt=et.args,Lt=et.declutterMode,delete Z[U],xt=ao(pt)}let Gt,Wt;if(pt&&(Lt!=="declutter"||!l.collides(xt))&&(Gt=!0),(x!=="declutter"||!l.collides(_t.declutterBox))&&(Wt=!0),Lt==="declutter"&&x==="declutter"){let U=Gt&&Wt;Gt=U,Wt=U}Gt&&(Lt!=="none"&&l.insert(xt),this.replayImageOrLabel_.apply(this,pt)),Wt&&(x!=="none"&&l.insert(_t.declutterBox),this.replayImageOrLabel_.apply(this,ne))}else this.replayImageOrLabel_.apply(this,ne)}++u;break;case b.DRAW_CHARS:let Qn=C[1],$n=C[2],bi=C[3],Xo=C[4];G=C[5];let Yo=C[6],ts=C[7],es=C[8];F=C[9];let Mi=C[10];L=C[11],E=C[12];let is=[C[13],C[13]];x=C[14]||"declutter";let Oi=this.textStates[E],Ge=Oi.font,We=[Oi.scale[0]*ts,Oi.scale[1]*ts],Xe;Ge in this.widths_?Xe=this.widths_[Ge]:(Xe={},this.widths_[Ge]=Xe);let ns=Xr(h,Qn,$n,2),ss=Math.abs(We[0])*Ki(Ge,L,Xe);if(Xo||ss<=ns){let _t=this.textStates[E].textAlign,ne=(ns-ss)*Ln(L,_t),pt=lo(h,Qn,$n,2,L,ne,Yo,Math.abs(We[0]),Ki,Ge,Xe,M?0:this.viewRotation_);t:if(pt){let Lt=[],xt,Gt,Wt,U,et;if(F)for(xt=0,Gt=pt.length;xt<Gt;++xt){et=pt[xt],Wt=et[4],U=this.createLabel(Wt,E,"",F),m=et[2]+(We[0]<0?-Mi:Mi),p=bi*U.height+(.5-bi)*2*Mi*We[1]/We[0]-es;let Xt=this.calculateImageOrLabelDimensions_(U.width,U.height,et[0],et[1],U.width,U.height,m,p,0,0,et[3],is,!1,Nt,!1,k);if(l&&x==="declutter"&&l.collides(Xt.declutterBox))break t;Lt.push([t,e,U,Xt,1,null,null])}if(G)for(xt=0,Gt=pt.length;xt<Gt;++xt){et=pt[xt],Wt=et[4],U=this.createLabel(Wt,E,G,""),m=et[2],p=bi*U.height-es;let Xt=this.calculateImageOrLabelDimensions_(U.width,U.height,et[0],et[1],U.width,U.height,m,p,0,0,et[3],is,!1,Nt,!1,k);if(l&&x==="declutter"&&l.collides(Xt.declutterBox))break t;Lt.push([t,e,U,Xt,1,null,null])}l&&x!=="none"&&l.load(Lt.map(ao));for(let Xt=0,jo=Lt.length;Xt<jo;++Xt)this.replayImageOrLabel_.apply(this,Lt[Xt])}}++u;break;case b.END_GEOMETRY:if(r!==void 0){k=C[1];let _t=r(k,J,x);if(_t)return _t}++u;break;case b.FILL:N?O++:this.fill_(t),++u;break;case b.MOVE_TO_LINE_TO:for(g=C[1],d=C[2],W=h[g],z=h[g+1],t.moveTo(W,z),_=W+.5|0,y=z+.5|0,g+=2;g<d;g+=2)W=h[g],z=h[g+1],T=W+.5|0,S=z+.5|0,(g==d-2||T!==_||S!==y)&&(t.lineTo(W,z),_=T,y=S);++u;break;case b.SET_FILL_STYLE:A=C,this.alignAndScaleFill_=C[2],O&&(this.fill_(t),O=0,D&&(t.stroke(),D=0)),t.fillStyle=C[1],++u;break;case b.SET_STROKE_STYLE:P=C,D&&(t.stroke(),D=0),this.setStrokeStyle_(t,C),++u;break;case b.STROKE:N?D++:t.stroke(),++u;break;default:++u;break}}O&&this.fill_(t),D&&t.stroke()}execute(t,e,i,n,s,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,r)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,s)}},co=Dn;var me=["Polygon","Circle","LineString","Image","Text","Default"],bn=["Image","Text"],uo=me.filter(a=>!bn.includes(a)),Pn=class{constructor(t,e,i,n,s,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ct(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,o)}clip(t,e){let i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(let i in t){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);let s=t[i];for(let r in s){let o=s[r];n[r]=new co(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(let e in this.executorsByZIndex_){let i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,r){n=Math.round(n);let o=n*2+1,l=ut(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=K(o,o,void 0,{willReadFrequently:!0}));let h=this.hitDetectionContext_;h.canvas.width!==o||h.canvas.height!==o?(h.canvas.width=o,h.canvas.height=o):c||h.clearRect(0,0,o,o);let u;this.renderBuffer_!==void 0&&(u=it(),Re(u,t),Ee(u,e*(this.renderBuffer_+n),u));let f=sl(n),g;function d(S,w,L){let E=h.getImageData(0,0,o,o).data;for(let F=0,G=f.length;F<G;F++)if(E[f[F]]>0){if(!r||L==="none"||g!=="Image"&&g!=="Text"||r.includes(S)){let O=(f[F]-3)/4,D=n-O%o,A=n-(O/o|0),P=s(S,w,D*D+A*A);if(P)return P}h.clearRect(0,0,o,o);break}}let m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(Zt);let p,x,_,y,T;for(p=m.length-1;p>=0;--p){let S=m[p].toString();for(_=this.executorsByZIndex_[S],x=me.length-1;x>=0;--x)if(g=me[x],y=_[g],y!==void 0&&(T=y.executeHitDetection(h,l,i,d,u),T))return T}}getClipCoords(t){let e=this.maxExtent_;if(!e)return null;let i=e[0],n=e[1],s=e[2],r=e[3],o=[i,n,i,r,s,r,s,n];return Pt(o,0,8,2,t,o),o}isEmpty(){return se(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(Zt),r=r||me;let c=me.length,h,u,f,g,d;for(o&&l.reverse(),h=0,u=l.length;h<u;++h){let m=l[h].toString();for(d=this.executorsByZIndex_[m],f=0,g=r.length;f<g;++f){let p=r[f],x=d[p];if(x!==void 0){let _=o===null?void 0:x.getZIndexContext(),y=_?_.getContext():t,T=this.maxExtent_&&p!=="Image"&&p!=="Text";if(T&&(y.save(),this.clip(y,i)),!_||p==="Text"||p==="Image"?x.execute(y,e,i,n,s,o):_.pushFunction(S=>x.execute(S,e,i,n,s,o)),T&&y.restore(),_){_.offset();let S=l[h]*c+f;this.deferredZIndexContexts_[S]||(this.deferredZIndexContexts_[S]=[]),this.deferredZIndexContexts_[S].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Zt);for(let i=0,n=e.length;i<n;++i)t[e[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),t[e[i]].length=0}},vn={};function sl(a){if(vn[a]!==void 0)return vn[a];let t=a*2+1,e=a*a,i=new Array(e+1);for(let s=0;s<=a;++s)for(let r=0;r<=a;++r){let o=s*s+r*r;if(o>e)break;let l=i[o];l||(l=[],i[o]=l),l.push(((a+s)*t+(a+r))*4+3),s>0&&l.push(((a-s)*t+(a+r))*4+3),r>0&&(l.push(((a+s)*t+(a-r))*4+3),s>0&&l.push(((a-s)*t+(a-r))*4+3))}let n=[];for(let s=0,r=i.length;s<r;++s)i[s]&&n.push(...i[s]);return vn[a]=n,n}var fo=Pn;var Mn=class extends Ci{constructor(t,e,i,n,s,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?Ys(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ct()}drawImages_(t,e,i,n){if(!this.image_)return;let s=Pt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,l=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=s.length;h<u;h+=2){let f=s[h]-this.imageAnchorX_,g=s[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let d=f+this.imageAnchorX_,m=g+this.imageAnchorY_;ut(o,d,m,1,1,c,-d,-m),r.save(),r.transform.apply(r,o),r.translate(d,m),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let s=Pt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){let l=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(l-this.textOffsetX_,c-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,l,c),this.textFillState_&&r.fillText(this.text_,l,c))}}moveToLineTo_(t,e,i,n,s){let r=this.context_,o=Pt(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let l=o.length;s&&(l-=2);for(let c=2;c<l;c+=2)r.lineTo(o[c],o[c+1]);return s&&r.closePath(),i}drawRings_(t,e,i,n){for(let s=0,r=i.length;s<r;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!q(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=or(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),r=this.context_;r.beginPath(),r.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break;default:}}drawFeature(t,e){let i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){let e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!q(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){let e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getExtent();if(q(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let i=this.context_,n=t.getFlatCoordinates(),s=0,r=t.getEnds(),o=t.getStride();i.beginPath();for(let l=0,c=r.length;l<c;++l)s=this.moveToLineTo_(n,s,r[l],o,!1);i.stroke()}if(this.text_!==""){let i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!q(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!q(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_,i=t.getOrientedFlatCoordinates(),n=0,s=t.getEndss(),r=t.getStride();e.beginPath();for(let o=0,l=s.length;o<l;++o){let c=s[o];n=this.drawRings_(i,n,c,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){let e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Dt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:Jt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{let i=t.getColor();this.fillState_={fillStyle:Ct(i||tt)}}if(!e)this.strokeState_=null;else{let i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),h=s||ot;this.strokeState_={lineCap:n!==void 0?n:ae,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(r||lt)*this.pixelRatio_,lineJoin:o!==void 0?o:he,lineWidth:(l!==void 0?l:fe)*this.pixelRatio_,miterLimit:c!==void 0?c:ce,strokeStyle:Ct(i||ue)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}let i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{let e=t.getFill();if(!e)this.textFillState_=null;else{let g=e.getColor();this.textFillState_={fillStyle:Ct(g||tt)}}let i=t.getStroke();if(!i)this.textStrokeState_=null;else{let g=i.getColor(),d=i.getLineCap(),m=i.getLineDash(),p=i.getLineDashOffset(),x=i.getLineJoin(),_=i.getWidth(),y=i.getMiterLimit();this.textStrokeState_={lineCap:d!==void 0?d:ae,lineDash:m||ot,lineDashOffset:p||lt,lineJoin:x!==void 0?x:he,lineWidth:_!==void 0?_:fe,miterLimit:y!==void 0?y:ce,strokeStyle:Ct(g||ue)}}let n=t.getFont(),s=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:n!==void 0?n:di,textAlign:u!==void 0?u:Jt,textBaseline:f!==void 0?f:de},this.text_=h!==void 0?Array.isArray(h)?h.reduce((g,d,m)=>g+=m%2?" ":d,""):h:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}},go=Mn;var It=.5;function mo(a,t,e,i,n,s,r,o,l){let c=l?Fe(n,l):n,h=a[0]*It,u=a[1]*It,f=K(h,u);f.imageSmoothingEnabled=!1;let g=f.canvas,d=new go(f,It,n,null,r,o,l?ui(ze(),l):null),m=e.length,p=Math.floor((256*256*256-1)/m),x={};for(let y=1;y<=m;++y){let T=e[y-1],S=T.getStyleFunction()||i;if(!S)continue;let w=S(T,s);if(!w)continue;Array.isArray(w)||(w=[w]);let E=(y*p).toString(16).padStart(7,"#00000");for(let F=0,G=w.length;F<G;++F){let O=w[F],D=O.getGeometryFunction()(T);if(!D||!q(c,D.getExtent()))continue;let A=O.clone(),P=A.getFill();P&&P.setColor(E);let v=A.getStroke();v&&(v.setColor(E),v.setLineDash(null)),A.setText(void 0);let R=O.getImage();if(R){let k=R.getImageSize();if(!k)continue;let W=K(k[0],k[1],void 0,{alpha:!1}),z=W.canvas;W.fillStyle=E,W.fillRect(0,0,z.width,z.height),A.setImage(new Bi({img:z,anchor:R.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:R.getOrigin(),opacity:1,size:R.getSize(),scale:R.getScale(),rotation:R.getRotation(),rotateWithView:R.getRotateWithView()}))}let M=A.getZIndex()||0,X=x[M];X||(X={},x[M]=X,X.Polygon=[],X.Circle=[],X.LineString=[],X.Point=[]);let N=D.getType();if(N==="GeometryCollection"){let k=D.getGeometriesArrayRecursive();for(let W=0,z=k.length;W<z;++W){let J=k[W];X[J.getType().replace("Multi","")].push(J,A)}}else X[N.replace("Multi","")].push(D,A)}}let _=Object.keys(x).map(Number).sort(Zt);for(let y=0,T=_.length;y<T;++y){let S=x[_[y]];for(let w in S){let L=S[w];for(let E=0,F=L.length;E<F;E+=2){d.setStyle(L[E+1]);for(let G=0,O=t.length;G<O;++G)d.setTransform(t[G]),d.drawGeometry(L[E])}}}return f.getImageData(0,0,g.width,g.height)}function _o(a,t,e){let i=[];if(e){let n=Math.floor(Math.round(a[0])*It),s=Math.floor(Math.round(a[1])*It),r=(St(n,0,e.width-1)+St(s,0,e.height-1)*e.width)*4,o=e.data[r],l=e.data[r+1],h=e.data[r+2]+256*(l+256*o),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&i.push(t[h/u-1])}return i}var rl=.5,po={Point:dl,LineString:hl,Polygon:gl,MultiPoint:fl,MultiLineString:cl,MultiPolygon:ul,GeometryCollection:al,Circle:ol};function xo(a,t){return parseInt(Y(a),10)-parseInt(Y(t),10)}function On(a,t){let e=An(a,t);return e*e}function An(a,t){return rl*a/t}function ol(a,t,e,i,n){let s=e.getFill(),r=e.getStroke();if(s||r){let l=a.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,r),l.drawCircle(t,i,n)}let o=e.getText();if(o&&o.getText()){let l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function kn(a,t,e,i,n,s,r,o){let l=[],c=e.getImage();if(c){let f=!0,g=c.getImageState();g==dt.LOADED||g==dt.ERROR?f=!1:g==dt.IDLE&&c.load(),f&&l.push(c.ready())}let h=e.getFill();h&&h.loading()&&l.push(h.ready());let u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),ll(a,t,e,i,s,r,o),u}function ll(a,t,e,i,n,s,r){let o=e.getGeometryFunction()(t);if(!o)return;let l=o.simplifyTransformed(i,n);if(e.getRenderer())yo(a,l,e,t,r);else{let h=po[l.getType()];h(a,l,e,t,r,s)}}function yo(a,t,e,i,n){if(t.getType()=="GeometryCollection"){let r=t.getGeometries();for(let o=0,l=r.length;o<l;++o)yo(a,r[o],e,i,n);return}a.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),n)}function al(a,t,e,i,n,s){let r=t.getGeometriesArray(),o,l;for(o=0,l=r.length;o<l;++o){let c=po[r[o].getType()];c(a,r[o],e,i,n,s)}}function hl(a,t,e,i,n){let s=e.getStroke();if(s){let o=a.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(t,i,n)}let r=e.getText();if(r&&r.getText()){let o=a.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function cl(a,t,e,i,n){let s=e.getStroke();if(s){let o=a.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(t,i,n)}let r=e.getText();if(r&&r.getText()){let o=a.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function ul(a,t,e,i,n){let s=e.getFill(),r=e.getStroke();if(r||s){let l=a.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,r),l.drawMultiPolygon(t,i,n)}let o=e.getText();if(o&&o.getText()){let l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,n)}}function dl(a,t,e,i,n,s){let r=e.getImage(),o=e.getText(),l=o&&o.getText(),c=s&&r&&l?{}:void 0;if(r){if(r.getImageState()!=dt.LOADED)return;let h=a.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,c),h.drawPoint(t,i,n)}if(l){let h=a.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,c),h.drawText(t,i,n)}}function fl(a,t,e,i,n,s){let r=e.getImage(),o=r&&r.getOpacity()!==0,l=e.getText(),c=l&&l.getText(),h=s&&o&&c?{}:void 0;if(o){if(r.getImageState()!=dt.LOADED)return;let u=a.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,h),u.drawMultiPoint(t,i,n)}if(c){let u=a.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,h),u.drawText(t,i,n)}}function gl(a,t,e,i,n){let s=e.getFill(),r=e.getStroke();if(s||r){let l=a.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,r),l.drawPolygon(t,i,n)}let o=e.getText();if(o&&o.getText()){let l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,n)}}var Gn=class extends gi{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=it(),this.wrappedRenderedExtent_=it(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){let n=e.extent,s=e.viewState,r=s.center,o=s.resolution,l=s.projection,c=s.rotation,h=l.getExtent(),u=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),g=e.pixelRatio,d=e.viewHints,m=!(d[Ne.ANIMATING]||d[Ne.INTERACTING]),p=this.context,x=Math.round(j(n)/o*g),_=Math.round(nt(n)/o*g),y=u.getWrapX()&&l.canWrapX(),T=y?j(h):null,S=y?Math.ceil((n[2]-h[2])/T)+1:1,w=y?Math.floor((n[0]-h[0])/T):0;do{let L=this.getRenderTransform(r,o,0,g,x,_,w*T);e.declutter&&(L=L.slice(0)),t.execute(p,[p.canvas.width,p.canvas.height],L,c,m,i===void 0?me:i?bn:uo,i?f&&e.declutter[f]:void 0)}while(++w<S)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=K(this.context.canvas.width,this.context.canvas.height,sn))}resetDrawContext_(){if(this.opacity_!==1){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,bt(this.context),sn.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){let i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;let n=t.viewState;this.prepareContainer(t,e);let s=this.context,r=this.replayGroup_,o=r&&!r.isEmpty();if(!o&&!(this.getLayer().hasListener(qt.PRERENDER)||this.getLayer().hasListener(qt.POSTRENDER)))return null;this.setDrawContext_(),this.preRender(s,t);let l=n.projection;if(this.clipped_=!1,o&&i.extent&&this.clipping){let c=le(i.extent,l);o=q(c,t.extent),this.clipped_=o&&!re(c,t.extent),this.clipped_&&this.clipUnrotated(s,t,c)}return o&&this.renderWorlds(r,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&s.restore(),this.postRender(s,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let i=this.frameState.size.slice(),n=this.renderedCenter_,s=this.renderedResolution_,r=this.renderedRotation_,o=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=i[0]*It,f=i[1]*It;h.push(this.getRenderTransform(n,s,r,It,u,f,0).slice());let g=c.getSource(),d=o.getExtent();if(g.getWrapX()&&o.canWrapX()&&!re(d,l)){let p=l[0],x=j(d),_=0,y;for(;p<d[0];)--_,y=x*_,h.push(this.getRenderTransform(n,s,r,It,u,f,y).slice()),p+=x;for(_=0,p=l[2];p>d[2];)++_,y=x*_,h.push(this.getRenderTransform(n,s,r,It,u,f,y).slice()),p-=x}let m=ze();this.hitDetectionImageData_=mo(i,h,this.renderedFeatures_,c.getStyleFunction(),l,s,r,On(s,this.renderedPixelRatio_),m?o:null)}e(_o(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;let r=e.viewState.resolution,o=e.viewState.rotation,l=this.getLayer(),c={},h=function(d,m,p){let x=Y(d),_=c[x];if(_){if(_!==!0&&p<_.distanceSq){if(p===0)return c[x]=!0,s.splice(s.lastIndexOf(_),1),n(d,l,m);_.geometry=m,_.distanceSq=p}}else{if(p===0)return c[x]=!0,n(d,l,m);s.push(c[x]={feature:d,layer:l,geometry:m,distanceSq:p,callback:n})}},u,f=[this.replayGroup_],g=this.getLayer().getDeclutter();return f.some(d=>u=d.forEachFeatureAtCoordinate(t,r,o,i,h,g&&e.declutter[g]?e.declutter[g].all().map(m=>m.value):null)),u}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let e=this.getLayer(),i=e.getSource();if(!i)return!1;let n=t.viewHints[Ne.ANIMATING],s=t.viewHints[Ne.INTERACTING],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&n||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let l=t.extent,c=t.viewState,h=c.projection,u=c.resolution,f=t.pixelRatio,g=e.getRevision(),d=e.getRenderBuffer(),m=e.getRenderOrder();m===void 0&&(m=xo);let p=c.center.slice(),x=Ee(l,d*u),_=x.slice(),y=[x.slice()],T=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!re(T,t.extent)){let v=j(T),R=Math.max(j(x)/2,v);x[0]=T[0]-R,x[2]=T[2]+R,Vs(p,h);let M=qs(y[0],h);M[0]<T[0]&&M[2]<T[2]?y.push([M[0]+v,M[1],M[2]+v,M[3]]):M[0]>T[0]&&M[2]>T[2]&&y.push([M[0]-v,M[1],M[2]-v,M[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!t.declutter&&re(this.wrappedRenderedExtent_,x))return Dt(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let S=new oo(An(u,f),x,u,f),w=ze(),L;if(w){for(let v=0,R=y.length;v<R;++v){let M=y[v],X=Fe(M,h);i.loadFeatures(X,tr(u,h),w)}L=ui(w,h)}else for(let v=0,R=y.length;v<R;++v)i.loadFeatures(y[v],u,h);let E=On(u,f),F=!0,G=(v,R)=>{let M,X=v.getStyleFunction()||e.getStyleFunction();if(X&&(M=X(v,u)),M){let N=this.renderFeature(v,E,M,S,L,this.getLayer().getDeclutter(),R);F=F&&!N}},O=Fe(x,h),D=i.getFeaturesInExtent(O);m&&D.sort(m);for(let v=0,R=D.length;v<R;++v)G(D[v],v);this.renderedFeatures_=D,this.ready=F;let A=S.finish(),P=new fo(x,u,f,i.getOverlaps(),A,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=_,this.wrappedRenderedExtent_=x,this.renderedCenter_=p,this.renderedProjection_=h,this.renderedPixelRatio_=f,this.replayGroup_=P,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,r,o){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let c=0,h=i.length;c<h;++c)l=kn(n,t,i[c],e,this.boundHandleStyleImageChange_,s,r,o)||l;else l=kn(n,t,i,e,this.boundHandleStyleImageChange_,s,r,o);return l}},To=Gn;var Wn=class extends Fr{constructor(t){super(t)}createRenderer(){return new To(this)}},So=Wn;var Xn=class extends _i{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;let t=this.peekFirstKey(),i=qr(t)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(Ei(n.tileCoord)),n.release())})}},Eo=Xn;var Ri={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var Yn=class extends ri{constructor(t){super(),this.projection=jt(t.projection),this.attributions_=Co(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let e=this;this.viewPromise_=new Promise(function(i,n){e.viewResolver=i,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Co(t),this.changed()}setState(t){this.state_=t,this.changed()}};function Co(a){return a?typeof a=="function"?a:(Array.isArray(a)||(a=[a]),t=>a):null}var Ii=Yn;var Me=[0,0,0],te=5,jn=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,H(Ms(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,H(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=vt(i)),H(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,H(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,H(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((n,s)=>{let r=new Si(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){let o=this.getTileRangeForExtentAndZ(i,s);r.minX=Math.max(o.minX,r.minX),r.maxX=Math.min(o.maxX,r.maxX),r.minY=Math.max(o.minY,r.minY),r.maxY=Math.min(o.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){let n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,r=n.maxX;s<=r;++s)for(let o=n.minY,l=n.maxY;o<=l;++o)i([e,s,o])}forEachTileCoordParentTileRange(t,e,i,n){let s,r,o,l=null,c=t[0]-1;for(this.zoomFactor_===2?(r=t[1],o=t[2]):l=this.getTileCoordExtent(t,n);c>=this.minZoom;){if(r!==void 0&&o!==void 0?(r=Math.floor(r/2),o=Math.floor(o/2),s=ge(r,r,o,o,i)):s=this.getTileRangeForExtentAndZ(l,c,i),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let s=t[1]*2,r=t[2]*2;return ge(s,s+1,r,r+1,e)}let n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;let n=t[0],s=t[1],r=t[2];if(e===n)return ge(s,r,s,r,i);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,e-n),c=Math.floor(s*l),h=Math.floor(r*l);if(e<n)return ge(c,c,h,h,i);let u=Math.floor(l*(s+1))-1,f=Math.floor(l*(r+1))-1;return ge(c,u,h,f,i)}let o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Me);let n=Me[1],s=Me[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Me);let r=Me[1],o=Me[2];return ge(n,r,s,o,i)}getTileCoordCenter(t){let e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=yt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){let i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=yt(this.getTileSize(t[0]),this.tmpSize_),r=i[0]+t[1]*s[0]*n,o=i[1]-(t[2]+1)*s[1]*n,l=r+s[0]*n,c=o+s[1]*n;return Yt(r,o,l,c,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){let r=this.getZForResolution(i),o=i/this.getResolution(r),l=this.getOrigin(r),c=yt(this.getTileSize(r),this.tmpSize_),h=o*(t-l[0])/i/c[0],u=o*(l[1]-e)/i/c[1];return n?(h=je(h,te)-1,u=je(u,te)-1):(h=Ye(h,te),u=Ye(u,te)),Pe(r,h,u,s)}getTileCoordForXYAndZ_(t,e,i,n,s){let r=this.getOrigin(i),o=this.getResolution(i),l=yt(this.getTileSize(i),this.tmpSize_),c=(t-r[0])/o/l[0],h=(r[1]-e)/o/l[1];return n?(c=je(c,te)-1,h=je(h,te)-1):(c=Ye(c,te),h=Ye(h,te)),Pe(i,c,h,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){let i=Ps(this.resolutions_,t,e||0);return St(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return fr(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}},Nn=jn;function Fi(a){let t=a.getDefaultTileGrid();return t||(t=pl(a),a.setDefaultTileGrid(t)),t}function Ro(a,t,e){let i=t[0],n=a.getTileCoordCenter(t),s=wi(e);if(!Et(s,n)){let r=j(s),o=Math.ceil((s[0]-n[0])/r);return n[0]+=r*o,a.getTileCoordForCoordAndZ(n,i)}return t}function _l(a,t,e,i){i=i!==void 0?i:"top-left";let n=Fo(a,t,e);return new Nn({extent:a,origin:Hs(a,i),resolutions:n,tileSize:e})}function Io(a){let t=a||{},e=t.extent||jt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Fo(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Nn(i)}function Fo(a,t,e,i){t=t!==void 0?t:42,e=yt(e!==void 0?e:256);let n=nt(a),s=j(a);i=i>0?i:Math.max(s/e[0],n/e[1]);let r=t+1,o=new Array(r);for(let l=0;l<r;++l)o[l]=i/Math.pow(2,l);return o}function pl(a,t,e,i){let n=wi(a);return _l(n,t,e,i)}function wi(a){a=jt(a);let t=a.getExtent();if(!t){let e=180*js.degrees/a.getMetersPerUnit();t=Yt(-e,-e,e,e)}return t}var zn=class extends Ii{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let e=[256,256];this.tileGrid&&yt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||Y(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return!1}expireCache(t,e){let i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){let e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,n,s){return Ht()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Fi(t)}getTileCacheForProjection(t){let e=this.getProjection();return H(e===null||oe(e,t),"Use the renderer's tile cache when not reprojecting."),null}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){let n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),r=yt(n.getTileSize(t),this.tmpSize);return s==1?r:yr(r,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();let i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Ro(i,t,e)),Jr(t,i)?t:null}clear(){}refresh(){this.clear(),super.refresh()}},Li=class extends ii{constructor(t,e){super(t),this.tile=e}},wo=zn;var xl=/\{z\}/g,yl=/\{x\}/g,Tl=/\{y\}/g,Sl=/\{-y\}/g;function Lo(a,t,e,i,n){return a.replace(xl,t.toString()).replace(yl,e.toString()).replace(Tl,i.toString()).replace(Sl,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-i).toString()})}function Do(a){let t=[],e=/\{([a-z])-([a-z])\}/.exec(a);if(e){let i=e[1].charCodeAt(0),n=e[2].charCodeAt(0),s;for(s=i;s<=n;++s)t.push(a.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(a),e){let i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(a.replace(e[0],n.toString()));return t}return t.push(a),t}function El(a,t){return function(e,i,n){if(!e)return;let s,r=e[0];if(t){let o=t.getFullTileRange(r);o&&(s=o.getHeight()-1)}return Lo(a,r,e[1],e[2],s)}}function vo(a,t){let e=a.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=El(a[n],t);return Cl(i)}function Cl(a){return a.length===1?a[0]:function(t,e,i){if(!t)return;let n=Vr(t),s=Se(n,a.length);return a[s](t,e,i)}}var Un=class a extends wo{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===a.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let e=t.target,i=Y(e),n=e.getState(),s;n==I.LOADING?(this.tileLoadingKeys_[i]=!0,s=Ri.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==I.ERROR?Ri.TILELOADERROR:n==I.LOADED?Ri.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Li(s,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){let e=Do(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;let e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(vo(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}},Po=Un;var Kn=class extends Po{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Rl,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:mi,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){for(let t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){let i=this.getTileCacheForProjection(t);for(let n in this.tileCacheForProjection){let s=this.tileCacheForProjection[n];s.expireCache(s==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!oe(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){let e=this.getProjection();if(this.tileGrid&&(!e||oe(e,t)))return this.tileGrid;let i=Y(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Fi(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){let e=this.getProjection();if(!e||oe(e,t))return super.getTileCacheForProjection(t);let i=Y(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Eo(512)),this.tileCacheForProjection[i]}createTile_(t,e,i,n,s,r){let o=[t,e,i],l=this.getTileCoordForTileUrlFunction(o,s),c=l?this.tileUrlFunction(l,n,s):void 0,h=new this.tileClass(o,c!==void 0?I.IDLE:I.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=r,h.addEventListener($.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,i,n,s){let r=this.getProjection();if(!r||!s||oe(r,s))return this.getTileInternal(t,e,i,n,r||s);let o=this.getTileCacheForProjection(s),l=[t,e,i],c,h=Ei(l);o.containsKey(h)&&(c=o.get(h));let u=this.getKey();if(c&&c.key==u)return c;let f=this.getTileGridForProjection(r),g=this.getTileGridForProjection(s),d=this.getTileCoordForTileUrlFunction(l,s),m=new Ze(r,f,s,g,l,d,this.getTilePixelRatio(n),this.getGutter(),(p,x,_,y)=>this.getTileInternal(p,x,_,y,r),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return m.key=u,c?o.replace(h,m):o.set(h,m),m}getTileInternal(t,e,i,n,s){let r=this.getKey();return this.createTile_(t,e,i,n,s,r)}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(let e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){let i=jt(t);if(i){let n=Y(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(let t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}};function Rl(a,t){a.getImage().src=t}var bo=Kn;var Bn=class extends bo{constructor(t){t=t||{};let e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Io({extent:wi(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}},Mo=Bn;var Il='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',Zn=class extends Mo{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[Il];let i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}},Oo=Zn;var Hn=class{constructor(t){this.rbush_=new xr(t),this.items_={}}insert(t,e){let i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Y(e)]=i}load(t,e){let i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){let r=t[n],o=e[n],l={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[n]=l,this.items_[Y(o)]=l}this.rbush_.load(i)}remove(t){let e=Y(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){let i=this.items_[Y(e)],n=[i.minX,i.minY,i.maxX,i.maxY];Ce(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){let e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return se(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){let e=this.rbush_.toJSON();return Yt(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(let e in t.items_)this.items_[e]=t.items_[e]}},qn=Hn;var Ao=ct(),Je=class a{constructor(t,e,i,n,s,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Ks(this.flatCoordinates_):oi(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=hi(this.getExtent());this.flatInteriorPoints_=ur(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=gr(this.flatCoordinates_,this.ends_),e=Yr(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=dr(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Qi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,e=0,i=this.ends_;for(let n=0,s=i.length;n<s;++n){let r=i[n],o=Qi(t,e,r,2,.5);ni(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=jt(t);let e=t.getExtent(),i=t.getWorldExtent();if(e&&i){let n=nt(i)/nt(e);ut(Ao,i[0],i[3],n,-n,0,0,0),Pt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Ao,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new a(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=As((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);let i=this.simplifiedGeometry_.getFlatCoordinates(),n;switch(this.type_){case"LineString":i.length=lr(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=ar(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,n);break;case"Polygon":n=[],i.length=cr(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,n);break;default:}return n&&(this.simplifiedGeometry_=new a(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};Je.prototype.getFlatCoordinates=Je.prototype.getOrientedFlatCoordinates;var _e=Je;var ft={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function ko(a,t){return[[-1/0,-1/0,1/0,1/0]]}var Fl=!1;function wl(a,t,e,i,n,s,r){let o=new XMLHttpRequest;o.open("GET",typeof a=="function"?a(e,i,n):a,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=Fl,o.onload=function(l){if(!o.status||o.status>=200&&o.status<300){let c=t.getType();try{let h;c=="text"||c=="json"?h=o.responseText:c=="xml"?h=o.responseXML||o.responseText:c=="arraybuffer"&&(h=o.response),h?s(t.readFeatures(h,{extent:e,featureProjection:n}),t.readProjection(h)):r()}catch{r()}}else r()},o.onerror=r,o.send()}function Vn(a,t){return function(e,i,n,s,r){let o=this;wl(a,t,e,i,n,function(l,c){o.addFeatures(l),s!==void 0&&s(l)},r||si)}}var At=class extends ii{constructor(t,e,i){super(t),this.feature=e,this.features=i}},Jn=class extends Ii{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=si,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(H(this.format_,"`format` must be set when `url` is set"),this.loader_=Vn(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:ko;let e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new qn:null,this.loadedExtentsRtree_=new qn,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new Ws(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){let e=Y(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);let i=t.getGeometry();if(i){let n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new At(ft.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof _e||(this.featureChangeKeys_[t]=[Tt(e,$.CHANGE,this.handleFeatureChange_,this),Tt(e,Ls.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){let n=String(e.getId());if(!(n in this.idIndex_))this.idIndex_[n]=e;else if(e instanceof _e){let s=this.idIndex_[n];s instanceof _e?Array.isArray(s)?s.push(e):this.idIndex_[n]=[s,e]:i=!1}else i=!1}return i&&(H(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){let e=[],i=[],n=[];for(let s=0,r=t.length;s<r;s++){let o=t[s],l=Y(o);this.addToIndex_(l,o)&&i.push(o)}for(let s=0,r=i.length;s<r;s++){let o=i[s],l=Y(o);this.setupChangeEvents_(l,o);let c=o.getGeometry();if(c){let h=c.getExtent();e.push(h),n.push(o)}else this.nullGeometryFeatures_[l]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(ft.ADDFEATURE))for(let s=0,r=i.length;s<r;s++)this.dispatchEvent(new At(ft.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(ft.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(ft.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Ai.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Ai.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(let i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(at);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){let i=n=>{this.removeFeatureInternal(n)};this.featuresRtree_.forEach(i);for(let n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let e=new At(ft.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){let i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){let s=n.getGeometry();if(s instanceof _e||s.intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){let n=i.getGeometry();if(n instanceof _e||n.intersectsExtent(t)){let s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),se(this.nullGeometryFeatures_)||ni(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){let e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);let n=Ie(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){let i=t[0],n=t[1],s=null,r=[NaN,NaN],o=1/0,l=[-1/0,-1/0,1/0,1/0];return e=e||Os,this.featuresRtree_.forEachInExtent(l,function(c){if(e(c)){let h=c.getGeometry(),u=o;if(o=h instanceof _e?0:h.closestPointXY(i,n,r,o),o<u){s=c;let f=Math.sqrt(o);l[0]=i-f,l[1]=n-f,l[2]=i+f,l[3]=n+f}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){let e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){let e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){let e=t.target,i=Y(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{let r=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}let s=e.getId();if(s!==void 0){let r=s.toString();this.idIndex_[r]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[r]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new At(ft.CHANGEFEATURE,e))}hasFeature(t){let e=t.getId();return e!==void 0?e in this.idIndex_:Y(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&se(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){let n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let r=0,o=s.length;r<o;++r){let l=s[r];n.forEachInExtent(l,function(h){return re(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new At(ft.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new At(ft.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new At(ft.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){let e=this.loadedExtentsRtree_,i;e.forEachInExtent(t,function(n){if(Ce(n.extent,t))return i=n,!0}),i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,n=t.length;i<n;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){let e=Y(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(at),delete this.featureChangeKeys_[e];let n=t.getId();if(n!==void 0){let s=n.toString(),r=this.idIndex_[s];r===t?delete this.idIndex_[s]:Array.isArray(r)&&(r.splice(r.indexOf(t),1),r.length===1&&(this.idIndex_[s]=r[0]))}return delete this.uidIndex_[e],this.hasListener(ft.REMOVEFEATURE)&&this.dispatchEvent(new At(ft.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(let e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){H(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Vn(t,this.format_))}},Go=Jn;var Ll=["map"],og=(()=>{let t=class t extends br{constructor(){super(),this.geolocationService=ei(Hi),this.dialog=ei(Es),this.router=ei(Ts),this.card={header:{title:Fs.projects}},this.options={layers:[],view:new _r({center:[0,0],zoom:2,maxZoom:18}),controls:[new Dr({}),new Wr({}),new Pr({style:{left:".5em",top:"4.5em"},clickFn:this.locateMe.bind(this)})]}}ngOnInit(){this.map=new vr(this.options),this.map.setTarget(this.mapElement.nativeElement),this.addLayers(),this.addLocator(),this.getGeoLocation()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}getGeoLocation(){this.subscription=this.geolocationService.getCurrentPosition().subscribe({next:i=>{let n=[i.coords.longitude,i.coords.latitude],s=mr(n,i.coords.accuracy);if(!this.coords||!this.accuracy)return;let r=!this.coords.getGeometry();this.coords.setGeometry(new Yi(Js(n))),this.accuracy.setGeometry(s.transform("EPSG:4326",this.map.getView().getProjection())),r&&this.locateMe()},error:i=>{console.error("Error getting geolocation:",i)}})}addLayers(){this.vectorLayer=new So({source:new Go({features:[]})}),this.map.addLayer(new to({source:new Oo})),this.map.addLayer(this.vectorLayer)}addLocator(){this.accuracy=new Vi,this.coords=new Vi;let i=this.vectorLayer.getSource();i&&(i.addFeature(this.coords),i.addFeature(this.accuracy))}locateMe(){let i=this.vectorLayer.getSource();i&&(i.isEmpty()||this.map.getView().fit(i.getExtent(),{maxZoom:18,duration:500}))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=rs({type:t,selectors:[["sz-constr-construction-project-map"]],viewQuery:function(n,s){if(n&1&&ms(Ll,7),n&2){let r;_s(r=ps())&&(s.mapElement=r.first)}},standalone:!0,features:[xs([Hi]),cs,ys],decls:3,vars:1,consts:[["map",""],[3,"card"],["id","map","body","",1,"map"]],template:function(n,s){n&1&&(ds(0,"sz-ui-card",1),gs(1,"div",2,0),fs()),n&2&&us("card",s.card)},dependencies:[Cs,Ss,Rs,Is,ws],styles:[".map[_ngcontent-%COMP%]{width:100%;height:600px}"]});let a=t;return a})();export{br as a,og as b};
/**i18n:9054193bb4dcc24d51a6dba534830e37dcd91e77a8a9ecb6b346a792eb872c67*/
