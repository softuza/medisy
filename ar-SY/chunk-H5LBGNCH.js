import{c as q}from"./chunk-Z3DSEDYU.js";import{a as X}from"./chunk-32IEYMXX.js";import{a as te}from"./chunk-2T3VJL2I.js";import{a as Ue,b as Xe,j as qe}from"./chunk-25OCZQ76.js";import"./chunk-RB3G63CU.js";import"./chunk-4NLUKIZF.js";import"./chunk-E3TIAARS.js";import{d as ce,e as ie}from"./chunk-EPTC3T6X.js";import{f as V,g as B,h as k,i as Be,k as U}from"./chunk-ZILQN7IV.js";import"./chunk-7JFHPBQA.js";import{b as ze}from"./chunk-7EJ4LSDB.js";import{a as b,b as P,d as Re,e as R,g as C}from"./chunk-WP7GINVA.js";import{c as z,r as we,u as G}from"./chunk-WKQOW3L7.js";import{b as Ge}from"./chunk-SWSR2FHM.js";import"./chunk-YGAFJZ7Z.js";import{i as $}from"./chunk-7ES6GSH3.js";import{d as m,f as D,g as I,l as O,o as v,r as F,s as x,u as A}from"./chunk-GJE2CTRJ.js";import{b as w,c as Ve}from"./chunk-UJCFOIFA.js";import{a as ke}from"./chunk-IDEFMHWN.js";import"./chunk-EQLT65ZB.js";import"./chunk-K465E5EJ.js";import{a as ee}from"./chunk-CLMOD2EC.js";import"./chunk-FPHQ27E5.js";import{p as Ae}from"./chunk-FMLZPT37.js";import"./chunk-WW2QO4XN.js";import"./chunk-DMIN26VD.js";import{A as xe,Ka as Pe,Na as $e,ka as be,m as ve,s as Fe}from"./chunk-VE4VSZJT.js";import{$a as Ne,Cb as L,Fb as ae,Hb as le,Ib as se,Jb as de,Kb as _,Lb as c,Mb as d,Qb as j,Xb as Q,Zb as p,bc as De,cb as r,cc as Ie,db as ne,dc as Oe,hc as me,ic as _e,ja as u,lb as Le,na as E,nb as N,nc as Y,oc as K,pc as M,qa as ye,qc as S,rc as h,s as Ce,sb as re,vc as pe,wa as g,wc as ue,xa as T,ya as oe,yb as Z,zb as l}from"./chunk-2H67EYAB.js";import{a as Se,b as he}from"./chunk-ZA5F7ID5.js";var W=class{static round2Decimals(o){return Math.round(o*100)/100;}};var He=(()=>{let o=class o{constructor(e,t){this.http=e,this.sanitizer=t;}transform(e){return this.http.get(e,{responseType:"blob"}).pipe(Ce(t=>this.sanitizer.bypassSecurityTrustUrl(URL.createObjectURL(t))));}};o.ɵfac=function(t){return new(t||o)(ne(Fe,16),ne(xe,16));},o.ɵpipe=ye({name:"secure",type:o,pure:!0,standalone:!0});let n=o;return n;})();var f=class{static toPixel(o,a){return o==="mm"?a*3.78:o==="cm"?a*37.8:o==="in"?a*96:a;}static fromPixel(o,a){return o==="mm"?a/3.78:o==="cm"?a/37.8:o==="in"?a/96:a;}};var We=(()=>{let o=class o extends V{constructor(){let e=u(b);super(e),this.fb=u(x),this.data=u(P),this.barcodeTypes=["qr","datamatrix"];let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({id:[i?.id??X.generateV7()],name:[i?.name,[]],type:["barcode",[m.required]],x:[i?.x??0,[m.required]],y:[i?.y??0,[m.required]],value:[i?.value??"",[m.required]],barcodeType:[i?.barcodeType??"qr",[m.required]],width:[i?.width??16,[m.required]],height:[i?.height??16,[m.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-barcode-field"]],standalone:!0,features:[S([]),N,h],decls:13,vars:10,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0642\u064A\u0645\u0629";let i;i="\u0627\u0644\u0646\u0645\u0637";let s;s="\u0627\u0644\u0639\u0631\u0636";let y;return y="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],["formControlName","value","label",t],["formControlName","barcodeType","label",i,3,"source"],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",s,3,"type"],["formControlName","height","label",y,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(d(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),d(3,"sz-ui-form-field-input",2)(4,"sz-ui-form-field-input",3)(5,"sz-ui-form-field-select",4),_(6,"div",5),d(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7),c(),_(9,"div",5),d(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),c()()(),d(12,"sz-ui-dialog-actions",10)),t&2&&(l("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),l("formGroup",i.form),r(3),l("source",i.barcodeTypes),r(2),l("type","number"),r(),l("type","number"),r(2),l("type","number"),r(),l("type","number"),r(),l("actions",i.actions));},dependencies:[A,O,D,I,v,F,C,R,$,q,U,B,k,G,z,we],encapsulation:2});let n=o;return n;})();var je=(()=>{let o=class o extends V{constructor(){let e=u(b);super(e),this.fb=u(x),this.data=u(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({id:[i?.id??X.generateV7()],name:[i?.name,[]],type:["image",[m.required]],x:[i?.x??0,[m.required]],y:[i?.y??0,[m.required]],url:[i?.url??"",[m.required]],width:[i?.width??16,[m.required]],height:[i?.height??16,[m.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-image-field"]],standalone:!0,features:[S([]),N,h],decls:11,vars:9,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0639\u0631\u0636";let i;return i="\u0627\u0644\u0627\u0631\u062A\u0641\u0627\u0639",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","width","label",t,3,"type"],["formControlName","height","label",i,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(d(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),d(3,"sz-ui-form-field-input",2),_(4,"div",3),d(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),c(),_(7,"div",3),d(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),c()()(),d(10,"sz-ui-dialog-actions",8)),t&2&&(l("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),l("formGroup",i.form),r(3),l("type","number"),r(),l("type","number"),r(2),l("type","number"),r(),l("type","number"),r(),l("actions",i.actions));},dependencies:[A,O,D,I,v,F,C,R,$,q,U,B,k,G,z],encapsulation:2});let n=o;return n;})();var Qe=(()=>{let o=class o extends V{constructor(){let e=u(b);super(e),this.fb=u(x),this.data=u(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({id:[i?.id??X.generateV7()],name:[i?.name,[]],type:["line",[m.required]],x:[i?.x??5,[m.required]],y:[i?.y??5,[m.required]],lineColor:[i?.lineColor??"#000",[m.required]],lineWidth:[i?.lineWidth??1,[m.required]],x2:[i?.x2??30,[m.required]],y2:[i?.y2??5,[m.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-line-field"]],standalone:!0,features:[S([]),N,h],decls:13,vars:10,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0644\u0648\u0646";let i;return i="\u0627\u0644\u0639\u0631\u0636",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","x2","label","X2",3,"type"],["formControlName","y2","label","Y2",3,"type"],["formControlName","lineColor","label",t],["formControlName","lineWidth","label",i,3,"type"],[3,"actions"]];},template:function(t,i){t&1&&(d(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),d(3,"sz-ui-form-field-input",2),_(4,"div",3),d(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),c(),_(7,"div",3),d(8,"sz-ui-form-field-input",6)(9,"sz-ui-form-field-input",7),c(),d(10,"sz-ui-form-field-input",8)(11,"sz-ui-form-field-input",9),c()(),d(12,"sz-ui-dialog-actions",10)),t&2&&(l("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),l("formGroup",i.form),r(3),l("type","number"),r(),l("type","number"),r(2),l("type","number"),r(),l("type","number"),r(2),l("type","number"),r(),l("actions",i.actions));},dependencies:[A,O,D,I,v,F,C,R,$,q,U,B,k,G,z],encapsulation:2});let n=o;return n;})();var Ye=(()=>{let o=class o extends V{constructor(){let e=u(b);super(e),this.fb=u(x),this.data=u(P);let t=this.fb;this.dialog=e;let i=this.data;this.form=t.group({id:[i?.id??X.generateV7()],name:[i?.name,[]],type:["text",[m.required]],x:[i?.x??0,[m.required]],y:[i?.y??0,[m.required]],text:[i?.text??"",[m.required]],fontSize:[i?.fontSize??12,[m.required]],fontColor:[i?.fontColor??"#000",[m.required]]});}submit(){this.IsValid()&&this.dialog.close(this.form.value);}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template-text-field"]],standalone:!0,features:[S([]),N,h],decls:11,vars:8,consts:()=>{let e;e="\u0627\u0644\u0627\u0633\u0645";let t;t="\u0627\u0644\u0646\u0635";let i;i="\u062D\u062C\u0645 \u0627\u0644\u062E\u0637";let s;return s="\u0644\u0648\u0646 \u0627\u0644\u062E\u0637",[[3,"title","subtitle","alert"],[1,"sz-form",3,"formGroup"],["formControlName","name","label",e],[1,"sz-form-row"],["formControlName","x","label","X",3,"type"],["formControlName","y","label","Y",3,"type"],["formControlName","text","label",t],["formControlName","fontSize","label",i,3,"type"],["formControlName","fontColor","label",s],[3,"actions"]];},template:function(t,i){t&1&&(d(0,"sz-ui-dialog-header",0),_(1,"mat-dialog-content")(2,"form",1),d(3,"sz-ui-form-field-input",2),_(4,"div",3),d(5,"sz-ui-form-field-input",4)(6,"sz-ui-form-field-input",5),c(),d(7,"sz-ui-form-field-input",6)(8,"sz-ui-form-field-input",7)(9,"sz-ui-form-field-input",8),c()(),d(10,"sz-ui-dialog-actions",9)),t&2&&(l("title",i.title)("subtitle",i.subtitle)("alert",i.alert()),r(2),l("formGroup",i.form),r(3),l("type","number"),r(),l("type","number"),r(2),l("type","number"),r(2),l("actions",i.actions));},dependencies:[A,O,D,I,v,F,C,R,$,q,U,B,k,G,z],encapsulation:2});let n=o;return n;})();var Je=["designer"];function Ze(n,o){if(n&1&&d(0,"div"),n&2){let a=p();L(a.getMarginsStyle());}}function et(n,o){if(n&1){let a=j();Y(0),_(1,"p",11),Q("cdkDragEnded",function(t){g(a);let i=M(0),s=p(2);return T(s.drop(t,i));})("dblclick",function(){g(a);let t=M(0),i=p(2);return T(i.openSaveTextFieldComponent(t));}),me(2),c();}if(n&2){let a=p().$implicit,e=p(),t=K(e.getTextField(a));r(),L(e.getFieldStyle(t)),l("id",e.getFieldId(t)),r(),_e(t.text);}}function tt(n,o){if(n&1){let a=j();Y(0),_(1,"img",12),pe(2,"secure"),pe(3,"async"),Q("cdkDragEnded",function(t){g(a);let i=M(0),s=p(2);return T(s.drop(t,i));})("dblclick",function(){g(a);let t=M(0),i=p(2);return T(i.openSaveImageFieldComponent(t));}),c();}if(n&2){let a=p().$implicit,e=p(),t=K(e.getImageField(a));r(),L(e.getFieldStyle(t)),l("alt",t.name)("id",e.getFieldId(t))("src",ue(3,8,ue(2,6,t.url)),Ne);}}function it(n,o){if(n&1){let a=j();Y(0),oe(),_(1,"svg",13),Q("cdkDragEnded",function(t){g(a);let i=M(0),s=p(2);return T(s.drop(t,i));})("dblclick",function(){g(a);let t=M(0),i=p(2);return T(i.openSaveBarcodeFieldComponent(t));}),d(2,"path"),c();}if(n&2){let a=p().$implicit,e=p(),t=K(e.getBarcodeField(a));r(),L(e.getFieldStyle(t)),l("id",e.getFieldId(t)),Z("width",t.width)("height",t.height),r(),Z("d",e.getBarcodeFieldPath(t));}}function ot(n,o){if(n&1&&(_(0,"td"),me(1),c()),n&2){let a=o.$implicit,e=p(3);r(),_e(e.getTableColumnName(a));}}function nt(n,o){if(n&1){let a=j();Y(0),_(1,"table",14),Q("cdkDragEnded",function(t){g(a);let i=M(0),s=p(2);return T(s.drop(t,i));}),_(2,"tr"),se(3,ot,2,1,"td",null,le),c()();}if(n&2){let a=p().$implicit,e=p(),t=K(e.getTableField(a));r(),L(e.getFieldStyle(t)),l("id",e.getFieldId(t)),r(2),de(t.columns);}}function rt(n,o){if(n&1){let a=j();Y(0),oe(),_(1,"svg",15),Q("cdkDragEnded",function(t){g(a);let i=M(0),s=p(2);return T(s.drop(t,i));})("dblclick",function(){g(a);let t=M(0),i=p(2);return T(i.openSaveLineFieldComponent(t));}),d(2,"path"),c();}if(n&2){let a=p().$implicit,e=p(),t=K(e.getLineField(a));r(),L(e.getFieldStyle(t)),l("id",e.getFieldId(t)),r(),Z("d",e.getLineFieldPath(t))("stroke",t.lineColor)("stroke-width",t.lineWidth);}}function at(n,o){if(n&1&&re(0,et,3,5,"p",6)(1,tt,4,10,"img",7)(2,it,3,7,":svg:svg",8)(3,nt,5,4,"table",9)(4,rt,3,7,":svg:svg",10),n&2){let a=o.$implicit;ae(a.type==="text"?0:a.type==="image"?1:a.type==="barcode"?2:a.type==="table"?3:a.type==="line"?4:-1);}}var Ke=(()=>{let o=class o{constructor(){this.route=u(Ae),this.dialog=u(Re),this.srptService=u(te),this.snackBar=u(ze),this.template=this.route.snapshot.data.template,this.alert=Le(void 0),this.fields=[],this.size={width:210,height:297,unit:"mm"},this.margins={top:14,right:14,bottom:14,left:14},this.appBarConfig={title:this.template.name,subtitle:this.template.description,menu:Ve.default([w.add().setSubItems([w.text(()=>this.openSaveTextFieldComponent()),w.barcode(()=>this.openSaveBarcodeFieldComponent()),w.image(()=>this.openSaveImageFieldComponent()),w.line(()=>this.openSaveLineFieldComponent())]).setTitle(),w.menu([w.reset(this.reset.bind(this))])])},this.margins=this.template.content?.margins??{top:14,right:14,bottom:14,left:14},this.fields=this.template.content?.fields??[];}drop(e,t){if(!e.distance)return;let i=t.x+W.round2Decimals(f.fromPixel(this.size.unit,e.distance.x)),s=t.y+W.round2Decimals(f.fromPixel(this.size.unit,e.distance.y)),y=W.round2Decimals(f.fromPixel(this.size.unit,e.source.element.nativeElement.offsetWidth)),H=W.round2Decimals(f.fromPixel(this.size.unit,e.source.element.nativeElement.offsetHeight));i<0?i=0:i+y>this.size.width&&(i=this.size.width-y),s<0?s=0:s+H>this.size.height&&(s=this.size.height-H),t.x=i,t.y=s,e.source._dragRef._initialTransform&&(e.source._dragRef._initialTransform=`translate3d(${f.toPixel(this.size.unit,i)}px, ${f.toPixel(this.size.unit,s)}px, 0)`),e.source._dragRef.reset(),this.fieldChanged(t);}getTemplateStyle(){return`width: ${this.size.width}${this.size.unit}; height: ${this.size.height}${this.size.unit}; position: relative;`;}getMarginsStyle(){return`position: absolute; 
    top: ${this.margins.top}${this.size.unit}; 
    right: ${this.margins.right}${this.size.unit}; 
    bottom: ${this.margins.bottom}${this.size.unit}; 
    left: ${this.margins.left}${this.size.unit};
    border: 1px dotted black;
    `;}getFieldStyle(e){let t=`translate3d(${f.toPixel(this.size.unit,e.x)}px, ${f.toPixel(this.size.unit,e.y)}px, 0)`;switch(e.type){case"text":{let i=e;return`position: absolute; transform: ${t}; font-size: ${i.fontSize}px; color: ${i.fontColor}; text-align: ${i.textAlign};`;}case"image":{let i=e;return`position: absolute; transform: ${t}; width: ${i.width}${this.size.unit}; height: ${i.height}${this.size.unit};`;}case"barcode":{let i=e;return`position: absolute; transform: ${t};`;}case"table":{let i=e;return`position: absolute; transform: ${t};width:${i.x2-i.x};`;}case"line":return"position: absolute;";}return"";}getFieldId(e){return this.template.id+"-"+e.name;}getTextField(e){return e;}getImageField(e){return e;}getBarcodeField(e){return e;}getBarcodeFieldPath(e){let t=null;return e.barcodeType==="qr"&&(t=ie.qr(e.value)),e.barcodeType==="datamatrix"&&(t=ie.datamatrix(e.value,!1)),t?ce.toPath(t):"";}getTableField(e){return e;}getTableColumnName(e){return typeof e=="string"?e:typeof e=="number"?e.toString():e.key?.toString()??"";}getLineField(e){return e;}getLineFieldPath(e){return`M${f.toPixel(this.size.unit,e.x)},${f.toPixel(this.size.unit,e.y)} L${f.toPixel(this.size.unit,e.x2)},${f.toPixel(this.size.unit,e.y2)}`;}openSaveTextFieldComponent(e){this.dialog.open(Ye,{data:e}).afterClosed().subscribe(t=>{t&&this.fieldChanged(t);});}openSaveBarcodeFieldComponent(e){this.dialog.open(We,{data:e}).afterClosed().subscribe(t=>{t&&this.fieldChanged(t);});}openSaveImageFieldComponent(e){this.dialog.open(je,{data:e}).afterClosed().subscribe(t=>{t&&this.fieldChanged(t);});}openSaveLineFieldComponent(e){this.dialog.open(Qe,{data:e}).afterClosed().subscribe(t=>{t&&this.fieldChanged(t);});}fieldChanged(e){let t=this.fields.findIndex(i=>i.id===e.id);t!==-1?this.fields[t]=e:this.fields.push(e),console.log(this.fields),this.save();}fieldDeleted(e){this.fields=this.fields.filter(t=>t.name!==e.name);}reset(){this.dialog.open(Be,{data:{message:ee.reset_template}}).afterClosed().subscribe(e=>{e&&(this.fields=this.template.baseTemplate.content?.fields??[],this.save());});}save(){this.srptService.templates.update(this.template.id,he(Se({},this.template),{content:{fields:this.fields,margins:this.margins}})).subscribe(()=>{this.snackBar.open(ee.saved,ee.close,{duration:5e3});});}};o.ɵfac=function(t){return new(t||o)();},o.ɵcmp=E({type:o,selectors:[["sz-mgmt-reporting-template"]],viewQuery:function(t,i){if(t&1&&De(Je,5),t&2){let s;Ie(s=Oe())&&(i.designerEl=s.first);}},standalone:!0,features:[S([te]),h],decls:8,vars:5,consts:[["designer",""],[3,"config"],[3,"alert"],[1,"container"],["dir","ltr",1,"designer"],[3,"style"],["cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"alt","id","style","src"],["viewbox","0 0 25 25","xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"id","style"],["xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"id","style"],["cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","dblclick","id"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"cdkDragEnded","dblclick","alt","id","src"],["viewbox","0 0 25 25","xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","dblclick","id"],["cdkDrag","","cdkDragBoundary",".designer",1,"field",3,"cdkDragEnded","id"],["xmlns","http://www.w3.org/2000/svg","version","1.1","cdkDrag","","cdkDragBoundary",".designer",3,"cdkDragEnded","dblclick","id"]],template:function(t,i){t&1&&(d(0,"sz-ui-app-bar",1)(1,"sz-ui-alert",2),_(2,"div",3)(3,"div",4,0),re(5,Ze,1,2,"div",5),se(6,at,5,1,null,null,le),c()()),t&2&&(l("config",i.appBarConfig),r(),l("alert",i.alert()),r(2),L(i.getTemplateStyle()),r(2),ae(i.margins?5:-1),r(),de(i.fields));},dependencies:[C,be,$e,Xe,Ue,qe,ke,Pe,Ge,He,ve],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.designer[_ngcontent-%COMP%]{border:1px solid #c3c3c3;background-color:#fff;position:relative}table[_ngcontent-%COMP%]{font-family:arial,sans-serif;border-collapse:collapse}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left}"]});let n=o;return n;})();var qi=[{path:"",component:Ke}];export{qi as default};/**i18n:9054193bb4dcc24d51a6dba534830e37dcd91e77a8a9ecb6b346a792eb872c67*/