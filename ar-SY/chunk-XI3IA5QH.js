import{a as I}from"./chunk-UVLKQSOZ.js";import{a as x,b as D,c as j,e as X,f as k,g as U,h as H}from"./chunk-Z3ELZRWE.js";import{c as Y}from"./chunk-UCRC6V5J.js";import{b as W,f as Z}from"./chunk-5WJVC7PV.js";import{a as Q}from"./chunk-P4AS2ZYY.js";import{a as J,b as K}from"./chunk-EY4PTUQV.js";import{a as V,b as q}from"./chunk-QXIIYWNN.js";import{i as P}from"./chunk-YWYJPJA4.js";import{d as s,f as E,g as b,k as T,m as G,p as A,r as z,t as R}from"./chunk-EIWC7QFZ.js";import"./chunk-22G3BWVW.js";import{c as C}from"./chunk-L6HNREY7.js";import{ga as $,ha as F,ia as B,ka as w}from"./chunk-QHXZELMZ.js";import"./chunk-TWGSABWX.js";import{Db as _,Hc as h,Ib as y,Nb as a,Ob as c,Pb as d,Zb as O,_b as N,f as u,g as L,hb as g,ib as n,pc as f,qc as M,tb as S,ua as p,zb as v}from"./chunk-XPH4NMLC.js";function oe(r,o){r&1&&d(0,"mat-progress-bar",11);}var be=(()=>{let o=class o{constructor(e,t,i,m){this.locale=e,this.fb=t,this.router=i,this.identityService=m,this.alert=S(void 0),this.indicator=S(!1),this.subscriptions=new L();let l=this.identityService.storage.get();this.form=this.fb.group({email:[l?.username,[s.required,s.minLength(1),s.email]],organization:[l?.realm,[s.required,s.minLength(3),s.maxLength(255)]]}),this.subscribeChanges();}ngOnDestroy(){this.subscriptions.unsubscribe();}subscribeChanges(){this.subscriptions.add(this.form.controls.email.valueChanges.subscribe(e=>{this.emailChanged(e);}));}emailChanged(e){let t=e.indexOf("@");if(t>0){let i=e.indexOf(".",t);this.form.controls.organization.setValue(e.substring(t+1,i>0?i:e.length));}}login(){return u(this,null,function*(){if(!Z(this.form))return!1;this.indicator.set(!0);let e=this.identityService.storage.set({realm:this.form.value.organization,username:this.form.value.email});return yield this.authInitialize(e),this.indicator.set(!1),!0;});}authInitialize(e){return u(this,null,function*(){try{if(yield this.identityService.initialize(e)){this.router.navigate(["/"]);return;}yield this.identityService.login({loginHint:e.username,locale:this.locale,redirectUri:this.identityService.getAuthRedirectUri()});}catch{this.alert.set({message:"Faield to login",type:Q.Error,timeout:5e3});}});}};o.ɵfac=function(t){return new(t||o)(n(h),n(z),n(C),n(I));},o.ɵcmp=p({type:o,selectors:[["sz-iam-auth-login"]],standalone:!0,features:[f([]),M],decls:18,vars:4,consts:()=>{let e;e="\u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0627\u0644\u0643\u062A\u0631\u0648\u0646\u064A";let t;t="\u0627\u0644\u0645\u0646\u0638\u0645\u0629";let i;i="\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644";let m;return m="\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644",[i,m,[1,"content-center"],["svgIcon","logo",1,"logo"],[1,"tw-m-2"],[2,"padding","16px"],[3,"alert"],[3,"keyup.enter","formGroup"],["formControlName","email","label",e],["formControlName","organization","label",t],["mat-button","",1,"button-submit",3,"click","disabled"],["mode","indeterminate"]];},template:function(t,i){t&1&&(a(0,"div",2),d(1,"mat-icon",3),a(2,"mat-card",4)(3,"mat-card-header")(4,"mat-card-title"),O(5,0),c()(),a(6,"mat-card-content",5),d(7,"sz-ui-alert",6),a(8,"form",7),N("keyup.enter",function(){return i.login();}),d(9,"sz-ui-form-field-input",8)(10,"sz-ui-form-field-input",9),c(),d(11,"mat-divider"),c(),a(12,"mat-card-actions")(13,"button",10),N("click",function(){return i.login();}),a(14,"span"),O(15,1),c()()(),a(16,"mat-card-footer"),v(17,oe,1,0,"mat-progress-bar",11),c()()()),t&2&&(g(7),_("alert",i.alert()),g(),_("formGroup",i.form),g(5),_("disabled",i.indicator()),g(4),y(17,i.indicator()?17:-1));},dependencies:[R,T,E,b,G,A,H,x,X,j,U,k,D,K,J,P,F,$,q,V,w,B,W,Y],styles:[".content-center[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.logo[_ngcontent-%COMP%]{width:128px;height:128px;transform:scale(2);margin:16px}.button-submit[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{text-align:center;margin:16px 0;font-size:12px;cursor:pointer}"]});let r=o;return r;})();var Pe=(()=>{let o=class o{constructor(e,t,i){this.locale=e,this.router=t,this.identityService=i;}ngOnInit(){return u(this,null,function*(){let e=this.identityService.storage.get();if(!e){this.router.navigate(["/auth/login"]);return;}if(yield this.identityService.initialize(e)){this.router.navigate(["/"]);return;}yield this.identityService.login({loginHint:e.username,locale:this.locale,redirectUri:this.identityService.getAuthRedirectUri()});});}};o.ɵfac=function(t){return new(t||o)(n(h),n(C),n(I));},o.ɵcmp=p({type:o,selectors:[["sz-iam-auth-redirect"]],standalone:!0,features:[f([]),M],decls:0,vars:0,template:function(t,i){},encapsulation:2});let r=o;return r;})();export{be as SzAuthLoginComponent,Pe as SzAuthRedirectComponent};/**i18n:7992b670fa912c61e7fcc3b33bbd0ab051bcb5cc240f907263ef623fbdc93e3b*/